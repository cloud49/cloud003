const t=document.createElement.bind(document),n=document.createElementNS.bind(document),e=document.createTextNode.bind(document),r=document.createDocumentFragment.bind(document);function i(e,r){return void 0===e?t(r):n(e,r)}const s=window.requestIdleCallback||((t,{timeout:n}={})=>setTimeout(t,n));function o(t){const{nodeType:n,namespaceURI:e,attributes:r,childNodes:i}=t;if(3===n)return t.textContent;if(1!==n)return null;t.__vdom__||(t.__vdom__={handlers:{}});const s=t.tagName.toLowerCase(),c="http://www.w3.org/1999/xhtml"===e?void 0:e,a={},u=[];for(const{nodeName:t,nodeValue:n}of r)a[t]=n;for(const t of i){const n=o(t);n&&u.push(n)}return{namespace:c,name:s,attributes:a,events:{},children:u}}function c(t,n={}){if("string"==typeof t)return e(t);if(void 0!==t.create)return t.create(t,n);const{namespace:r,name:s,attributes:o,events:a,children:d}=t,f=i(r,s);f.__vdom__={handlers:{}},u(f,o,{}),l(f,a,{},n);for(const t of d)f.appendChild(c(t,n));return f}function a(t,n,e=o(t),r={}){return n===e?t:!n||function(t,n){return t!==n&&"string"==typeof t||"string"==typeof n||t.name!==n.name||t.namespace!==n.namespace||t.patch!==n.patch}(n,e)?f(t,n,e,r):void 0!==n.patch?n.patch(t,n,e,r):(u(t,n.attributes,e.attributes),l(t,n.events,e.events,r),d(t,n.children,e.children,r),t)}function u(t,n,e){const r={...e,...n};for(const i in r){let r=n[i];r!==e[i]&&("value"===i?t.value=void 0===r?"":r:"boolean"==typeof r&&(t[i]=r,r=r?i:void 0),void 0!==r?t.setAttribute(i,r):t.removeAttribute(i))}return t}function l(t,n,e,{lift:r}={}){const i={...e,...n},s=t.__vdom__.handlers;for(const o in i){let i=s[o],c=n[o];const a=e[o];c?(a||(i=s[o]=t=>i.action(t),t.addEventListener(o,i)),void 0!==r&&(c=r(c,a,i.action)),i.action=c):(t.removeEventListener(o,i),delete s[o])}return t}function d(t,n,e,i={}){void 0===e&&(e=Array.from(t.childNodes).map(o));const s=t.childNodes,u=n.length,l=e.length,d=Math.min(u,l);for(let t=0;t<d;t++)a(s[t],n[t],e[t],i);for(let t=u;t<l;t++)f(s[u],null,e[t],i);if(u>l){const e=r();for(let t=l;t<u;t++)e.appendChild(c(n[t],i));t.appendChild(e)}return t}function f(t,n,e,r={}){const i=t.parentNode,o=n?c(n,r):null;return i&&(o?i.replaceChild(o,t):i.removeChild(t)),(void 0!==e.unmount||e.children)&&s((()=>m(t,e)),{timeout:3e3}),o}function m(t,n){if(void 0!==n.unmount)return n.unmount(t,n);const e=t.childNodes,r=n.children||[];for(let t=0,n=r.length;t<n;t++)m(e[t],r[t]);return t}function p(t){if(!t||"string"!=typeof t||"length"===t)throw new RangeError("Invalid topic")}function g(t,n,e){p(n);const r=t[n]=t[n]||[];for(const n of r)if(n===e)return t;return t.length=(t.length||0)+1,r.push(e),t}function h(t,n,e){p(n);const r=t[n]||[],i=t[n]=[];for(const n of r)n===e?t.length=(t.length||1)-1:i.push(n);return i.length||delete t[n],t}function v(t,n,...e){p(n);const r=t[n]||[];for(const t of r)new Promise((n=>{t(...e),n()}));return t}class w{constructor(){this.isOpen=!0,this.ports=[]}createPort(){!function({isOpen:t}){if(!t)throw new Error("Channel is closed.")}(this);const t=new I(this);return this.ports.push(t),t}close(){const t=this.ports;this.ports=[],this.isOpen=!1;for(const n in t)n.close()}}class I{constructor(t){this.subs={},this.isOpen=!0,this.channel=t}subscribe(t,n){y(this),g(this.subs,t,n)}unsubscribe(t,n){y(this),h(this.subs,t,n)}publish(t,...n){y(this);const e=this.channel.ports;for(const r of e)r!==this&&v(r.subs,t,...n)}close(){const t=this.channel;this.subs={},this.isOpen=!1,this.channel=null,t.ports=t.ports.filter((t=>t!==this))}}function y({isOpen:t}){if(!t)throw new Error("Port is closed.")}function A(t,{topicsIn:n,topicsOut:e}){return new b(t.createPort(),n,e)}class b{constructor(t,n,e){this.port=t,this.topicsIn=n,this.topicsOut=e}publish(t,...n){const e=this.topicsIn;k(e,t),function(t,n,...e){const r=t[n];if(!0!==r&&!r(...e))throw new TypeError("Invalid port message")}(e,t,...n),this.port.publish(t,...n)}subscribe(t,n){k(this.topicsOut,t),this.port.subscribe(t,n)}unsubscribe(t,n){k(this.topicsOut,t),this.port.unsubscribe(t,n)}}function k(t,n){if(!t[n])throw new RangeError(`Invalid port topic: "${n}"`)}const j=Function.prototype.call,C=j.bind(Object.prototype.toString),D=j.bind(Object.prototype.hasOwnProperty),E=t=>"number"==typeof t&&t!=t;function T(t,n){if(t===n)return!0;if(E(t))return E(n);if("object"!=typeof t||"object"!=typeof n)return!1;const e=C(t);if(C(n)!==e)return!1;if("[object Date]"===e)return t.getTime()===n.getTime();if("length"in t){let e=t.length;if(n.length!==e)return!1;for(;e--;)if(!T(t[e],n[e]))return!1;return!0}for(const e in t)if(D(t,e)&&!T(t[e],n[e]))return!1;for(const e in n)if(D(n,e)&&!(e in t))return!1;return!0}const P=window.setImmediate||((t,...n)=>setTimeout((()=>t(...n)),0)),N=["init","update","view","subscriptions"];function $(t){for(const n of N)if("function"!=typeof t[n])throw new TypeError(`"${n}" is not a function`)}function F([t,...n],e){return t(...n,e)}function U(t,n){if(t.length!==n.length||t[0]!==n[0])return!1;for(let e=1,r=t.length;e<r;e++)if(!T(t[e],n[e]))return!1;return!0}const{requestAnimationFrame:S,cancelAnimationFrame:x}=window,M=Promise.prototype.then.bind(Promise.resolve());function O(t,n,e,r,i={},s={}){const o={init:t,update:n,view:e,subscriptions:r,topicsIn:i,topicsOut:s};return $(o),o}function V(t,n,e=[],r=!1){"string"==typeof t&&(t=document.getElementById(t)),function(t,n){if(!(n instanceof HTMLElement))throw new TypeError(`"${t}" is not an HTML element`)}("root",t),$(n);const{init:i,update:s,view:o,subscriptions:c}=n,u=r?a:d,l={lift:t=>n=>t(n,k)},f=function(t){let n=null;const e=()=>{n=null,t()};return function(t){if(!0!==t)return void(null===n&&(n=[1,S(e)]));const[r,i]=n||[];0!==r&&(1===r&&x(i),n=[0,M(e)])}}(j),m=new w,p=m.createPort(),g={root:t,port:A(m,n),unmount:function(){const n=b.subscriptions;y=!1,requestAnimationFrame((()=>t.innerHTML=""));for(const{cancel:t}of n)P(t)}};let h,[v,...I]=i(...e,p),y=!0,b={};function k(t,n=!1){y&&([v,...I]=s(t,v,p),f(n),b=C(I,c(v,p),b))}function j(){if(!y)return;const n=h;h=o(v),(t=u(t,h,n,l))!==g.root&&(g.root=t)}function C(t,n,{subscriptions:e=[]}){const r=[];null===t[0]&&1===t.length&&(t=[]);for(const t of n){const n=e.findIndex((n=>U(t,n.effect)));if(n>-1){r.push(e[n]),e.splice(n,1);continue}const i=F(t,k);r.push({effect:t,cancel:i})}for(const{cancel:t}of e)P(t);for(const n of t)P(F,n,k);return{subscriptions:r}}return j(),b=C(I,c(v,p),b),g}const L=RegExp.prototype.test.bind(/^on[A-Z]/);function R({classes:t,styles:n,aria:e,data:r,...i}){const s={},o={};for(const t in i){const n=i[t];null!=n&&(L(t)?o[(c=t,c.slice(2).toLowerCase())]=n:s[t]=n)}var c;if(e&&_("aria",e,s),r&&_("data",r,s),t){let n=s.class||"";for(const e in t)t[e]&&(0!==n.length&&(n+=" "),n+=e);n&&(s.class=n)}if(n){let t=s.style||"";t&&";"!==t[t.length-1]&&(t+=";");for(const e in n){const r=n[e];r&&(t+=`${e}:${r};`)}t&&(s.style=t)}return[s,o]}function _(t,n,e){for(const r in n){const i=`${t}-${r}`;i in e||(e[i]=n[r])}return e}function q(t,n,{is:e,...r},...i){if(void 0!==e)return e(t,n,r,...i);const[s,o]=R(r);return{namespace:t,name:n,attributes:s,events:o,children:i=i.filter(Boolean)}}function W(t,n,e){let r=0,i=e.length-1;const s=n[t];for(;r<i;){const t=r+Math.ceil((i-r)/2);n[e[t]]<s?r=t:i=t-1}return r}function B(t,n,e,i={}){void 0===e&&(e=Array.from(t.childNodes).map(o));const s=function({childNodes:t},n,e,r){let i=0;const s=Math.min(n.length,e.length);for(;i<s;){const[s,o]=n[i],[c,u]=e[i];if(s!==c)break;a(t[i],o,u,r),i++}return i}(t,n,e,i),u=function({childNodes:t},n,e,r,i){let s=n.length,o=e.length;for(;s-- >r&&o-- >r;){const[r,c]=n[s],[u,l]=e[o];if(r!==u)break;a(t[o],c,l,i)}return n.length-s-1}(t,n,e,s,i),l=s+u;return l===n.length?function(t,n,e,r,i){const s=t.childNodes;for(let t=n.length-r-1;t>=e;t--)f(s[t],null,n[t][1],i);return t}(t,e,s,u,i):l===e.length?function(t,n,e,i,s){const o=r();for(let t=e,r=n.length-i;t<r;t++)o.appendChild(c(n[t][1],s));return t.insertBefore(o,t.childNodes[e]),t}(t,n,s,u,i):function(t,n,e,i=0,s=0,o){const u=t.childNodes,l=r(),d=[],m={},p={},g=n.length-s;for(let t=i;t<g;t++)p[n[t][0]]=t;for(let t=i,n=0,r=e.length-s;t<r;t++){const[r,i]=e[t],s=u[t-n],c=p[r];void 0!==c?(d.push(c),m[r]=[s,i]):(f(s,null,i,o),n++)}const h=function(t){const n=t.length,e=[null,0],r=new Array(n);for(let i=0;i<n;i++){const n=W(i,t,e),s=e[n+1];r[i]=e[n],(void 0===s||t[i]<t[s])&&(e[n+1]=i)}const i=e.length-1,s=new Array(i);for(let n=i-1,o=e[i];n>=0;n--)s[n]=t[o],o=r[o];return s}(d);for(let e=i,r=0,s=h[r];e<g;e++){const[i,u]=n[e],[d,f]=m[i]||[];e!==s?(l.appendChild(d||c(u,o)),d&&a(d,u,f,o)):(t.insertBefore(l,d),a(d,u,f,o),s=h[++r])}t.insertBefore(l,u[g])}(t,n,e,s,u,i)}function z(t,n,e,...r){const[i,s]=R(e);return r=function(t){const n={},e=[];for(const r of t){if(!r)continue;const[t,i]=r;H(t),Y(t,n),n[t]=!0,i&&e.push(r)}return e}(r),new G(t,n,i,s,r)}class G{constructor(t,n,e,r,i){this.namespace=t,this.name=n,this.attributes=e,this.events=r,this.children=i}get node(){return{...this,children:this.children.map((([t,n])=>n))}}create({namespace:t,name:n,attributes:e,events:r,children:s},o={}){const a=i(t,n);a.__vdom__={handlers:{}},u(a,e,{}),l(a,r,{},o);for(const[t,n]of s)a.appendChild(c(n,o));return a}patch(t,n,e,r={}){return u(t,n.attributes,e.attributes),l(t,n.events,e.events,r),B(t,n.children,e.children,r),t}}function H(t){if("string"!=typeof t||""===t)throw new TypeError("VDOM: Invalid key")}function Y(t,n){if(t in n)throw new RangeError(`VDOM: Key "${t}" is not unique`)}function J(t,n,...e){return z(void 0,t,n,...e)}function Q(t){return(n,...e)=>q(void 0,t,n,...e)}const Z=Q("div"),K=Q("span"),X=Q("a"),tt=Q("ul"),nt=Q("li"),et=Q("dl"),rt=Q("dt"),it=Q("dd"),st=Q("time"),ot=Q("progress"),ct=Q("nav"),at=Q("header"),ut=Q("section"),lt=Q("h1"),dt=Q("h2"),ft=Q("h3"),mt=Q("h4"),pt=Q("p"),gt=Q("strong"),ht=Q("form"),vt=Q("fieldset"),wt=Q("label"),It=Q("input"),yt=Q("textarea"),At=Q("select"),bt=Q("option"),kt=Q("button"),jt=Q("table"),Ct=Q("thead"),Dt=Q("tbody"),Et=Q("tfoot"),Tt=Q("tr"),Pt=Q("th"),Nt=Q("td");function $t(t,n=!1){return"function"==typeof t?(e,r)=>r(t(e),n):(e,r)=>r(t,n)}function Ft(t){return function(n,e){n.preventDefault(),e(t)}}function Ut(t){return function({currentTarget:n,relatedTarget:e},r){n.contains(e)||r(t(!!e))}}function St(t,n=!1){return(e,r)=>r(t(e.target.value),n)}function xt(t){return function(n,e){n.preventDefault(),e(t)}}function Mt(t,n){if("string"!=typeof n)throw new TypeError(`"${t}" is not a string.`)}function Ot(t,n){if("function"!=typeof n)throw new TypeError(`"${t}" is not a function.`)}const Vt=RegExp.prototype.test.bind(new RegExp("^[:*][a-z][a-z\\d_]*$","i"));function Lt(t,n){return t instanceof URL?t:new URL(t,n)}function Rt(t){const n={},e=t.split("&"),r=e[0];"?"===r[0]&&(e[0]=r.substring(1));for(const t of e){let[e,r]=t.split("=");void 0!==r&&(e=decodeURIComponent(e),r=decodeURIComponent(r),n[e]=r)}return n}function _t({origin:t,routes:n,registry:e},r){!function(t,n,e){if(n.origin!==e)throw new TypeError(`"${t}" is not of same origin.`)}("url",r=Lt(r,t),t);let i=!1,s=n;const o=[],c=r.pathname.split("/").filter(Boolean);for(let t=0,n=c.length;t<n&&0!==s.length;t++){const n=c[t],r=e[t]||{},i=[];for(const t in r[n]||{})s[t]&&(i[t]=!0);for(const t in r["*"]||{})s[t]&&(i[t]=!0);for(const t in r["**"]||{})s[t]&&(o[t]=!0);s=i}for(const t in s)o[t]=!0;for(const t in o){const e=n[t],s=qt(e,r,c),o=e.validator;if(s&&(!o||o(s,r))){i={target:e.target,params:s};break}}return i}function qt({machine:t},n,e){e||(e=n.pathname.split("/").filter(Boolean));let r={};const i=[];for(let n=0,s=e.length;n<s;n++){const s=e[n],o=t,c=o.arrows||{},a=c["*"];if(!(t=c[s]||a)){if([t,n,r]=i.pop()||[],t)continue;return!1}a&&a!==t&&i.push([a,n,{...r}]);const u=t.name;u&&(r[u]=t===o?r[u]+"/"+s:s)}return!!t.isFinal&&(r={...Rt(n.search),...r},r)}const Wt=window.history;let Bt=[];function zt(t){Bt=Bt.filter((n=>n!==t)),0===Bt.length&&window.removeEventListener("popstate",Ht)}function Gt(t,n){for(const e of Bt)setTimeout((()=>e(t,n)),0)}function Ht({state:t}){Gt(window.location,t)}function Yt(t=1){Wt.go(-1*t)}function Jt(t,n=null){const e=window.location;if((t=Lt(t,e)).origin!==e.origin)return e.assign(t);t.toString()!==e.toString()&&(Wt.pushState(n,"",t),Gt(t,n))}function Qt(t,n=null){const e=window.location;if((t=Lt(t,e)).origin!==e.origin)return e.assign(t);t.toString()!==e.toString()&&(Wt.replaceState(n,"",t),Gt(t,n))}const Zt=(Mt("origin",Kt=window.location.origin),Xt&&Ot("defaultTarget",Xt),{origin:Kt,routes:[],registry:{},defaultTarget:Xt});var Kt,Xt;function tn(t){return n=>[t,n]}function nn(t,n,e){const r=e&&rn.bind(void 0,e);return function(t,n,e,r){Mt("path",n),r&&Ot("validator",r);const{origin:i,routes:s,registry:o}=t,c=(n=new URL(n,i).pathname).split("/").filter(Boolean);let a={arrows:{}};const u=s.length;s[u]={path:n,machine:a,target:e,validator:r};for(let t=0,n=c.length;t<n;t++){let n,e=c[t],r=e,i=e;Vt(e)&&(i="*",n=e.substring(1),r=":"===e[0]?"*":"**");const s=o[t]=o[t]||{};(s[r]=s[r]||{})[u]=!0,a=a.arrows[i]={name:n,arrows:{}},"**"===r&&(a.arrows["*"]=a)}return a.isFinal=!0,t}(Zt,t,n,r)}function en(t){const{target:n,params:e}=_t(Zt,t)||{};return n?n(e):["NotFound",{url:t.toString()}]}function rn(t,n){for(const e in t)if(!t[e](n[e]))return!1;return!0}const sn=RegExp.prototype.test.bind(new RegExp("^[:*][a-z][a-z\\d_]*$","i"));function on(t){let n=0,e="/";const r=[],i=t.split("/").filter(Boolean);for(const t of i)sn(t)?(n++,r.push(e),e="/"):e+=t+"/";return r.push(e),function(...t){const e=t[n];t=t.splice(0,n);for(let e=0;e<n;e++)cn(t[e]);return function(t,n){let e="";const r=t.length,i=n.length,s=Math.max(r,i);for(let o=0;o<s;o++)o<r&&(e+=t[o]),o<i&&(e+=n[o]);return e}(r,t)+function(t={}){let n="";for(const e in t){const r=t[e];void 0!==r&&(n&&(n+="&"),n+=encodeURIComponent(e)+"="+encodeURIComponent(r))}return n?"?"+n:""}(e)}}function cn(t){const n=typeof t;if("string"===n||"number"===n)return;throw t?new TypeError("Invalid path parameter."):new TypeError("Missing path parameter.")}const an=RegExp.prototype.test.bind(/^[1-9]\d*$/),un=on("/"),ln=on("/login"),dn=on("/admin/clients"),fn=on("/admin/clients/new"),mn=on("/admin/clients/:id"),pn=on("/admin/clients/:id/edit"),gn=on("/admin/clients/:clientId/accounts"),hn=on("/admin/clients/:clientId/accounts/new"),vn=on("/admin/clients/:clientId/accounts/:id"),wn=on("/admin/clients/:clientId/accounts/:id/edit"),In=on("/admin/projects"),yn=on("/admin/projects/new"),An=on("/admin/projects/:id"),bn=on("/admin/projects/:id/edit"),kn=on("/admin/projects/:projectId/invoices/new"),jn=on("/admin/projects/:projectId/invoices/:id"),Cn=on("/admin/projects/:projectId/invoices/:id/edit"),Dn=on("/admin/projects/:projectId/tasks"),En=on("/admin/projects/:projectId/tasks/new"),Tn=on("/admin/projects/:projectId/tasks/:id"),Pn=on("/admin/projects/:projectId/tasks/:id/edit"),Nn=on("/admin/projects/:projectId/tasks/:taskId/invoices/new"),$n=on("/admin/projects/:projectId/tasks/:taskId/invoices/:id"),Fn=on("/admin/projects/:projectId/tasks/:taskId/invoices/:id/edit"),Un=on("/admin/users"),Sn=on("/admin/users/new"),xn=on("/admin/users/:id"),Mn=on("/admin/users/:id/edit");function On(t,n){for(const e of t){let t=!0;for(const r in n)if(e[r]!==n[r]){t=!1;break}if(t)return e}}function Vn(t,n){const e=[];for(let r=0,i=t.length;r<i;r++){const i=n(t[r],r,t);void 0!==i&&e.push(i)}return e}function Ln(t,n){const e={};for(const r of t)e[n(r)]=r;return e}function Rn(t,n){const e={};for(const r of t){const t=n(r);void 0===e[t]&&(e[t]=[]),e[t].push(r)}return e}function _n(t){return"string"==typeof t}function qn(t,n=null){return[Qt,t,n]}function Wn(t,n=null){return[Jt,t,n]}function Bn(){return[Yt,1]}function zn(t){return[Gn,t]}function Gn(t,n){history.replaceState(t,"")}function Hn(t,n){const e=(e,r)=>n(t(e,r),!0);return function(t){Ot("handler",t),0===Bt.length&&window.addEventListener("popstate",Ht),Bt.push(t)}(e),zt.bind(void 0,e)}nn(un(),function(t){return n=>function(t,n){const e=t.split("/").filter(Boolean);for(let t=0,r=e.length;t<r;t++){const r=e[t];if(!Vt(r))continue;const i=r.substring(1);e[t]=n[i]||""}return e.join("/")}(t,n)}(In())),nn(ln(),tn("Login")),nn(dn(),tn("AdminClients")),nn(fn(),tn("NewAdminClient")),nn(mn(":id"),tn("AdminClient"),{id:an}),nn(pn(":id"),tn("EditAdminClient"),{id:an}),nn(gn(":clientId"),tn("AdminClientAccounts"),{clientId:an}),nn(hn(":clientId"),tn("NewAdminClientAccount"),{clientId:an}),nn(vn(":clientId",":id"),tn("AdminClientAccount"),{clientId:an,id:an}),nn(wn(":clientId",":id"),tn("EditAdminClientAccount"),{clientId:an,id:an}),nn(In(),tn("AdminProjects")),nn(yn(),tn("NewAdminProject")),nn(An(":id"),tn("AdminProject"),{id:an}),nn(bn(":id"),tn("EditAdminProject"),{id:an}),nn(kn(":projectId"),tn("NewAdminProjectInvoice"),{projectId:an}),nn(jn(":projectId",":id"),tn("AdminProjectInvoice"),{projectId:an,id:an}),nn(Cn(":projectId",":id"),tn("EditAdminProjectInvoice"),{projectId:an,id:an}),nn(Dn(":projectId"),tn("AdminTasks"),{projectId:an}),nn(En(":projectId"),tn("NewAdminTask"),{projectId:an}),nn(Tn(":projectId",":id"),tn("AdminTask"),{projectId:an,id:an}),nn(Pn(":projectId",":id"),tn("EditAdminTask"),{projectId:an,id:an}),nn(Nn(":projectId",":taskId"),tn("NewAdminTaskInvoice"),{projectId:an,taskId:an}),nn($n(":projectId",":taskId",":id"),tn("AdminTaskInvoice"),{projectId:an,taskId:an,id:an}),nn(Fn(":projectId",":taskId",":id"),tn("EditAdminTaskInvoice"),{projectId:an,taskId:an,id:an}),nn(Un(),tn("AdminUsers")),nn(Sn(),tn("NewAdminUser")),nn(xn(":id"),tn("AdminUser"),{id:an}),nn(Mn(":id"),tn("EditAdminUser"),{id:an});const Yn={};function Jn(t){return[Zn,t]}function Qn(t){return[Kn,t]}function Zn(t,n){return v(Yn,"progress",t)}function Kn(t,n){const e=e=>n(t(e));return g(Yn,"progress",e),()=>h(Yn,"progress",e)}function Xn(t){return[ne,t]}function te(t){return[ee,t]}function ne(t,n){v(Yn,"notifications",t)}function ee(t,n){const e=e=>n(t(e));return g(Yn,"notifications",e),()=>h(Yn,"notifications",e)}const re=RegExp.prototype.test.bind(/^on[A-Z]/);function ie({port:t,handlers:n},e,r,{lift:i}={}){const s=t.topicsOut,o={...r,...e};for(const c in o){if(!(c in s))continue;let o=n[c],a=e[c];const u=r[c];a?(u||(o=n[c]=t=>o.action(t),t.subscribe(c,o)),void 0!==i&&(a=i(a,u,o.action)),o.action=a):(t.unsubscribe(c,o),delete n[c])}}function se(t){return n=>new oe(t,n)}class oe{constructor(t,n){const[e,r]=function(t){const n={},e={};for(const i in t){const s=t[i];null!=s&&(re(i)?e[(r=i,r.slice(2).toLowerCase())]=s:n[i]=s)}var r;return[n,e]}(n);this.program=t,this.attributes=function(t,n){const e={};for(const r in n){if(!(r in t))continue;const i=t[r],s=n[r];if(!0!==s&&!s(i))throw new TypeError("Invalid attribute");e[r]=i}return e}(e,t.topicsIn),this.events=r}get node(){const[t,n]=this.program,[e]=t(this.attributes,{});return n(e)}create({program:t,attributes:n,events:e},r={}){const i=V(document.createElement("div"),t,[n],!0),s=i.root;return i.handlers={},ie(i,e,{},r),s.__vdom__.app=i,s}patch(t,n,e,r={}){if(n.program!==e.program)return function(t,n,e,r={}){const i=t.parentNode,s=n.create(n,r);return i&&i.replaceChild(s,t),s}(t,n,0,r);const i=t.__vdom__.app;return function({port:t},n,e){const r=t.topicsIn,i={...e,...n};for(let s in i){if(!(s in r))continue;const i=n[s];T(i,e[s])||t.publish(s,i)}}(i,n.attributes,e.attributes),ie(i,n.events,e.events,r),t}unmount({__vdom__:{app:t}}){t.unmount()}}function ce(t,n,...e){return[ue,t,n,e]}function ae(t,n,e){return[le,t,n,e]}function ue(t,n,e,r){t.publish(n,...e)}function le(t,n,e,r){const i=(...t)=>r(e(...t));return t.subscribe(n,i),()=>t.unsubscribe(n,i)}function de(t,n){return[fe,t,n]}function fe(t,n,e){setTimeout((()=>e(n)),t)}function me(t){return(n,...e)=>q("http://www.w3.org/2000/svg",t,n,...e)}const pe=me("svg"),ge=me("symbol"),he=me("use"),ve=me("path"),we=me("circle");function Ie(t,...n){return ge({id:t,viewBox:"0 0 512 512"},...n)}Ie("bell",ve({fill:"none",stroke:"currentColor","stroke-width":"45","stroke-linecap":"round","stroke-linejoin":"round",d:"M256 32c-88 0-160 72-160 160v94c0 20-13 38-32 45-10 3-16 12-16 22v21c0 9 0 14 2 17 1 3 4 6 7 7 3 2 8 2 17 2h364c9 0 14 0 17-2 3-1 6-4 7-7 2-3 2-8 2-17v-21c0-10-6-19-16-22-19-7-32-25-32-45v-94c0-88-72-160-160-160z"}),ve({fill:"none",stroke:"currentColor","stroke-width":"45",d:"M256 480c44 0 80-29 80-64 0-6-1-11-3-16H179c-2 5-3 10-3 16 0 35 36 64 80 64z"})),Ie("search",ve({fill:"currentColor","fill-rule":"evenodd","clip-rule":"evenodd",stroke:"none",d:"M342.8 322h23.1L512 468.4 468.4 512 322 366v-23.2l-7.9-8.2a190.3 190.3 0 1120.5-20.5l8.2 8zM58.5 190.3c0 72.9 58.9 131.7 131.8 131.7S322 263.2 322 190.3c0-73-58.8-131.8-131.7-131.8A131.6 131.6 0 0058.5 190.3z"})),Ie("kebab",we({cx:"256",cy:"472",r:"40",fill:"currentColor"}),we({cx:"256",cy:"256",r:"40",fill:"currentColor"}),we({cx:"256",cy:"40",r:"40",fill:"currentColor"})),Ie("chevron-up",ve({fill:"none",stroke:"currentColor","stroke-width":"40","stroke-linejoin":"round",d:"M16 376l240-240 240 240"})),Ie("chevron-down",ve({fill:"none",stroke:"currentColor","stroke-width":"40","stroke-linejoin":"round",d:"M16 136l240 240 240-240"})),Ie("arrow-left",ve({fill:"currentColor",stroke:"currentColor","stroke-width":"40","stroke-linecap":"round","stroke-linejoin":"round",d:"M171 91L9 256m0 0l162 165M9 256h494"})),Ie("times",ve({fill:"none",stroke:"currentColor","stroke-width":"70",d:"M64 63l385 385m0-385L64 448"})),Ie("external-link",ve({fill:"currentColor","fill-rule":"evenodd",stroke:"none",d:"M57 57v398h398V256h57v199c0 31-26 57-57 57H57c-32 0-57-26-57-57V57C0 26 25 0 57 0h199v57H57zm256 0V0h199v199h-57V97L176 377l-41-41L415 57H313z"})),Ie("clock",we({fill:"none",stroke:"currentColor","stroke-width":"65",cx:"256",cy:"256",r:"223"}),ve({fill:"none",stroke:"currentColor","stroke-width":"65","stroke-linecap":"round","stroke-linejoin":"round",d:"M256 133v123l67 67"})),Ie("translation",ve({fill:"currentColor","fill-rule":"evenodd","clip-rule":"evenodd","stroke-width":"45",d:"M276 304l-59-58 1-1c40-45 69-97 86-152h68V47H209V0h-46v47H0v46h260c-16 45-40 87-74 125-21-24-39-51-54-78H86c17 38 40 73 69 106L37 363l33 33 116-117 73 73 17-48zm131-118h-46L256 465h47l26-69h110l26 69h47L407 186zm-23 62l-38 101h76l-38-101z"})),Ie("person",ve({fill:"none",stroke:"currentColor","stroke-width":"45",d:"M484 506a227 227 0 00-455 0"}),we({fill:"none",stroke:"currentColor","stroke-width":"45",cx:"256",cy:"142",r:"114"})),Ie("people",ve({fill:"none",stroke:"currentColor","stroke-width":"40",d:"M486 374a125 125 0 00-214-88c-8 8-12 18-12 18"}),we({fill:"none",stroke:"currentColor","stroke-width":"40",cx:"361",cy:"174",r:"53"}),ve({fill:"none",stroke:"currentColor","stroke-width":"40",d:"M312 414a143 143 0 10-286 0"}),we({fill:"none",stroke:"currentColor","stroke-width":"40",cx:"169",cy:"184",r:"63"}));const ye=Function.prototype.bind.bind((function(t,n={}){return n.class="icon "+(n.class||""),K(n,pe({class:"svg-icon"},he({href:"#"+t})))}),null);ye("bell");const Ae=ye("search"),be=ye("kebab");ye("chevron-up"),ye("chevron-down");const ke=ye("arrow-left");ye("times");const je=ye("external-link"),Ce=ye("clock"),De=ye("translation"),Ee=ye("person"),Te=ye("people");function Pe(t,...n){const e=t.to;return delete t.to,e&&(t.href=e,t.onClick=t=>{t.preventDefault(),t.stopPropagation(),Jt(e)}),X(t,...n)}function Ne(t,...n){return t.class="has-icon "+(t.class||""),Pe(t,je({style:"font-size: 0.85em"}),...n)}function $e(t){const n=t[0];return ct({class:"dashboard-nav app-nav",role:"navigation","aria-label":"main navigation"},tt({},nt({class:"is-hidden-mobile"},X({href:"#",title:"Search"},Ae())),nt({},function([t,n]){const e=n.active||n.id;switch(t){case"AdminProjects":case"AdminProject":case"EditAdminProject":return function(t,n){return Ue("Add a new project",Fe(),yn({active:t}),n)}(e);case"AdminTasks":case"AdminTask":case"EditAdminTask":return function(t,n,e){return Ue("Add a new task",Fe(),En(t,{active:n}),e)}(n.projectId,e);case"AdminUsers":case"AdminUser":case"EditAdminUser":return function(t,n){return Ue("Add a new user",Fe(),Sn({active:t}),n)}(e);case"AdminClients":case"AdminClient":case"EditAdminClient":return function(t,n){return Ue("Add a new client",Fe(),fn({active:t}),n)}(e);case"AdminClientAccounts":case"AdminClientAccount":case"EditAdminClientAccount":return function(t,n,e){return Ue("Add a new client account",Fe(),hn(t,{active:n}),e)}(n.clientId,e);default:return K({},Fe())}}(t)),nt({},(e="AdminProjects"===n,Ue("Projects",De({styles:{"font-size":"1.1em"}}),In(),e))),nt({},function(t){return Ue("Clients",Te({styles:{"font-size":"1.2em"}}),dn(),t)}("AdminClients"===n)),nt({},function(t){return Ue("Users",Ee({styles:{"font-size":"0.9em"}}),Un(),t)}("AdminUsers"===n))));var e}function Fe(){return K({styles:{"font-size":"1.8em","line-height":"1em"}},"+")}function Ue(t,n,e,r=!1){return r?K({title:t},n):Pe({to:e,title:t},n)}const Se=se(O((function(t,n){return[{},ce(n,"stateChange","ready")]}),(function(t,n,e){return[n,null]}),(function(t){return Z({class:"box is-centered"},Z({class:"box-content has-centered-text"},lt({class:"title has-large-text"},"The page you are looking for doesn’t exist."),Pe({to:un(),class:"button is-primary"},"Go home")))}),(function(t,n){return[]}),{},{stateChange:_n}));const xe="\n  fragment ProjectFields on Project {\n    id\n    clientAccountId\n    name\n    code\n    deadline\n    brief\n    notes\n    status\n\n    tags {\n      id\n    }\n  }\n  ",Me="\n  fragment ProjectErrorFields on ProjectErrors {\n    tagIds\n    name\n    code\n    deadline\n    brief\n    notes\n    status\n  }\n  ",Oe=`\n  query GetProjects {\n    projects {\n      ...ProjectFields\n    }\n  }\n\n  ${xe}\n  `,Ve=`\n  mutation CreateProject($clientAccountId: ID!, $input: ProjectInput!) {\n    createProject(clientAccountId: $clientAccountId, input: $input) {\n      project { ...ProjectFields }\n      errors { ...ProjectErrorFields }\n    }\n  }\n\n  ${xe}\n  ${Me}\n  `,Le=`\n  mutation UpdateProject($id: ID!, $input: ProjectInput!) {\n    updateProject(id: $id, input: $input) {\n      project { ...ProjectFields }\n      errors { ...ProjectErrorFields }\n    }\n  }\n\n  ${xe}\n  ${Me}\n  `,Re=`\n  mutation DeleteProject($id: ID!) {\n    deleteProject(id: $id) {\n      project {\n        ...ProjectFields\n      }\n    }\n  }\n\n  ${xe}\n  `,_e=window.API.send;function qe({tags:t=[],...n}){return n.tagIds=t.map((t=>t.id)),n}async function We(){return(await _e(Oe)).projects.map(qe)}const Be="\n  fragment TaskFields on Task {\n    id\n    projectId\n    userId\n    name\n    deadline\n    catTool\n    notes\n    status\n\n    tags {\n      id\n    }\n  }\n  ",ze="\n  fragment TaskErrorFields on TaskErrors {\n    userId\n    tagIds\n    name\n    deadline\n    catTool\n    notes\n    status\n  }\n  ",Ge=`\n  query GetTasks($projectId: ID) {\n    tasks(projectId: $projectId) {\n      ...TaskFields\n    }\n  }\n\n  ${Be}\n  `,He=`\n  mutation CreateTask($projectId: ID!, $input: TaskInput!) {\n    createTask(projectId: $projectId, input: $input) {\n      task { ...TaskFields }\n      errors { ...TaskErrorFields }\n    }\n  }\n\n  ${Be}\n  ${ze}\n  `,Ye=`\n  mutation UpdateTask($id: ID!, $input: TaskInput!) {\n    updateTask(id: $id, input: $input) {\n      task { ...TaskFields }\n      errors { ...TaskErrorFields }\n    }\n  }\n\n  ${Be}\n  ${ze}\n  `,Je=`\n  mutation DeleteTask($id: ID!) {\n    deleteTask(id: $id) {\n      task {\n        ...TaskFields\n      }\n    }\n  }\n\n  ${Be}\n  `,Qe=window.API.send;function Ze({tags:t=[],...n}){return n.tagIds=t.map((t=>t.id)),n}async function Ke(t){return(await Qe(Ge,{projectId:t})).tasks.map(Ze)}function Xe(t,n){if("function"!=typeof n)throw new TypeError(`"${t}" must be a function`)}function tr(t){if(!t)throw new TypeError("Missing or invalid id")}function nr(t,n,e,r){return Xe("filter",e),void 0!==r&&function(t,n){if(!Number.isInteger(n)||n<1)throw new TypeError(`"${t}" must be a positive integer`)}("limit",r),function(t,n,e,r){return Xe("reducer",e),new Promise(((i,s)=>{let o=!1;const c=()=>o=!0,a=t.transaction(n,"readonly"),u=a.objectStore(n);function l({target:{result:t}}){t&&(r=e(r,t.value,c),o||t.continue())}a.oncomplete=t=>i(r),a.onerror=t=>s(t.target.error);u.openCursor().onsuccess=l}))}(t,n,(function(t,n,i){return e(n)&&(t.push(n),t.length===r&&i()),t}),[])}function er(t,n){return function(t,n,e){return rr(t,"rw",n,e)}(t,n,(t=>t.clear()))}async function rr(t,n,e,r){return Array.isArray(e)||(e=[e]),"r"===n&&(n="readonly"),"rw"===n&&(n="readwrite"),new Promise(((i,s)=>{const o=t.transaction(e,n),c=e.map((t=>o.objectStore(t))),a=r(...c)||[];Array.isArray(a)?(o.oncomplete=()=>i(a.map((t=>t.result))),o.onerror=()=>s(a.map((t=>t.error)))):(o.oncomplete=()=>i(a.result),o.onerror=()=>s(a.error))}))}function ir(t,n,e){return rr(t,"r",n,e)}async function sr(t,n,e){const r=await function(t,n,e=(()=>{})){return new Promise(((r,i)=>{indexedDB||i(new Error("IndexedDB not supported"));const s=indexedDB.open(t,n);s.onupgradeneeded=t=>e(t.target.result,t.newVersion,t.oldVersion),s.onsuccess=t=>r(t.target.result),s.onblocked=t=>i(new Error("Database is blocked")),s.onerror=t=>i(t.target.error)}))}(t,n,e),i={db:r,subs:{}};return r.addEventListener("versionchange",(async function(){or(i),v(i.subs,"@migration")})),i}async function or(t){const{db:n,subs:e}=t;n&&await function(t){return t.close()}(n),t.db=void 0,t.subs={},v(e,"@close")}async function cr(t){const{db:n}=t;await or(t),n&&await function(t){return new Promise(((n,e)=>{const r=indexedDB.deleteDatabase(t.name);r.onsuccess=t=>n(t.target.result),r.onblocked=t=>e(new Error("Database is blocked")),r.onerror=t=>e(t.target.error)}))}(n)}function ar({db:t},n){return function(t,n){return ir(t,n,(t=>t.getAll()))}(t,n)}function ur({db:t},n,e){return function(t,n,e){return ir(t,n,(t=>t.get(e)))}(t,n,e)}async function lr({db:t,subs:n},e,...r){r.forEach((t=>tr(t&&t.id)));const i=await function(t,n,...e){return new Promise(((r,i)=>{const s=1===e.length?e[0]:e,o=t.transaction(n,"readwrite"),c=o.objectStore(n);o.oncomplete=t=>r(s),o.onerror=t=>i(t.target.error);for(const t of e)c.add(t)}))}(t,e,...r);return v(n,e,1===r.length?[i]:i),i}async function dr({db:t,subs:n},e,...r){r.forEach((t=>tr(t&&t.id)));const i=await function(t,n,...e){return new Promise(((r,i)=>{const s=1===e.length?e[0]:e,o=t.transaction(n,"readwrite"),c=o.objectStore(n);o.oncomplete=t=>r(s),o.onerror=t=>i(t.target.error);for(const t of e)c.put(t)}))}(t,e,...r);return v(n,e,1===r.length?[i]:i),i}async function fr({db:t,subs:n},e,r,i){tr(r);const s=await function(t,n,e,r){return new Promise(((i,s)=>{let o;const c=t.transaction(n,"readwrite"),a=c.objectStore(n);c.oncomplete=t=>i(o),c.onerror=t=>s(t.target.error),a.get(e).onsuccess=function({target:{result:t}}){const n={...t,...r,id:e};a.put(n).onsuccess=()=>o=n}}))}(t,e,r,i);return v(n,e,[s]),s}async function mr({db:t,subs:n},e,...r){r.forEach(tr);const i=await function(t,n,...e){return new Promise(((r,i)=>{const s=[],o=t.transaction(n,"readwrite"),c=o.objectStore(n),a=e.length;function u(t,n,e){c.delete(n).onsuccess=()=>s[t]=e}o.oncomplete=t=>r(1===a?s[0]:s),o.onerror=t=>i(t.target.error);for(let t=0;t<a;t++){const n=e[t];c.get(n).onsuccess=e=>u(t,n,e.target.result)}}))}(t,e,...r);return v(n,e,r.map((t=>({id:t,tombstone:!0})))),i}function pr({subs:t},n,e){g(t,n,e)}function gr(t,n,e){!function(t){hr(t,"meta")}(t),function(t){const n=hr(t,"clients");n.createIndex("name","name",{unique:!0}),vr(n)}(t),function(t){const n=hr(t,"clientAccounts");n.createIndex("clientId","clientId"),n.createIndex("name","name"),vr(n)}(t),function(t){const n=hr(t,"invoices");n.createIndex("projectId","projectId"),n.createIndex("taskId","taskId"),vr(n)}(t),function(t){const n=hr(t,"projects");n.createIndex("clientAccountId","clientAccountId"),n.createIndex("name","name",{unique:!0}),n.createIndex("code","code",{unique:!0}),n.createIndex("deadline","deadline"),n.createIndex("status","status"),vr(n)}(t),function(t){hr(t,"tags").createIndex("name","name",{unique:!0})}(t),function(t){const n=hr(t,"tasks");n.createIndex("projectId","projectId"),n.createIndex("userId","userId"),n.createIndex("name","name"),n.createIndex("deadline","deadline"),n.createIndex("status","status"),vr(n)}(t),function(t){const n=hr(t,"users");n.createIndex("isDisabled","isDisabled"),n.createIndex("isActive","isActive"),vr(n)}(t)}function hr(t,n,e="id"){return t.objectStoreNames.contains(n)&&t.deleteObjectStore(n),t.createObjectStore(n,{keyPath:e})}function vr(t){t.createIndex("insertedAt","insertedAt"),t.createIndex("updatedAt","updatedAt")}const wr="\n  fragment UserFields on User {\n    id\n    email\n    role\n    isDisabled\n\n    profile {\n      firstName\n      lastName\n      color\n    }\n  }\n  ",Ir=`\n  mutation SignIn($login: String!, $password: String!) {\n    signIn(login: $login, password: $password) {\n      token\n      user {\n        ...UserFields\n      }\n    }\n  }\n\n  ${wr}\n  `,yr=`\n  mutation CreateSession($token: String!) {\n    createSession(token: $token) {\n      token\n      user {\n        ...UserFields\n      }\n    }\n  }\n\n  ${wr}\n  `,{fetch:Ar,disconnect:br,send:kr}=window.API;function jr(t){const n=localStorage.getItem(Dr(t));return null===n?null:(e=n,JSON.parse(Pr(e)));var e}function Cr(t,n){const e=Dr(t),r=localStorage.getItem(e),i=(s=n,Pr(JSON.stringify(s)));var s;i!==r&&(localStorage.setItem(e,i),v(Er,t,t,n))}function Dr(t){return"#vault#"+t}const Er={},Tr=btoa(location.origin+navigator.userAgent+"VYNseA8BAfW9UIM");function Pr(t){let n="";const e=Tr.length;for(let r=0,i=t.length;r<i;++r)n+=String.fromCharCode(Tr.charCodeAt(r%e)^t.charCodeAt(r));return n}let Nr,$r;async function Fr(){return void 0===Nr&&await async function(){void 0===$r&&($r=async function(){const t={},n=jr("token");if(n){const{user:e,token:r}=await async function(t){return(await Ar(yr,{token:t})).createSession}(n);Cr("token",r),t.user=e}Nr=t}().finally((()=>$r=void 0)));return await $r,Nr}(),Nr}async function Ur(t,n){if(!t||!n)throw new Error("Missing login or password");const{user:e,token:r}=await async function(t,n){return(await Ar(Ir,{login:t,password:n})).signIn}(t,n);return Cr("token",r),Nr={user:e},Nr}async function Sr(){return window.onbeforeunload=t=>t.preventDefault(),await async function(){if(void 0===vi)return;vi=await cr(vi)}(),window.onbeforeunload=void 0,function(t){const n=Dr(t);null!==localStorage.getItem(n)&&(localStorage.removeItem(n),v(Er,t,t,null))}("token"),Nr=void 0,br()}const xr="\n  fragment ClientFields on Client {\n    id\n    name\n    notes\n  }\n  ",Mr="\n  fragment ClientErrorFields on ClientErrors {\n    name\n    notes\n  }\n  ",Or=`\n  query GetClients {\n    clients {\n      ...ClientFields\n    }\n  }\n\n  ${xr}\n  `,Vr=`\n  mutation CreateClient($input: ClientInput!) {\n    createClient(input: $input) {\n      client { ...ClientFields }\n      errors { ...ClientErrorFields }\n    }\n  }\n\n  ${xr}\n  ${Mr}\n  `,Lr=`\n  mutation UpdateClient($id: ID!, $input: ClientInput!) {\n    updateClient(id: $id, input: $input) {\n      client { ...ClientFields }\n      errors { ...ClientErrorFields }\n    }\n  }\n\n  ${xr}\n  ${Mr}\n  `,Rr=`\n  mutation DeleteClient($id: ID!) {\n    deleteClient(id: $id) {\n      client {\n        ...ClientFields\n      }\n    }\n  }\n\n  ${xr}\n  `,_r=window.API.send;async function qr(){return(await _r(Or)).clients}const Wr="\n  fragment ClientAccountFields on ClientAccount {\n    id\n    clientId\n    name\n    notes\n  }\n  ",Br="\n  fragment ClientAccountErrorFields on ClientAccountErrors {\n    name\n    notes\n  }\n  ",zr=`\n  query GetClientAccounts($clientId: ID) {\n    clientAccounts(clientId: $clientId) {\n      ...ClientAccountFields\n    }\n  }\n\n  ${Wr}\n  `,Gr=`\n  mutation CreateClientAccount($clientId: ID, $input: ClientAccountInput!) {\n    createClientAccount(clientId: $clientId, input: $input) {\n      clientAccount { ...ClientAccountFields }\n      errors { ...ClientAccountErrorFields }\n    }\n  }\n\n  ${Wr}\n  ${Br}\n  `,Hr=`\n  mutation UpdateClientAccount($id: ID!, $input: ClientAccountInput!) {\n    updateClientAccount(id: $id, input: $input) {\n      clientAccount { ...ClientAccountFields }\n      errors { ...ClientAccountErrorFields }\n    }\n  }\n\n  ${Wr}\n  ${Br}\n  `,Yr=`\n  mutation DeleteClientAccount($id: ID!) {\n    deleteClientAccount(id: $id) {\n      clientAccount {\n        ...ClientAccountFields\n      }\n    }\n  }\n\n  ${Wr}\n  `,Jr=window.API.send;async function Qr(){return(await Jr(zr)).clientAccounts}const Zr="\n  fragment InvoiceFields on Invoice {\n    id\n    projectId\n    taskId\n    dueDate\n    sentAt\n    receivedAt\n    paidAt\n    total\n    notes\n\n    items {\n      id\n      description\n      quantity\n      price\n    }\n  }\n  ",Kr="\n  fragment InvoiceErrorFields on InvoiceErrors {\n    dueDate\n    sentAt\n    receivedAt\n    paidAt\n    notes\n\n    items {\n      description\n      quantity\n      price\n    }\n  }\n  ",Xr=`\n  query GetInvoices {\n    invoices {\n      ...InvoiceFields\n    }\n  }\n\n  ${Zr}\n  `,ti=`\n  mutation CreateIncomingInvoice($projectId: ID!, $input: InvoiceInput!) {\n    createIncomingInvoice(projectId: $projectId, input: $input) {\n      invoice { ...InvoiceFields }\n      errors { ...InvoiceErrorFields }\n    }\n  }\n\n  ${Zr}\n  ${Kr}\n  `,ni=`\n  mutation CreateOutgoingInvoice($taskId: ID!, $input: InvoiceInput!) {\n    createOutgoingInvoice(taskId: $taskId, input: $input) {\n      invoice { ...InvoiceFields }\n      errors { ...InvoiceErrorFields }\n    }\n  }\n\n  ${Zr}\n  ${Kr}\n  `,ei=`\n  mutation UpdateInvoice($id: ID!, $input: InvoiceInput!) {\n    updateInvoice(id: $id, input: $input) {\n      invoice { ...InvoiceFields }\n      errors { ...InvoiceErrorFields }\n    }\n  }\n\n  ${Zr}\n  ${Kr}\n  `,ri=`\n  mutation DeleteInvoice($id: ID!) {\n    deleteInvoice(id: $id) {\n      invoice {\n        ...InvoiceFields\n      }\n    }\n  }\n\n  ${Zr}\n  `,ii=window.API.send;async function si(){return(await ii(Xr)).invoices}const oi=window.API.send;async function ci(){return(await oi("\n  query GetTags {\n    tags {\n      id\n      name\n      style\n    }\n  }\n  ")).tags}const ai="\n  fragment UserFields on User {\n    id\n    username\n    email\n    role\n    isDisabled\n\n    profile {\n      firstName\n      lastName\n      color\n      isActive\n      status\n      notes\n\n      details {\n        name\n        value\n      }\n    }\n  }\n  ",ui="\n  fragment UserErrorFields on UserErrors {\n    username\n    email\n    role\n    isDisabled\n\n    profile {\n      firstName\n      lastName\n      color\n      isActive\n      status\n      notes\n\n      details {\n        name\n        value\n      }\n    }\n  }\n  ",li=`\n  query GetUsers {\n    users {\n      ...UserFields\n    }\n  }\n\n  ${ai}\n  `,di=`\n  mutation CreateUser($input: UserInput!) {\n    createUser(input: $input) {\n      user { ...UserFields }\n      errors { ...UserErrorFields }\n    }\n  }\n\n  ${ai}\n  ${ui}\n  `,fi=`\n  mutation UpdateUser($id: ID!, $input: UserInput!) {\n    updateUser(id: $id, input: $input) {\n      user { ...UserFields }\n      errors { ...UserErrorFields }\n    }\n  }\n\n  ${ai}\n  ${ui}\n  `,mi=`\n  mutation DeleteUser($id: ID!) {\n    deleteUser(id: $id) {\n      user {\n        ...UserFields\n      }\n    }\n  }\n\n  ${ai}\n  `,pi=window.API.send;async function gi(){return(await pi(li)).users}async function hi(t){const n=await async function(){if(!(await Fr()).user)throw new Error("UNAUTHORIZED");const[t,n,e,r,i,s,o]=await Promise.all([qr(),Qr(),si(),We(),ci(),Ke(),gi()]);return{clients:t,clientAccounts:n,invoices:e,projects:r,tags:i,tasks:s,users:o}}();await Promise.all(Object.entries(n).map((async function([n,e]){await er(t.db,n),await lr(t,n,...e)})));const e=Date.now();return await dr(t,"meta",{id:"synchedAt",value:e}),e}let vi,wi,Ii,yi;async function Ai(){void 0===vi&&(void 0===Ii&&(Ii=async function(){const t=await sr("elliot",2,gr),n=await async function(t){const n=await ur(t,"meta","synchedAt");return n&&n.value}(t);pr(t,"@close",(()=>vi=void 0)),pr(t,"@migration",(()=>window.location.reload())),n||(wi=await hi(t));vi=t}().finally((()=>Ii=void 0))),await Ii)}async function bi(){void 0===yi&&(yi=async function(){await Ai(),(!wi||Date.now()-wi>12e4)&&(wi=await hi(vi))}().finally((()=>yi=void 0))),await yi}async function ki(t,n,e){return await Ai(),void 0===n?ar(vi,t):function({db:t},n,e,r){return nr(t,n,e,r)}(vi,t,n,e)}async function ji(t,n){return await Ai(),ur(vi,t,n)}async function Ci(t,...n){return await Ai(),lr(vi,t,...n)}async function Di(t,n,e){return await Ai(),fr(vi,t,n,e)}async function Ei(t,...n){return await Ai(),mr(vi,t,...n)}async function Ti(t,n){await Ai(),pr(vi,t,n)}async function Pi(t,n){void 0!==vi&&function({subs:t},n,e){h(t,n,e)}(vi,t,n)}function Ni(t,n){if(!Array.isArray(n))throw new TypeError(`"${t}" must be an array.`)}function $i(t,n){if(!(e=n)||"[object Object]"!==xi(e))throw new TypeError(`"${t}" must be an object.`);var e}function Fi(t,n){if("number"!=typeof n||Number.isNaN(n))throw new TypeError(`"${t}" must be a number.`)}function Ui(t,n){if("function"!=typeof n)throw new TypeError(`"${t}" must be a function.`)}function Si(t,n){if(!t.types[n]&&!t.relations[n])throw new RangeError(`Field "${n}" doesn't exist in changeset.`)}const xi=(Mi=Object.prototype.toString).call.bind(Mi);var Mi;const Oi=(t=>t.call.bind(t))(Object.prototype.hasOwnProperty),Vi=RegExp.prototype.test.bind(/^\s*$/);function Li(t){return null==t||""===t||"string"==typeof t&&Vi(t)}function Ri(t,n){if("any"===t||"string"===t&&"string"==typeof n)return[!0,n];if(Li(n))return[!0,null];if("function"==typeof t)return t(n);switch(t){case"id":return function(t){return"number"==typeof t&&Number.isInteger(t)?[!0,String(t)]:"string"!=typeof t||/\s/.test(t)?[!1,t]:[!0,t]}(n);case"string":return function(t){return["string","number","boolean"].includes(typeof t)?[!0,String(t)]:[!1,t]}(n);case"number":return function(t){const n="string"==typeof t?Number(t):t;return"number"!=typeof n||Number.isNaN(n)?[!1,t]:[!0,n]}(n);case"boolean":return function(t){return!0===t||"true"===t?[!0,!0]:!1===t||"false"===t?[!0,!1]:[!1,t]}(n);case"datetime":return function(t){const n=t instanceof Date||"number"==typeof t||"string"==typeof t&&t!==String(Number(t))?new Date(t):NaN;return isNaN(n)?[!1,t]:[!0,n]}(n);default:throw new RangeError(`Unknown type: "${t}".`)}}function _i(t){return function(n){if(!Array.isArray(n))return[!1,n];const e=[];for(const r of n){const[i,s]=Ri(t,r);if(!i)return[!1,n];e.push(s)}return[!0,e]}}function qi(t){return Ui("validator",t),function(n,e,r){return!(e in r.changes)||Li(n)?[]:t(n,e,r)}}function Wi(t){return Ui("fn",t),function(n,e,r){return t(r,e)&&Li(n)?[{code:"blank"}]:[]}}function Bi(t){"number"==typeof t&&(t={min:t,max:t});const{min:n,max:e}=t,r=void 0!==n,i=void 0!==e;if(r&&Fi("min",n),i&&Fi("max",e),r&&i&&n>e)throw new RangeError('"min" can’t be greater than "max".');return qi(((t,s,o)=>{const c=t.length;return r&&c<n?[{code:"tooShort",min:n}]:i&&c>e?[{code:"tooLong",max:e}]:[]}))}function zi(t){return Ni("list",t),qi(((n,e,r)=>t.includes(n)?[]:[{code:"outside",list:t}]))}function Gi(t){return function(t,n){if("[object RegExp]"!==xi(n))throw new TypeError(`"${t}" must be a RegExp.`)}("pattern",t),qi(((n,e,r)=>t.test(n)?[]:[{code:"invalid"}]))}function Hi(t){const n=function(t){const n={};for(const e in Yi){const r=t[e];void 0!==r&&(Fi(e,r),n[e]=r)}return n}(t);return qi(((t,e,r)=>{for(const e in n){const r=n[e];if((0,Yi[e])(t,r))return[{code:"number",type:e,number:r}]}return[]}))}const Yi={is:(t,n)=>t!==n,not:(t,n)=>t===n,greaterThan:(t,n)=>t<=n,greaterOrEqual:(t,n)=>t<n,lessOrEqual:(t,n)=>t>n,lessThan:(t,n)=>t>=n};class Ji{constructor(t,n={}){$i("types",t),$i("data",n);const e={},r={};for(const n in t)e[n]=[],r[n]=[];this._prepare=()=>this,this.isValid=!0,this.types=t,this.relations={},this.required=[],this.data=n,this.changes={},this.params={},this.errors=e,this.validations=r}tap(t){return t(this)||this}prepareWith(t){return Ui("fn",t),this._prepare=t,this}prepare(){return this.isValid&&this._prepare(this)||this}applyChanges(){if(!this.isValid)return this.data;const{data:t,changes:n}=this.prepare(),e={...t};for(const t in n)e[t]=Qi(n[t]);return e}cast(t,n){$i("params",t),Ni("permitted",n);for(const e in t){if(!Oi(t,e))continue;const r=this.params[e]=t[e];if(!n.includes(e))continue;const i=this.types[e],[s,o]=Ri(i,r);s?this.put(e,o):(this.deleteChange(e),this.addError(e,{code:"invalid",type:i}))}return this}castOne(t,n,{required:e=!0}={}){Ui("fn",n),this.relations[t]=["one",n];const r=this.params[t];if(void 0===r)return e&&this.addError(t,{code:"blank"}),this;const i=this.data[t]||{};return(this.changes[t]=n(i,r)).isValid||(this.isValid=!1),this}castMany(t,n,{required:e=!0,primaryKey:r="id"}={}){Ui("fn",n),this.relations[t]=["many",n];const i=this.data[t]||[],s=this.params[t];if(void 0===s)return e&&this.addError(t,{code:"blank"}),this;if(!Array.isArray(i))throw TypeError(`"${t}" data must be a list`);if(!Array.isArray(s))throw TypeError(`"${t}" params must be a list`);return this.changes[t]=s.map((t=>{const e=t[r],s=i.find((t=>t[r]===e))||{},o=n(s,t);return o.isValid||(this.isValid=!1),o})),this}get(t,n){Si(this,t);const e=t in this.changes?this.changes[t]:this.data[t];return void 0!==e?e:n}getChange(t,n){return Si(this,t),t in this.changes?this.changes[t]:n}put(t,n){return Si(this,t),!function(t,n){if(!Array.isArray(t))return t===n;if(!Array.isArray(n)||t.length!==n.length)return!1;for(let e=0,r=t.length;e<r;e++)if(t[e]!==n[e])return!1;return!0}(n,this.data[t])?this.changes[t]=n:delete this.changes[t],this}deleteChange(t){return Si(this,t),delete this.changes[t],this}addError(t,...n){return Si(this,t),0!==n.length&&(this.errors[t].push(...n),this.isValid=!1),this}require(t){Ni("keys",t);const n=this.required,e=this.errors,r=function(t,n,e){return Li(t)?[{code:"blank"}]:[]};for(const i of t){if(Si(this,i),-1===n.indexOf(i)&&n.push(i),e[i].some((t=>"invalid"===t.code)))continue;const t=r(this.get(i),i,this);this.addError(i,...t)}return this}validate(t,n){Si(this,t),Ui("fn",n);const e=n(this.get(t),t,this);return this.validations[t].push(n),this.addError(t,...e),this}}function Qi(t){return Array.isArray(t)?t.map(Qi):t instanceof Ji?t.applyChanges():t}const Zi=864e5,Ki=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],Xi=["January","February","March","April","May","June","July","August","September","October","November","December"],ts=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function ns(t,n="full"){switch("string"==typeof t&&(t=new Date(t)),n){case"short":return t.getDate().toString().padStart(2,"0")+"/"+(t.getMonth()+1).toString().padStart(2,"0")+"/"+t.getFullYear();case"compact":return ts[t.getMonth()]+" "+t.getDate()+", "+t.getFullYear();default:return Ki[t.getDay()]+", "+Xi[t.getMonth()]+" "+t.getDate()+", "+t.getFullYear()}}function es(t){return"string"==typeof t&&(t=new Date(t)),t.getHours().toString().padStart(2,"0")+":"+t.getMinutes().toString().padStart(2,"0")+"hs"}function rs(t,n="full"){return"string"==typeof t&&(t=new Date(t)),ns(t,n)+" "+es(t)}function is(t,n="00:00"){if(!as(t))throw new TypeError("Invalid date string");if(!us(n))throw new TypeError("Invalid time string");const e=t.split("-").concat(n.split(":"));return e[1]-=1,new Date(...e)}function ss(t){return t?("string"==typeof t&&(t=new Date(t)),t.getFullYear()+"-"+(t.getMonth()+1).toString().padStart(2,"0")+"-"+t.getDate().toString().padStart(2,"0")):""}function os(t){return t?("string"==typeof t&&(t=new Date(t)),t.getHours().toString().padStart(2,"0")+":"+t.getMinutes().toString().padStart(2,"0")):""}function cs(t){if("string"==typeof t&&(t=new Date(t)),t instanceof Date&&(t=t.getTime()),"number"!=typeof t)throw new TypeError("Invalid timestamp");const n=Date.now();return Math.floor((t-n)/Zi)}function as(t){try{return t===new Date(t).toISOString().split("T")[0]}catch(t){return!1}}function us(t){if("string"!=typeof t||!/^\d{2}:\d{2}$/.test(t))return!1;const[n,e]=t.split(":");return!(parseInt(n)>23||parseInt(e)>59)}function ls(t,n){return"number"!=typeof t&&"string"!=typeof t||(t=new Date(t)),"number"!=typeof n&&"string"!=typeof n||(n=new Date(n)),t.getFullYear()===n.getFullYear()&&t.getMonth()===n.getMonth()&&t.getDate()===n.getDate()}function ds(t){return ls(t,Date.now()-Zi)}function fs(t){return ls(t,Date.now())}function ms(t){return ls(t,Date.now()+Zi)}function ps(){return qi(((t,n,e)=>as(t)?[]:[{code:"invalid"}]))}const gs=["clientAccountId","name"],hs=["tagIds","code","date","time","brief","notes","status"],vs=["PENDING","IN_PROGRESS","COMPLETED"],ws={id:"id",clientId:"id",clientAccountId:"id",tagIds:_i("id"),name:"string",code:"string",date:"string",time:"string",deadline:"string",brief:"string",notes:"string",status:"string"};function Is({...t}={},n={}){if(t.tagIds||(t.tagIds=(t.tags||[]).map((t=>t.id))),t.clientAccount){const{id:n,clientId:e}=t.clientAccount;t.clientId=e,t.clientAccountId=n}return new Ji(ws,t).cast(n,[...gs,...hs]).require(gs).validate("name",Bi({max:255})).validate("code",Bi({max:255})).validate("date",ps()).validate("time",qi(((t,n,e)=>us(t)?[]:[{code:"invalid"}]))).validate("brief",Bi({max:1024})).validate("notes",Bi({max:4096})).validate("status",zi(vs)).prepareWith(ys)}function ys(t){const n=t.changes;if("date"in n||"time"in n){const n=t.get("date"),e=t.get("time")||"00:00",r=n?is(n,e).toISOString():null;t.put("deadline",r)}return t}const As=["projectId","name"],bs=["userId","tagIds","date","time","catTool","notes","status"],ks=["PENDING","IN_PROGRESS","COMPLETED"],js={id:"id",projectId:"id",userId:"id",tagIds:_i("id"),name:"string",date:"string",time:"string",deadline:"string",catTool:"string",notes:"string",status:"string"};function Cs(t){const n=t.changes;if("date"in n||"time"in n){const n=t.get("date"),e=t.get("time")||"00:00",r=n?is(n,e).toISOString():null;t.put("deadline",r)}return t}function Ds(t,n){if(!(t instanceof Ji))throw new TypeError("Invalid changeset");return Es(t,n)}function Es(t,n){if(!t||!n)return t;const{types:e,relations:r}=t;for(const r in e)t.addError(r,...n[r]||[]);for(const e in r){const[i]=r[e],s=n[e],o=t.getChange(e);if("one"===i)Es(o,s);else if("many"===i)for(let t=0,n=o.length;t<n;t++)Es(o[t],s[t])}return t}function Ts(t,n){if(null===n)return[];const e=[],r={};for(const n of t)r[n.id]=e.length,e.push(n);for(const t of n){const n=r[t.id],i=void 0!==n;t.tombstone?i&&e.splice(n,1):i?e.splice(n,1,t):e.push(t)}return e}async function Ps(t){return ki("tags",t)}function Ns(t){const{...n}=t.prepare().changes;return delete n.clientAccountId,delete n.clientId,delete n.date,delete n.time,n}function $s(t={},n={}){return Is(t,n)}async function Fs(t={}){const n=$s({},t);if(!n.isValid)throw n;const e=n.get("clientAccountId"),r=Ns(n),{project:i,errors:s}=await async function(t,n){const e=(await _e(Ve,{clientAccountId:t,input:n})).createProject;return e.project&&(e.project=qe(e.project)),e}(e,r);if(s)throw Ds(n,s);return Ci("projects",i)}async function Us(t,n={}){const e=$s(t,n);if(!e.isValid)throw e;const r=e.get("id"),i=Ns(e),{project:s,errors:o}=await async function(t,n){const e=(await _e(Le,{id:t,input:n})).updateProject;return e.project&&(e.project=qe(e.project)),e}(r,i);if(o)throw Ds(e,o);return Di("projects",r,s)}async function Ss(t){return await async function(t){return qe((await _e(Re,{id:t})).deleteProject.project)}(t),Ei("projects",t)}function xs(t){const{...n}=t.prepare().changes;return delete n.projectId,delete n.date,delete n.time,n}function Ms(t){return ki("tasks",t)}function Os(t={},n={}){return function({...t}={},n={}){return t.tagIds||(t.tagIds=(t.tags||[]).map((t=>t.id))),new Ji(js,t).cast(n,[...As,...bs]).require(As).validate("name",Bi({max:255})).validate("date",Gi(/^\d{4}-\d{2}-\d{2}$/)).validate("time",Gi(/^\d\d:\d\d$/)).validate("catTool",Bi({max:255})).validate("notes",Bi({max:4096})).validate("status",zi(ks)).prepareWith(Cs)}(t,n)}async function Vs(t={}){const n=Os({},t);if(!n.isValid)throw n;const e=n.get("projectId"),r=xs(n),{task:i,errors:s}=await async function(t,n){const e=(await Qe(He,{projectId:t,input:n})).createTask;return e.task&&(e.task=Ze(e.task)),e}(e,r);if(s)throw Ds(n,s);return Ci("tasks",i)}async function Ls(t,n={}){const e=Os(t,n);if(!e.isValid)throw e;const r=e.get("id"),i=xs(e),{task:s,errors:o}=await async function(t,n){const e=(await Qe(Ye,{id:t,input:n})).updateTask;return e.task&&(e.task=Ze(e.task)),e}(r,i);if(o)throw Ds(e,o);return Di("tasks",r,s)}async function Rs(t){return await async function(t){return Ze((await Qe(Je,{id:t})).deleteTask.task)}(t),Ei("tasks",t)}const _s=["projectId","taskId","dueDate","sentAt","receivedAt","paidAt","notes"],qs=["description","quantity","price"],Ws={id:"id",projectId:"id",taskId:"id",dueDate:"string",sentAt:"string",receivedAt:"string",paidAt:"string",notes:"string",items:_i("any")},Bs={description:"string",quantity:"number",price:"number"};function zs(t={},n){return new Ji(Ws,t).cast(function({...t}){const n=["dueDate","sentAt","receivedAt","paidAt"];for(const e of n)""===t[e]&&(t[e]=null);return t}(n),_s).castMany("items",((t,e)=>function(t={},n={},e){return new Ji(Bs,t).cast(n,qs).require(qs).validate("description",Bi({max:4096})).validate("description",(r=e||[],qi(((t,n,e)=>r.filter((e=>e[n]===t)).length>1?[{code:"taken"}]:[])))).validate("quantity",Hi({greaterThan:0})).validate("price",Hi({greaterThan:0}));var r}(t,e,n.items)),{required:!0}).validate("projectId",Wi((t=>!t.get("taskId")))).validate("taskId",Wi((t=>!t.get("projectId")))).validate("dueDate",ps()).validate("sentAt",ps()).validate("receivedAt",ps()).validate("paidAt",ps()).validate("notes",Bi({max:4096})).validate("items",Bi({min:1})).prepareWith(Gs)}function Gs(t){const n=t.getChange("dueDate"),e=t.getChange("sentAt"),r=t.getChange("receivedAt"),i=t.getChange("paidAt");return n&&t.put("dueDate",is(n).toISOString()),e&&t.put("sentAt",is(e).toISOString()),r&&t.put("receivedAt",is(r).toISOString()),i&&t.put("paidAt",is(i).toISOString()),t}function Hs(t){const{items:n,...e}=t.prepare().changes;return delete e.projectId,delete e.taskId,n.length>0&&(e.items=n.map((t=>t.applyChanges()))),e}function Ys(t){return ki("invoices",t)}function Js(t={},n={}){return zs(t,n)}async function Qs(t={}){const n=t.projectId,e=Js({},t);if(!n||!e.isValid)throw e;const r=Hs(e),{invoice:i,errors:s}=await async function(t,n){return(await ii(ti,{projectId:t,input:n})).createIncomingInvoice}(n,r);if(s)throw Ds(e,s);return Ci("invoices",i)}async function Zs(t={}){const n=t.taskId,e=Js({},t);if(!n||!e.isValid)throw e;const r=Hs(e),{invoice:i,errors:s}=await async function(t,n){return(await ii(ni,{taskId:t,input:n})).createOutgoingInvoice}(n,r);if(s)throw Ds(e,s);return Ci("invoices",i)}async function Ks(t,n={}){const e=Js(t,n);if(!e.isValid)throw e;const r=e.get("id"),i=Hs(e),{invoice:s,errors:o}=await async function(t,n){return(await ii(ei,{id:t,input:n})).updateInvoice}(r,i);if(o)throw Ds(e,o);return Di("invoices",r,s)}async function Xs(t){return await async function(t){return(await ii(ri,{id:t})).deleteInvoice.invoice}(t),Ei("invoices",t)}function to(t){return Ti("invoices",t),()=>Pi("invoices",t)}const no=window.requestAnimationFrame,eo=document.getElementById("app");function ro(t){return[oo,t]}function io(t){return[co,t]}function so(t,n={}){return[ao,t,n]}function oo(t){t&&no((function(){const n=eo.querySelector(t);n&&(n.scrollTop=0)}))}function co(t){document.getElementById(t).scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})}function ao(t,{capture:n,exceptions:e},r){const i=n&&e?({target:n})=>n.closest(e)||r(t):()=>r(t);return document.addEventListener("click",i,n),()=>document.removeEventListener("click",i,n)}const uo=(window||global||void 0).Error,lo=t=>({tag:lo,data:t}),fo=t=>({tag:fo,error:t}),mo=go.bind(void 0,lo),po=go.bind(void 0,fo);function go(t,n){return vo(n),n.tag===t}function ho(t,n){return vo(t),mo(t)?t.data:n}function vo(t){if(!function(t){return t&&(t.tag===lo||t.tag===fo)}(t))throw new uo("Not a Result instance")}function wo(t,n){return[Io,t,n]}function Io([t,...n],e,r){return void 0===e?t(...n):t(...n).then((t=>lo(t))).catch((t=>fo(t))).then((t=>r(e(t))))}const yo=["name"],Ao=["notes"],bo={id:"id",name:"string",notes:"string"};const ko=["clientId","name"],jo=["notes"],Co={id:"id",clientId:"id",name:"string",notes:"string"};function Do(t){return{...t.prepare().changes}}function Eo(t){return ki("clients",t)}function To(t={},n={}){return function(t={},n={}){return new Ji(bo,t).cast(n,[...yo,...Ao]).require(yo).validate("name",Bi({max:255})).validate("notes",Bi({max:4096}))}(t,n)}async function Po(t={}){const n=To({},t);if(!n.isValid)throw n;const e=Do(n),{client:r,errors:i}=await async function(t){return(await _r(Vr,{input:t})).createClient}(e);if(i)throw Ds(n,i);return Ci("clients",r)}async function No(t,n={}){const e=To(t,n);if(!e.isValid)throw e;const r=e.get("id"),i=Do(e),{client:s,errors:o}=await async function(t,n){return(await _r(Lr,{id:t,input:n})).updateClient}(r,i);if(o)throw Ds(e,o);return Di("clients",r,s)}async function $o(t){return await async function(t){return(await _r(Rr,{id:t})).deleteClient.client}(t),Ei("clients",t)}function Fo(t){const{...n}=t.prepare().changes;return delete n.clientId,n}function Uo(t){return ki("clientAccounts",t)}function So(t={},n={}){return function(t={},n={}){return new Ji(Co,t).cast(n,[...ko,...jo]).require(ko).validate("name",Bi({max:255})).validate("notes",Bi({max:4096}))}(t,n)}async function xo(t={}){const n=So({},t);if(!n.isValid)throw n;const e=n.get("clientId"),r=Fo(n),{clientAccount:i,errors:s}=await async function(t,n){return(await Jr(Gr,{clientId:t,input:n})).createClientAccount}(e,r);if(s)throw Ds(n,s);return Ci("clientAccounts",i)}async function Mo(t,n={}){const e=So(t,n);if(!e.isValid)throw e;const r=e.get("id"),i=Fo(e),{clientAccount:s,errors:o}=await async function(t,n){return(await Jr(Hr,{id:t,input:n})).updateClientAccount}(r,i);if(o)throw Ds(e,o);return Di("clientAccounts",r,s)}async function Oo(t){return await async function(t){return(await Jr(Yr,{id:t})).deleteClientAccount.clientAccount}(t),Ei("clientAccounts",t)}function Vo(t){return(t||"").split("\n").filter(Boolean).map((t=>pt({},t)))}function Lo(t,n){return t.localeCompare(n,{sensitivity:"base",numeric:!0})}function Ro(t,n){return Lo(t.name,n.name)}function _o(t,n){return"COMPLETED"===t.status&&"COMPLETED"!==n.status?1:"COMPLETED"!==t.status&&"COMPLETED"===n.status?-1:Date.parse(t.deadline)-Date.parse(n.deadline)}async function qo(){const[t,n,e,r,i,s]=await Promise.all([Eo(),Uo(),Ys((t=>t.projectId)),ki("projects",o),Ps(),Ms()]);var o;return{clients:t,clientAccounts:n,invoices:e,projects:r,tags:i,tasks:s}}async function Wo(){return await bi(),qo()}function Bo({clients:t,clientAccounts:n,projects:e,tags:r},i){return{project:i?On(e,{id:i}):{},clients:t,clientAccounts:n,tags:r}}function zo(t){return wo([Wo],t)}function Go(t,n,e){return wo(t.id?[Us,t,n]:[Fs,n],e)}function Ho(t,n,e){return wo([Us,t,n],e)}function Yo(t,n){return wo([Ss,t],n)}function Jo(t,n){return Ti("projects",e=e=>n(t(e))),()=>Pi("projects",e);var e}function Qo(t,n,e){return wo(t.id?[Ks,t,n]:[Qs,n],e)}function Zo(t,n){return wo([Xs,t],n)}function Ko(t,n){return to((e=>{if(null===e)return n(t(null));(e=e.filter((t=>t.tombstone||t.projectId))).length>0&&n(t(e))}))}function Xo([t]){return ro("AdminProjects"===t?".view.grid-sidebar":"AdminProject"===t?".view.grid-main":"")}function tc({title:t,message:n,action:e}){return function(...t){return Z({class:"box is-centered"},Z({class:"box-content has-centered-text"},...t))}(lt({class:"title has-large-text"},t),pt({class:"subtitle"},n),e)}function nc(t,n){return Pe({to:n,class:"button is-primary"},t)}function ec(t){return wo([Fr],t)}function rc(t,n,e){return wo([Ur,t,n],e)}function ic(){return[sc]}function sc(){const{pathname:t,search:n,hash:e}=window.location,r=t+n+e;Sr(),Jt(ln({r:r}))}const oc=(window||global||void 0).Error,cc=()=>({tag:cc}),ac=()=>({tag:ac}),uc=t=>({tag:uc,data:t}),lc=t=>({tag:lc,error:t}),dc=[cc,ac,uc,lc];gc.bind(void 0,cc);const fc=gc.bind(void 0,ac),mc=gc.bind(void 0,uc),pc=gc.bind(void 0,lc);function gc(t,n){return wc(n),n.tag===t}function hc(t,n){return wc(t),mc(t)?uc(n(t.data)):t}function vc(t,n){return wc(t),mc(t)?t.data:n}function wc(t){if(!function(t){return t&&dc.includes(t.tag)}(t))throw new oc("Not a RemoteData instance")}const Ic=["firstName","lastName","username","email"],yc=["isDisabled","isActive","status","notes"],Ac=/^[a-z\d][a-z\d_-]+$/,bc=/^[^@\s]+@[^@\s]+\.[^@\s]+$/,kc={id:"id",isDisabled:"boolean",firstName:"string",lastName:"string",username:"string",email:"string",isActive:"boolean",status:"string",notes:"string"};function jc(t){const n=t.profile||{};return{id:t.id,isDisabled:t.isDisabled,firstName:n.firstName,lastName:n.lastName,username:t.username,email:t.email,isActive:n.isActive,status:n.status,notes:n.notes}}function Cc({profile:{firstName:t,lastName:n}}){return t+" "+n}function Dc(t){const n=t.get("isActive");return null==n&&t.put("isActive",!0),t}function Ec({profile:{firstName:t,color:n}}){return K({class:"avatar",style:`background: ${n}`},t[0])}function Tc(t,n=!1){const e=n?function({profile:{firstName:t,lastName:n}}){return t+" "+n[0]+"."}(t):Cc(t);return Pe({to:xn(t.id),class:"avatar-flag"},Ec(t),K({class:"avatar-flag-label"},e))}const Pc=se(O((function(t){return[{isActive:!1,currentUser:ac()},ec(Nc)]}),(function(t,n,e){switch(t.tag){case Nc:return function({result:t},n,e){const r=ho(t,{}).user;return n.currentUser=r?uc(r):lc(),[n,null]}(t,n);case $c:return n.isActive=!n.isActive,[n,null];case Fc:return n.isActive=!1,[n,null];case Uc:return[n,ic()];default:throw"Unmatched message"}}),(function({isActive:t,currentUser:n}){if(!mc(n))return ct({});const e=vc(n,null);return ct({class:"user-menu",onClick:t?void 0:Ft($c())},Ec(e),t&&tt({class:"user-menu-items"},at({class:"user-menu-title"},Cc(e)),nt({},Pe({to:xn(e.id)},"Account")),nt({},Pe({onClick:Ft(Uc())},"Logout"))))}),(function({isActive:t},n){return t?[so(Fc(),{capture:!0})]:[]}),{},{}));const Nc=t=>({tag:Nc,result:t}),$c=()=>({tag:$c}),Fc=()=>({tag:Fc}),Uc=()=>({tag:Uc});function Sc(t){return at({class:"app-header grid-header"},lt({class:"app-header-title"},t),Pc())}function xc(t,n){return at({class:"app-header is-subheader"},n&&kt({class:"button is-link",onClick:Ft(n)},ke()),lt({class:"app-header-title is-truncated"},t))}function Mc(t){return"UNAUTHORIZED"===t.message}function Oc(t){const{title:n,message:e}=function(t={}){switch(t&&t.message){case"UNAUTHORIZED":return{title:"Not authorized.",message:"You are not authorized to view this page."};case"NOT_FOUND":return{title:"Not found.",message:"The page you are looking for doesn’t exist."};default:return{title:"An error occured.",message:"Check your internet connection and try reloading the page or contact an administrator is the error persists."}}}(t);return tc({title:n,message:e,action:nc("Go home",un())})}function Vc(){return tt({class:"list"},Lc(),Lc(),Lc(),Lc())}function Lc(){return nt({class:"list-item"},Z({class:"list-item-face"},at({class:"list-item-header"},ft({class:"title is-mock"})),Z({class:"list-item-status"},K({class:"tag is-mock"}))))}function Rc(){return Z({class:"details-mock"},at({class:"details-mock-header"},lt({class:"title is-mock"})),ut({class:"details-mock-body"}))}function _c(){return Z({class:"directory"},tt({class:"directory-list"},nt({class:"directory-group"},K({class:"directory-group-label"},""),tt({class:"directory-list"},qc(),qc(),qc(),qc(),qc(),qc()))))}function qc(){return nt({class:"directory-item-mock"},K({class:"text-mock"}))}function Wc(t){return Z({class:"viewport"},Z({class:"view is-active"},Sc("Projects"),Oc(t)))}function Bc([t]){return Z({class:"viewport grid is-two"},Sc("Projects"),ut({class:"view grid-sidebar",classes:{"is-active":"AdminProject"!==t}},Sc("Projects"),Vc()),function(t){return ut({class:"view grid-main",classes:{"is-active":t}},xc("Project"),Rc())}("AdminProject"===t))}function zc(t,n){return Z({classes:{backdrop:!0,"is-active":t},aria:{hidden:"true"},onClick:n?Ft(n):void 0})}const Gc=["AdminProjects","AdminProject","NewAdminProject","EditAdminProject","AdminProjectInvoice","NewAdminProjectInvoice","EditAdminProjectInvoice"];function Hc([t,{projectId:n,id:e,active:r}]){const i="AdminProject"===t,s="AdminProjectInvoice"===t,o="NewAdminProject"===t||"EditAdminProject"===t,c="NewAdminProjectInvoice"===t||"EditAdminProjectInvoice"===t;return{projectId:n=s||c?r||n:o?r||e:i?e:void 0,invoiceId:s?e:void 0,formProjectId:o?e:void 0,formInvoiceId:c?e:void 0,isList:"AdminProjects"===t,isDetails:i,isInvoice:s,isForm:o,isInvoiceForm:c}}function Yc(t,n,...e){return ct({class:"section-menu",onClick:t?void 0:Ft(n)},be({class:"section-menu-button"}),t&&tt({class:"section-menu-items"},...e))}function Jc(t=[]){return Z({class:"tags"},...t.map((({name:t,style:n})=>Qc({style:n},t))))}function Qc({type:t,class:n,...e},...r){const i=t?`tag is-${t}`:"tag";return K({...e,class:n=n?i+" "+n:i},...r)}function Zc(t){return"COMPLETED"===t?K({class:"tag is-success"},"Completed"):K({class:"tag"},"In progress")}function Kc(t,n="auto",e=!1){if(!t)throw new Error("Missing datetime");const r=new Date(t),i=cs(r);"auto"===n&&(n=i<1?"danger":i<7?"warning":null);const s=e?rs(r,"compact"):ds(t)?"Yesterday at "+es(t):fs(t)?"Today at "+es(t):ms(t)?"Tomorrow at "+es(t):i<1?ns(r,"compact"):i<2?"1 day left":i<7?`${i} days left`:ns(r,"compact");return st({datetime:t,title:rs(r),class:"tag"+(n?` is-${n}`:"")},Ce(),K({},s))}const Xc=["NOT_PAID","NOT_SENT","SENT","PAID"];function ta({dueDate:t,paidAt:n}){if(!t)return null;const[e,r]=n?["success",!0]:["auto",!1];return function(t,n="auto",e=!1){if(!t)throw new Error("Missing datetime");const r=new Date(t),i=cs(r);"auto"===n&&(n=i<1?"danger":i<7?"warning":null);const s=e?ns(r,"compact"):ds(r)?"Yesterday":fs(r)?"Today":ms(r)?"Tomorrow":i<1?ns(r,"compact"):i<2?"1 day left":i<7?`${i} days left`:ns(r,"compact");return st({date:r,title:ns(r),class:"tag"+(n?` is-${n}`:"")},Ce(),K({},s))}(t,e,r)}function na({paidAt:t,receivedAt:n,sentAt:e},r=!1){const[i,s,o]=t?["success","Paid",`Paid on ${ns(t,"compact")}`]:n?[void 0,"Received",`Received on ${ns(n,"compact")}`]:e?[void 0,"Sent",`Sent on ${ns(e,"compact")}`]:["danger","Not sent","Not sent"];return r?Qc({type:i},o):Qc({type:i,title:o},s)}function ea(t){if(!t||0===t.length)return null;if(!Array.isArray(t))throw TypeError("invoices must be a list");const n=function(t){return t.map(ra).reduce(ia,"PAID")}(t),[e,r]="PAID"===n?[void 0,"$ Paid"]:"SENT"===n?["warning","$ Sent"]:"NOT_PAID"===n?["danger","$ Not paid"]:["danger","$ Not sent"];return Qc({type:e,class:"is-transparent"},r)}function ra({dueDate:t,sentAt:n,paidAt:e}){return e?"PAID":n?t&&Date.parse(t)<Date.now()?"NOT_PAID":"SENT":"NOT_SENT"}function ia(t,n){const e=Xc.indexOf(t),r=Xc.indexOf(n);if(-1===e||-1===r)throw RangeError("Unknown payment status");return e<r?t:n}const sa=se(O((function({projects:t,activeId:n},e){return[{activeId:n,projects:t,itemWithMenu:null},null]}),(function(t,n,e){switch(t.tag){case oa:return n.projects=t.projects,[n,null];case ca:return n.activeId=t.id,[n,null];case aa:return function({id:t,status:n},e,r){const i=On(e.projects,{id:t});return i?[e,Ho(i,{status:n},ua)]:[e,null]}(t,n);case ua:return function({result:t},n,e){return po(t)?[n,Xn({type:"danger",message:"An error occured and the changes couldn’t be saved. Please try again."})]:[n,null]}(t,n);case la:return[n,Yo(t.id,da)];case da:return function({result:t},n,e){if(po(t))return[n,Xn({type:"danger",message:"An error occured and the project couldn’t be deleted. Please try again."})];const{id:r}=ho(t,null);return r===n.activeId?[n,Wn(In())]:[n,null]}(t,n);case fa:return n.itemWithMenu=n.itemWithMenu!==t.id?t.id:null,[n,null];case ma:return n.itemWithMenu=null,[n,null];default:throw"Unmatched message"}}),(function({projects:t,activeId:n,itemWithMenu:e}){return J("ul",{class:"list"},...t.map((t=>[t.id,pa(t,n,e)])))}),(function({itemWithMenu:t},n){const e=[ae(n,"projects",oa),ae(n,"activeId",ca)];t&&e.push(so(ma(),{capture:!0}));return e}),{projects:Array.isArray,activeId:_n},{}));const oa=t=>({tag:oa,projects:t}),ca=t=>({tag:ca,id:t}),aa=(t,n)=>({tag:aa,id:t,status:n}),ua=t=>({tag:ua,result:t}),la=t=>({tag:la,id:t}),da=t=>({tag:da,result:t}),fa=t=>({tag:fa,id:t}),ma=()=>({tag:ma});function pa(t,n,e){const{id:r,status:i}=t;return nt({id:r,classes:{"list-item":!0,"is-active":r===n}},function(t,n,e,r){return Yc(r,fa(t),nt({},Pe({to:Dn(t)},"Tasks")),nt({},function(t,n){return"COMPLETED"===n?Pe({onClick:Ft(aa(t,"IN_PROGRESS"))},"Mark as in progress"):Pe({onClick:Ft(aa(t,"COMPLETED"))},"Mark as completed")}(t,e)),nt({},Pe({to:kn(t)},"Add invoice")),nt({},Pe({to:bn(t,{active:n})},"Edit project")),nt({},Pe({onClick:Ft(la(t))},"Delete project")))}(r,n,i,r===e),Pe({to:An(r),class:"list-item-face"},function({name:t,code:n,clientAccount:e,tags:r}){return at({class:"list-item-header"},Jc(r||[]),function(t,n){return t?ft({class:"title has-subtitle is-mute is-truncated"},gt({},t)," | ",n):ft({class:"title has-subtitle is-truncated"},n)}(n,t),mt({class:"subtitle is-truncated"},function({clientId:t,id:n,name:e}){return Ne({to:vn(t,n)},K({},e))}(e)))}(t),function({id:t,status:n,deadline:e,tasks:r,invoices:i}){const s=r.length,o=r.filter((t=>"COMPLETED"===t.status)).length;return Z({class:"list-item-status"},"COMPLETED"===n?Zc(n):e&&Kc(e),Ne({to:Dn(t)},gt({},`${o} / ${s} tasks`)),K({styles:{margin:"0","margin-left":"auto"}}),ea(i))}(t)))}const ga=(t=>t.call.bind(t))(Object.prototype.toString),ha=(t=>t.call.bind(t))(Object.prototype.hasOwnProperty);function va(t){return t&&"[object Object]"===ga(t)}function wa(...t){t=t.filter(Boolean);const n={};for(const e of t)for(const t in e)ha(e,t)&&(n[t]=e[t]);return n}function Ia(t){return"auto"===t?{min:void 0,max:void 0}:"number"==typeof t?{min:t,max:t}:t||{}}function ya(t,{compact:n=!1,precision:e="auto"}={}){const{max:r,min:i}=Ia(e),s={notation:n?"compact":"standard",minimumFractionDigits:i,maximumFractionDigits:r};return new Intl.NumberFormat("en-US",s).format(+t)}function Aa(t,{compact:n=!1,precision:e=2}={}){const{max:r,min:i}=Ia(e),s={notation:n?"compact":"standard",style:"currency",currency:"USD",minimumFractionDigits:i,maximumFractionDigits:r};return new Intl.NumberFormat("en-US",s).format(+t)}const ba=se(O((function({invoices:t},n){return[{invoices:ka(t),itemWithMenu:null},null]}),(function(t,n,e){switch(t.tag){case ja:return n.invoices=ka(t.invoices),[n,null];case Ca:return[n,Zo(t.id,Da)];case Da:return function({result:t},n,e){return po(t)?[n,Xn({type:"danger",message:"An error occured and the invoice couldn’t be deleted. Please try again."})]:[n,null]}(t,n);case Ea:return n.itemWithMenu=n.itemWithMenu!==t.id?t.id:null,[n,null];case Ta:return n.itemWithMenu=null,[n,null];case Pa:return[n,Wn(t.path)];default:throw"Unmatched message"}}),(function({invoices:t,itemWithMenu:n}){return jt({class:"invoice-table table is-fullwidth"},Ct({},Tt({},Pt({},"Status"),Pt({},"Due date"),Pt({},"Payment"),Pt({}))),J("tbody",{},...t.map((t=>[t.id,Na(t,n)]))),Et({},Tt({},Pt({}),Pt({}),Pt({},"Total: ",Aa(function(t){return t.reduce(((t,n)=>t+Number(n.total)),0)}(t))),Pt({}))))}),(function({itemWithMenu:t},n){const e=[ae(n,"invoices",ja)];t&&e.push(so(Ta(),{capture:!0}));return e}),{invoices:Array.isArray},{}));function ka([...t]){return t.sort(((t,n)=>Date.parse(t.dueDate)-Date.parse(n.dueDate)))}const ja=t=>({tag:ja,invoices:t}),Ca=t=>({tag:Ca,id:t}),Da=t=>({tag:Da,result:t}),Ea=t=>({tag:Ea,id:t}),Ta=()=>({tag:Ta}),Pa=t=>({tag:Pa,path:t});function Na(t,n){const e=jn(t.projectId,t.id),r={onClick:Ft(Pa(e))};return Tt({},Nt(r,na(t)),Nt(r,ta(t)),Nt(r,Aa(t.total)),Nt({},function({projectId:t,id:n},e){return Yc(e,Ea(n),nt({},Pe({to:jn(t,n)},"View invoice")),nt({},Pe({to:Cn(t,n)},"Edit invoice")),nt({},Pe({onClick:Ft(Ca(n))},"Delete invoice")))}(t,t.id===n)))}const $a=se(O((function({project:t},n){return[{project:t,menu:!1},null]}),(function(t,n,e){switch(t.tag){case Fa:return n.project=t.project,[n,null];case Ua:return function({status:t},n,e){return[n,Ho(n.project,{status:t},Sa)]}(t,n);case Sa:return function({result:t},n,e){return po(t)?[n,Xn({type:"danger",message:"An error occured and the changes couldn’t be saved. Please try again."})]:[n,null]}(t,n);case xa:return[n,Yo(n.project.id,Ma)];case Ma:return function({result:t},n,e){return po(t)?[n,Xn({type:"danger",message:"An error occured and the project couldn’t be deleted. Please try again."})]:[n,Wn(In())]}(t,n);case Oa:return n.menu=!n.menu,[n,null];case Va:return n.menu=!1,[n,null];default:throw"Unmatched message"}}),(function({project:t,menu:n}){const e=t.tasks,r=e.length,i=e.filter((t=>"COMPLETED"===t.status)).length;return Z({class:"project"},(s=i,o=r,ot({class:"project-progress",value:""+s,max:""+o})),function(t,n,e,r){return at({class:"project-header"},function({id:t,status:n},e){return Yc(e,Oa(),nt({},Pe({to:Dn(t)},"Tasks")),nt({},function(t){return"COMPLETED"===t?Pe({onClick:Ft(Ua("IN_PROGRESS"))},"Mark as in progress"):Pe({onClick:Ft(Ua("COMPLETED"))},"Mark as completed")}(n)),nt({},Pe({to:kn(t)},"Add invoice")),nt({},Pe({to:bn(t)},"Edit project")),nt({},Pe({onClick:Ft(xa())},"Delete project")))}(t,r),Jc(t.tags||[]),lt({class:"title has-subtitle"},t.name),dt({class:"subtitle"},function({clientId:t,id:n,name:e}){return Ne({to:vn(t,n)},K({},e))}(t.clientAccount)),t.brief&&pt({class:"project-brief"},...Vo(t.brief)),function({id:t,status:n,deadline:e},r,i){const s="COMPLETED"===n,o=s?null:"auto";return Z({class:"project-status"},s&&Zc(n),e&&Kc(e,o,!0),Ne({to:Dn(t)},gt({},`${r} / ${i} tasks`)))}(t,n,e))}(t,i,r,n),function({id:t,invoices:n}){return ut({class:"project-section project-invoices"},dt({class:"title"},"Invoices"),0!==n.length?ba({invoices:n}):null,nc("Add invoice",kn(t)))}(t),t.notes&&function({notes:t}){return ut({class:"project-section"},dt({class:"title"},"Notes"),...Vo(t))}(t));var s,o}),(function({menu:t},n){const e=[ae(n,"project",Fa)];t&&e.push(so(Va(),{capture:!0}));return e}),{project:va},{}));const Fa=t=>({tag:Fa,project:t}),Ua=t=>({tag:Ua,status:t}),Sa=t=>({tag:Sa,result:t}),xa=()=>({tag:xa}),Ma=t=>({tag:Ma,result:t}),Oa=()=>({tag:Oa}),Va=()=>({tag:Va});const La=O((function({attributes:t,children:n},e){return[{attributes:t,children:n,query:"",showMenu:!1},null]}),(function(t,n,e){switch(t.tag){case Ra:return n.attributes=t.attributes,[n,null];case _a:return n.children=t.children,[n,null];case qa:return[n,ce(e,"focus")];case Wa:return n.showMenu=!1,n.query="",[n,ce(e,"blur")];case Ba:return n.showMenu=!n.showMenu,n.query=n.showMenu?n.query:"",[n,null];case za:{const r=t.value,i=n.children,s=i.find((t=>t.attributes.value===r));if(!s)return[n,null];s.attributes.selected=!s.attributes.selected;const o=i.filter(Ya).map(Ja);return[n,ce(e,"change",o)]}case Ga:return n.children=n.children.map((r=t.values,function(t){return t.attributes.selected=r.includes(t.attributes.value),t})),[n,ce(e,"change",t.values)];case Ha:return n.query=t.query,[n,null];default:throw"Unmatched message"}var r}),(function(t){const n=Object.assign({},t.attributes),e={multiselect:!0,"is-active":t.showMenu,"is-disabled":n.disabled};return delete n.disabled,delete n.placeholder,Z({...n,classes:wa(n.classes,e),onFocusout:Ut(Wa)},function({attributes:t,children:n}){return kt({class:"multiselect-button",aria:{hidden:!0},onFocus:$t(qa()),onClick:Ft(Ba()),disabled:t.disabled},n.some((t=>t.attributes.selected))?(r=n,tt({class:"multiselect-tags"},...r.filter(Ya).map(Qa))):(e=t.placeholder,pt({class:"multiselect-placeholder"},e||"Select an option...")));var e;var r}(t),function({children:t,query:n}){return Z({class:"multiselect-menu",aria:{hidden:!0}},t.length<7?null:function(t){return Z({class:"multiselect-searchbox"},It({type:"search",value:t,placeholder:"Search...",class:"input",onInput:St(Ha)}))}(n),tt({class:"multiselect-menu-list"},...function(t,n){return(t=t.trim().toLowerCase())?n.map((n=>Za(n,!function(t,n){return Ka(n).toLowerCase().includes(t)}(t,n)))):n.map((t=>Za(t,!1)))}(n,t)))}(t),function({attributes:t,children:n}){return At({...t,multiple:!0,classes:wa(t.classes,{"multiselect-fallback":!0}),onChange:(e=Ga,function({target:{selectedOptions:t}},n){const r=Array.from(t).map((t=>t.value));n(e(r))})},...n);var e}(t))}),(function(t,n){return[ae(n,"attributes",Ra),ae(n,"children",_a)]}),{attributes:va,children:Array.isArray},{change:!0,focus:!0,blur:!0});const Ra=t=>({tag:Ra,attributes:t}),_a=t=>({tag:_a,children:t}),qa=()=>({tag:qa}),Wa=()=>({tag:Wa}),Ba=()=>({tag:Ba}),za=t=>({tag:za,value:t}),Ga=t=>({tag:Ga,values:t}),Ha=t=>({tag:Ha,query:t});function Ya(t){return!!t.attributes.selected}function Ja(t){return t.attributes.value}function Qa(t){return nt({class:"multiselect-tag",title:t.attributes.title},t.attributes.label||Ka(t))}function Za({attributes:t,children:n},e=!1){t=Object.assign({},t);const{value:r,disabled:i,selected:s}=t,o={"multiselect-option":!0,"is-disabled":i,"is-hidden":e,"is-selected":s};return delete t.value,delete t.disabled,delete t.selected,nt({...t,tabindex:"-1",classes:wa(t.classes,o),onClick:Ft(za(r))},...n)}function Ka(t){return"string"==typeof t?t:t.children.reduce(((t,n)=>t+Ka(n)),"")}function Xa(t,n,e){return Z({classes:{field:!0,"has-error":!!e}},t&&wt({class:"label"},t),Z({class:"control"},n),e&&pt({class:"help is-error"},e))}function tu(...t){return t.filter(Boolean).join(" ")}function nu(t,n,e={}){return It({...e,value:t,type:"text",class:tu("input",e.class),onChange:n&&St(n)})}function eu(t,n,e={}){return yt({...e,class:tu("textarea",e.class),onChange:n&&St(n)},t)}function ru(t,n,e={}){return It({...e,value:t,type:"text",inputmode:"numeric",class:tu("input",e.class),onChange:n&&St(n)})}function iu(t,n,e={}){return It({...e,value:t,type:"text",autocomplete:"username",class:tu("input",e.class),onChange:n&&St(n)})}function su(t,n,e={}){return It({...e,value:t,type:"password",autocomplete:"current-password",class:tu("input",e.class),onChange:n&&St(n)})}function ou(t,n,e={}){return It({...e,value:t,type:"date",class:tu("input",e.class),onChange:n&&St(n)})}function cu(t,n,e={}){return It({...e,value:t,type:"time",class:tu("input",e.class),onChange:n&&St(n)})}function au(t=lu){return function(n,e,{placeholder:r,options:i,...s}={}){return Array.isArray(n)||(n=[n]),n=n.map(du),At({...s,class:tu("select",s.class),onChange:e&&St(e)},void 0===(o=r)?null:bt({value:"",disabled:!0,selected:!0},o),...t(i,n));var o}}function uu(t=lu){return function(n,e,{options:r,...i}={}){return null!=n&&""!==n||(n=[]),function({onChange:t,onFocus:n,onBlur:e,...r},...i){return se(La)({onChange:t,onFocus:n,onBlur:e,attributes:r,children:i})}({...i,values:n=n.map(du),onChange:$t(e)},...t(r,n))}}function lu(t,n){return t.map((t=>function([t,n,e={}],r){return bt({value:t,selected:r.includes(t),...e},n)}(t,n)))}function du(t){return null==t?"":String(t)}class fu{constructor(t,n="",e={}){this.isChanged=!1,this.isDirty=!1,this.isTouched=!1,this.isValid=!0,this.name=t,this.defaultValue=n,this.value=n,this.errors=[],this.version=0,this.props=e}change(){return this.version++,this}get(){return this.value}set(t){let n=!1;return this.isTouched||(n=!0,this.isTouched=!0),t!==this.value&&(n=!0,this.value=t,this.isChanged=t!==this.defaultValue,this.isDirty=!0),n&&this.change(),this}getErrors(){return this.errors}setErrors(t=[]){return this.isDirty=!1,this.isValid=0===t.length,this.errors=t,this.change(),this}getProp(t){return this.props[t]}setProp(t,n){return n!==this.props[t]&&(this.props[t]=n,this.change()),this}reset(){return this.value=this.defaultValue,this.isChanged=!1,this.isDirty=!1,this.isTouched=!1,this.isValid=!0,this.errors=[],this.version=0,this}}const mu=/\[(\d+)\]/g,pu=(t,n)=>"."+n;function gu(t){return Array.isArray(t)?[...t]:t.replace(mu,pu).split(".")}function hu(t,n){let e=t;const r=gu(n),i=r.length-1,s=r[i];for(let t=0;t<i&&(e=e[r[t]],void 0!==e);t++);return[e,s]}function vu(t,n){const[e,r]=hu(t,n);if(null===e)throw new RangeError("Path not found");return e[r]}function wu(t,n,e){const[r,i]=hu(t,n);if(null===r)throw new RangeError("Path not found");return r[i]=e,t}const Iu=Array.isArray,yu=t=>t instanceof fu,Au=t=>t instanceof Eu,bu=t=>yu(t)?t.get():t,ku=(t,n)=>yu(t)?t.set(n):n,ju=t=>yu(t)?t.errors:[],Cu=(t,n)=>yu(t)?t.setErrors(n):t,Du=t=>yu(t)?t.reset():t;class Eu{constructor(t={},n={}){Object.defineProperty(this,"__meta__",{configurable:!1,enumerable:!1,writable:!0,value:n}),Object.assign(this,t)}getMeta(t){return this.__meta__[t]}setMeta(t,n){return this.__meta__[t]=n,this}getValues(){return Tu(this,bu)}setValues(t){return Pu(this,t,ku)}getFormErrors(){return Tu(this,ju)}setFormErrors(t){return Pu(this,t,Cu)}reset(){return Pu(this,this,Du)}get(t){return vu(this,t)}set(t,n){return wu(this,t,n)}update(t,n){const e=gu(t);return wu(this,e,n(vu(this,e)))}getValue(t){return bu(this.get(t))}setValue(t,n){return this.get(t).set(n),this}getErrors(t){return ju(this.get(t))}setErrors(t,n){return Cu(this.get(t),n),this}getProp(t,n){return((t,n)=>yu(t)?t[n]:void 0)(this.get(t),n)}setProp(t,n,e){return((t,n,e)=>{yu(t)&&t.setProp(n,e)})(this.get(t),n,e),this}setProps(t,n){const e=this.get(t);if(yu(e))for(const t in n)e.setProp(t,n[t]);return this}}function Tu(t,n){const e={};for(const r in t){const i=t[r];Iu(i)?e[r]=i.map((t=>Tu(t,n))):Au(i)?e[r]=Tu(i,n):e[r]=n(i)}return e}function Pu(t,n,e){for(const r in t){if(!(r in n))continue;const i=t[r],s=n[r];if(Iu(i))for(let n=0,o=i.length;n<o;n++)n in s?i[n]=e(i[n],s[n]):Au(i)?t[r]=Pu(i,s,e):t[r]=e(i,s)}return t}function Nu(t,n="",e={}){return new fu(t,n,e)}function $u(t,n,e=!1){if(void 0===n)return t;for(const r in t){const i=t.get(r);if(i instanceof fu)e&&!i.isTouched&&""===i.value||t.setErrors(r,n.errors[r].map(Fu));else if(i instanceof Eu)$u(i,n.getChange(r),e);else if(Array.isArray(i)){const t=n.getChange(r)||[];for(let n=0,r=t.length;n<r;n++)$u(i[n],t[n],e)}}return t}function Fu(t){if("string"==typeof t)return t;switch(t.code){case"blank":return"can't be empty";case"taken":return"has already been taken";case"tooShort":return`can't be less than ${t.min} characters long`;case"tooLong":return`can't be more than ${t.max} characters long`;case"number":return function({type:t,number:n}){switch(t){case"is":return`must be equal to ${n}`;case"not":return`can't be equal to ${n}`;case"greaterThan":return`can't be less or equal to ${n}`;case"greaterOrEqual":return`can't be less than ${n}`;case"lessOrEqual":return`can't be greater than ${n}`;case"lessThan":return`can't be greater or equal to ${n}`;default:return"is invalid"}}(t);default:return"is invalid"}}function Uu(t,n,e,r){const i=t.id,s=function({clientId:t,clientAccountId:n},e){return t||(n?(e.find((t=>t.id===n))||{}).clientId:void 0)}(t,e),o=t.clientAccountId,c=r.map((t=>[t.id,t.name])),a=t.deadline&&new Date(t.deadline);return new Eu({clientId:Su(i,s,n),clientAccountId:xu(i,s,o,e),name:Nu("name",t.name),code:Nu("code",t.code),tagIds:Nu("tagIds",t.tagIds,{options:c}),date:Nu("date",ss(a)),time:Nu("time",os(a)),brief:Nu("brief",t.brief),notes:Nu("notes",t.notes)})}function Su(t,n,e){const r=e.map((t=>[t.id,t.name])),i=0!==r.lenth;return Nu("clientId",n,{placeholder:i?"Select a client...":"There are no clients",options:r,disabled:!!t||!i})}function xu(t,n,e,r){const i=Mu(r,n),s=!!t||0===i.lenth;return Nu("clientAccountId",e,{placeholder:Ou(i,n),options:i,disabled:s})}function Mu(t,n){return void 0===n?[]:t.filter((t=>t.clientId===n)).map((t=>[t.id,t.name]))}function Ou(t,n){return 0!==t.lenth?"Select a client account...":n?"There are no client accounts":"Choose a client first"}(t=>{t.call.bind(t)})(Object.prototype.toString);const Vu=se(O((function({project:t,clients:n,clientAccounts:e,tags:r},i){return[{project:t,clients:n,clientAccounts:e,tags:r,form:Uu(t,n,e,r),isDisabled:!1},null]}),(function(t,n,e){switch(t.tag){case Lu:return function({project:t},n,e){const{clients:r,clientAccounts:i,tags:s}=n;return n.project=t,n.form=Uu(t,r,i,s),[n,null]}(t,n);case Ru:return function({name:t,value:n},e,r){const i=e.form.setValue(t,n),s=$s(e.project,i.getValues());"clientId"===t&&function(t,n){const e=t.getValue("clientId"),r=Mu(n,e),i=0===r.lenth||t.clientId.disabled,s=Ou(r,e);t.setProps("clientAccountId",{placeholder:s,options:r,disabled:i})}(i,e.clientAccounts);return e.form=$u(i,s,!0),[e,null]}(t,n);case _u:return function(t,n,e){const r=n.form.getValues(),i=$s(n.project,r);if(!i.isValid)return n.form=$u(n.form,i,!1),[n,null];return n.isDisabled=!0,[n,Jn(!1),Go(n.project,r,qu)]}(0,n);case qu:return function({result:t},n,e){if(po(t))return function(t,n,e){if(n.isDisabled=!1,t instanceof Ji)return n.form=$u(n.form,t,!1),[n,Jn(!0)];return[n,Jn(!0),Xn({type:"danger",message:"An error occured and the changes couldn’t be saved. Please try again."})]}(t.error,n);const{id:r}=ho(t,null);return[n,Jn(!0),qn(An(r))]}(t,n);default:throw"Unmatched message"}}),(function({project:t,isDisabled:n,form:e}){return ht({class:"form project-form",onSubmit:xt(_u())},vt({disabled:n},Wu(e,"clientId","Client",au()),Wu(e,"clientAccountId","Client Account",au()),Wu(e,"name","Name",nu),Wu(e,"code","Code",nu),Wu(e,"tagIds","Tags",uu()),Wu(e,"date","Due date",ou),Wu(e,"time","Due time",cu),Wu(e,"brief","Project brief",eu),Wu(e,"notes","Notes",eu)),kt({type:"submit",class:"button is-primary",disabled:n},t.id?"Save project":"Add project"))}),(function(t,n){return[ae(n,"project",Lu)]}),{project:va,clients:Array.isArray,clientAccounts:Array.isArray,tags:Array.isArray},{}));const Lu=t=>({tag:Lu,project:t}),Ru=t=>n=>({tag:Ru,name:t,value:n}),_u=()=>({tag:_u}),qu=t=>({tag:qu,result:t});function Wu(t,n,e,r){const{value:i,errors:s,props:o}=t.get(n);return Xa(e,r(i,Ru(n),o),s.join(", "))}const Bu=se(O((function({invoice:t},n){return[{invoice:t,menu:!1},null]}),(function(t,n,e){switch(t.tag){case zu:return n.invoice=t.invoice,[n,null];case Gu:return[n,Zo(n.invoice.id,Hu)];case Hu:return function({result:t},n,e){if(po(t))return[n,Xn({type:"danger",message:"An error occured and the invoice couldn’t be deleted. Please try again."})];const r=ho(t,{}).projectId;return[n,Wn(An(r))]}(t,n);case Yu:return n.menu=!n.menu,[n,null];case Ju:return n.menu=!1,[n,null];default:throw"Unmatched message"}}),(function({invoice:t,menu:n}){return Z({class:"invoice"},function(t,n){return at({class:"invoice-header"},function({projectId:t,id:n},e){return Yc(e,Yu(),nt({},Pe({to:Cn(t,n)},"Edit invoice")),nt({},Pe({onClick:Ft(Gu())},"Delete invoice")))}(t,n),lt({class:"title has-subtitle"},Aa(t.total)),dt({class:"subtitle"},function({id:t,name:n}){return Ne({to:An(t)},K({},n))}(t.project)),function(t){return Z({class:"invoice-status"},ta(t),na(t,!0))}(t))}(t,n),function(t){return ut({class:"invoice-section"},dt({class:"title"},"Detail"),function({items:t,total:n}){return Z({class:"table-containter"},jt({class:"invoice-items-table table is-fullwidth"},Ct({},Tt({},Pt({},"Description"),Pt({},"Quantity"),Pt({},"Price"))),Dt({},...t.map(Qu)),Et({},Tt({},Pt({}),Pt({},"Total"),Pt({},Aa(n))))))}(t))}(t),function({notes:t}){return t?ut({class:"invoice-section"},dt({class:"title"},"Notes"),...Vo(t)):null}(t))}),(function({menu:t},n){const e=[ae(n,"invoice",zu)];t&&e.push(so(Ju(),{capture:!0}));return e}),{invoice:va},{}));const zu=t=>({tag:zu,invoice:t}),Gu=()=>({tag:Gu}),Hu=t=>({tag:Hu,result:t}),Yu=()=>({tag:Yu}),Ju=()=>({tag:Ju});function Qu({description:t,quantity:n,price:e}){return Tt({},Nt({},t),Nt({},ya(n)),Nt({},Aa(e)))}function Zu(t,n){const e={disabled:!0,options:[[n.id,n.name]]};return new Eu({projectId:Nu("projectId",n.id,e),dueDate:Nu("dueDate",Ku(t.dueDate)),sentAt:Nu("sentAt",Ku(t.sentAt)),receivedAt:Nu("receivedAt",Ku(t.receivedAt)),paidAt:Nu("paidAt",Ku(t.paidAt)),items:(r=t.items,r&&r.length>0?r:[{}]).map(Xu),notes:Nu("notes",t.notes)});var r}function Ku(t){return t?ss(new Date(t)):""}function Xu({id:t,description:n,quantity:e,price:r}){const i={id:t,description:Nu("description",n),quantity:Nu("quantity",e),price:Nu("price",r)};return new Eu(i,{key:t||tl()})}const tl=(()=>{let t=0;return()=>String(t++)})();function nl({items:t}){return t.reduce(((t,n)=>t+function(t){const n=Number(t.getValue("quantity")),e=Number(t.getValue("price"));return Number.isNaN(n)||Number.isNaN(e)?0:n*e}(n)),0)}const el=se(O((function({invoice:t,project:n},e){return[{invoice:t,project:n,form:Zu(t,n),isDisabled:!1},null]}),(function(t,n,e){switch(t.tag){case rl:return function({invoice:t},n,e){return n.invoice=t,n.form=Zu(t,n.project),[n,null]}(t,n);case il:return function({name:t,value:n},e,r){const i=e.form.setValue(t,n),s=Js(e.invoice,i.getValues());return e.form=$u(i,s,!0),[e,null]}(t,n);case sl:return function(t,n,e){return n.form=function(t,n={}){return t.items.push(Xu(n)),t}(n.form),[n,null]}(0,n);case ol:return function({index:t},n,e){return n.form=function(t,n){return t.items.splice(n,1),t}(n.form,t),[n,null]}(t,n);case cl:return function(t,n,e){const r=n.form.getValues(),i=Js(n.invoice,r);if(!i.isValid)return n.form=$u(n.form,i,!1),[n,null];return n.form.isDisabled=!0,[n,Jn(!1),Qo(n.invoice,r,al)]}(0,n);case al:return function({result:t},n,e){if(po(t))return function(t,n,e){if(n.isDisabled=!1,t instanceof Ji)return n.form=$u(n.form,t,!1),[n,Jn(!0)];return[n,Jn(!0),Xn({type:"danger",message:"An error occured and the changes couldn’t be saved. Please try again."})]}(t.error,n);const{id:r,projectId:i}=ho(t,null);return[n,Jn(!0),qn(jn(i,r))]}(t,n);default:throw"Unmatched message"}}),(function({invoice:t,isDisabled:n,form:e}){return ht({class:"form invoice-form",onSubmit:xt(cl())},vt({disabled:n},ul(e,"projectId","Project",au()),ul(e,"dueDate","Due date",ou),ul(e,"sentAt","Sent on",ou),ul(e,"receivedAt","Received on",ou),ul(e,"paidAt","Paid on",ou),function(t){const n=t.items,e=n.length>1;return Z({class:"invoice-form-items"},Z({class:"invoice-form-items-header"},wt({class:"label"},"Description"),wt({class:"label"},"Quantity"),wt({class:"label"},"Price")),J("div",{class:"invoice-form-items-list"},...n.map(((t,n)=>[t.getMeta("key"),ll(t,n,e)]))),Z({class:"invoice-form-items-footer"},kt({class:"button is-link",onClick:Ft(sl())},"Add item +"),gt({},`Total: ${Aa(nl(t))}`)))}(e),ul(e,"notes","Notes",eu)),kt({type:"submit",class:"button is-primary",disabled:n},t.id?"Save invoice":"Add invoice"))}),(function(t,n){return[ae(n,"invoice",rl)]}),{invoice:va,project:va},{}));const rl=t=>({tag:rl,invoice:t}),il=t=>n=>({tag:il,name:t,value:n}),sl=()=>({tag:sl}),ol=t=>({tag:ol,index:t}),cl=()=>({tag:cl}),al=t=>({tag:al,result:t});function ul(t,n,e,r){const{value:i,errors:s,props:o}=t.get(n);return Xa(e,r(i,il(n),o),s.join(", "))}function ll(t,n,e=!0){return vt({class:"invoice-form-item"},Z({class:"invoice-form-item-header"},wt({class:"label"},`Item #${n+1}`),function(t,n=!1){return X({disabled:n,class:"button is-close is-light",title:"Remove item",onClick:!n&&Ft(t)})}(ol(n),!e)),Z({class:"invoice-form-item-controls"},dl(n,t.description,"Description",nu),dl(n,t.quantity,"Quantity",ru),dl(n,t.price,"Price",ru)),function({description:t,quantity:n,price:e}){const r=[...t.errors.map((t=>`description ${t}`)),...n.errors.map((t=>`quantity ${t}`)),...e.errors.map((t=>`price ${t}`))];return 0===r.length?null:pt({class:"help is-error"},r.join(", "))}(t))}function dl(t,{name:n,value:e,isValid:r,props:i},s,o){return Z({classes:{field:!0,"has-error":!r}},Z({class:"control"},o(e,il(`items[${t}].${n}`),{...i,placeholder:s})))}const fl=se(O((function({page:t},n){const e={page:{current:t,retiring:null},data:ac()},r=[Jn(!1),(i=gl,wo([qo],i)),zo(gl)];var i;return[e,...r]}),(function(t,n,e){switch(t.tag){case ml:return function({page:t},n,e){return n.page={current:t,retiring:n.page.current},[n,Xo(t),de(300,pl())]}(t,n);case pl:return n.page.retiring=null,[n,null];case gl:return function({result:t},n,e){const r=n.data,i=fc(r),s=po(t)&&Mc(t.error),o=pc(r)&&Mc(r.error);return n.data=mo(t)?uc(t.data):mc(r)?n.data:lc(t.error),s?[n,o?null:ic()]:i?[n,ce(e,"ready"),Jn(!0)]:[n,null]}(t,n,e);case hl:return function({collection:t,changes:n},e,r){return e.data=hc(e.data,(e=>(e[t]=Ts(e[t],n),e))),[e,null]}(t,n);case vl:return[n,Bn()];default:throw"Unmatched message"}}),(function({page:t,data:n}){if(pc(n))return Wc(n.error);if(!mc(n))return Bc(t.current);const e=vc(n,{}),r=function({current:t,retiring:n}){t=Hc(t),n=n?Hc(n):{};const{isList:e,isDetails:r,isForm:i,isInvoice:s,isInvoiceForm:o}=t,c=i||s||o,a=n.isInvoice,u=n.isForm,l=n.isInvoiceForm;return{projectId:t.projectId,invoiceId:t.invoiceId||n.invoiceId,formProjectId:t.formProjectId||n.formProjectId,formInvoiceId:t.formInvoiceId||n.formInvoiceId,isDrawer:c,isList:e,isDetails:r,isInvoice:s,wasInvoice:a,isForm:i,wasForm:u,isInvoiceForm:o,wasInvoiceForm:l}}(t);return function({projects:t,invoices:n},e){const{projectId:r,invoiceId:i,formProjectId:s,formInvoiceId:o}=e;return r&&!On(t,{id:r})||i&&!On(n,{id:i,projectId:r})||s&&!On(t,{id:s})||o&&!On(n,{id:o,projectId:r})}(e,r)?Wc(new RangeError("NOT_FOUND")):function({projects:t}){return 0===t.length}(e)?function(t,{formProjectId:n,isForm:e,wasForm:r}){const i=Bo(t,n);return Z({class:"viewport has-drawers grid is-one"},Sc("Projects"),zc(e,vl()),ut({class:"is-hidden"}),function(t){const n=nc("Add a project",yn());return ut({class:"view grid-main",classes:{"is-active":t}},Sc("Projects"),tc({title:"There are no projects",message:"Create your first project with the button below.",action:n}))}(!e),wl(i,e,r))}(e,r):function(t,n){const e=function({clientAccounts:t,invoices:n,projects:e,tags:r,tasks:i}){const s=[],o=t=>t.id,c=t=>t.projectId,a=Ln(t,o),u=Ln(r,o),l=Rn(i,c),d=Rn(n,c);for(const{...t}of e)t.clientAccount=a[t.clientAccountId]||void 0,t.invoices=d[t.id]||[],t.tags=Vn(t.tagIds,(t=>u[t])),t.tasks=l[t.id]||[],s.push(t);return s.sort(_o)}(t),r=n.projectId||e[0].id,i=On(e,{id:r}),s=Bo(t,n.formProjectId),o=function({invoices:t,projects:n},e){const r=On(t,{id:e});if(!r)return null;const i=On(n,{id:r.projectId});return{...r,project:i}}(t,n.invoiceId),c=function({invoices:t,projects:n},e,r){const i=On(n,{id:e});return{invoice:r?On(t,{id:r}):{},project:i}}(t,n.projectId,n.formInvoiceId);return Z({class:"viewport has-drawers grid is-two"},Sc("Projects"),zc(n.isDrawer,vl()),function(t,n,e){return ut({class:"view grid-sidebar",classes:{"is-active":e}},Sc("Projects"),sa({projects:t,activeId:n}))}(e,r,n.isList),function(t,n){return ut({class:"view grid-main",classes:{"is-active":n}},xc("Project",vl()),$a({project:t}))}(i,n.isDetails),wl(s,n.isForm,n.wasForm),function(t,n,e){return n||e?ut({class:"view",classes:{"is-active":n}},xc("Invoice",vl()),Bu({invoice:t})):ut({class:"view"})}(o,n.isInvoice,n.wasInvoice),function(t,n,e){return n||e?ut({class:"view",classes:{"is-active":n}},xc((t.invoice.id?"Edit":"New")+" invoice",vl()),el(t)):ut({class:"view"})}(c,n.isInvoiceForm,n.wasInvoiceForm))}(e,r)}),(function(t,n){const e=[ae(n,"page",ml)];mc(t.data)&&(e.push([Jo,hl("projects")]),e.push(function(t){return[Ko,t]}(hl("invoices"))));return e}),{page:function(t){return Array.isArray(t)&&Gc.includes(t[0])}},{ready:!0}));const ml=t=>({tag:ml,page:t}),pl=()=>({tag:pl}),gl=t=>({tag:gl,result:t}),hl=t=>n=>({tag:hl,collection:t,changes:n}),vl=()=>({tag:vl});function wl(t,n,e){return n||e?ut({class:"view",classes:{"is-active":n}},xc((t.project.id?"Edit":"New")+" project",vl()),Vu(t)):ut({class:"view"})}function Il(t){const n=!t.get("id"),e=function(t){const n={},e={};"id"in t&&(e.id=t.id),"username"in t&&(e.username=t.username),"email"in t&&(e.email=t.email),"isDisabled"in t&&(e.isDisabled=t.isDisabled),"firstName"in t&&(n.firstName=t.firstName),"lastName"in t&&(n.lastName=t.lastName),"isActive"in t&&(n.isActive=t.isActive),"status"in t&&(n.status=t.status),"notes"in t&&(n.notes=t.notes);for(const t in n){e.profile=n;break}return e}(t.prepare().changes);return n&&(e.role="admin"),e}function yl(t){return ki("users",t)}function Al(t={},n={}){return function(t={},n={}){return new Ji(kc,t).cast(n,[...Ic,...yc]).tap(Dc).require(Ic).validate("firstName",Bi({max:255})).validate("lastName",Bi({max:255})).validate("username",Bi({min:4,max:255})).validate("username",Gi(Ac)).validate("email",Bi({max:255})).validate("email",Gi(bc)).validate("status",Bi({max:72})).validate("notes",Bi({max:4096}))}(t,n)}async function bl(t={}){const n=Al({},t);if(!n.isValid)throw n;const e=Il(n),{user:r,errors:i}=await async function(t){return(await pi(di,{input:t})).createUser}(e);if(i)throw Ds(n,jc(i));return Ci("users",r)}async function kl(t,n={}){const e=Al(t,n);if(!e.isValid)throw e;const r=e.get("id"),i=Il(e),{user:s,errors:o}=await async function(t,n){return(await pi(fi,{id:t,input:n})).updateUser}(r,i);if(o)throw Ds(e,jc(o));return Di("users",r,s)}function jl(t){return async function(t){return(await pi("\n  mutation ResetPassword($id: ID!) {\n    resetPassword(id: $id) {\n      user { id }\n    }\n  }\n  ",{id:t})).resetPassword.user.id}(t)}function Cl(t){return async function(t){return(await pi("\n  mutation ResetSession($id: ID!) {\n    resetSession(id: $id) {\n      user { id }\n    }\n  }\n  ",{id:t})).resetSession.user.id}(t)}async function Dl(t){return await async function(t){return(await pi(mi,{id:t})).deleteUser.user}(t),Ei("users",t)}async function El(t){const[n,e,r,i,s]=await Promise.all([(o=t,ji("projects",o)),Ys((t=>t.taskId)),Ps(),Ms((n=>n.projectId===t)),yl()]);var o;return{project:n,invoices:e,tags:r,tasks:i,users:s}}async function Tl(t){return await bi(),El(t)}function Pl({project:t,tags:n,tasks:e,users:r},i){return{project:t,task:i?On(e,{id:i}):{},tags:n,users:r}}function Nl(t,n){return wo([El,t],n)}function $l(t,n){return wo([Tl,t],n)}function Fl(t,n,e){return wo(t.id?[Ls,t,n]:[Vs,n],e)}function Ul(t,n,e){return wo([Ls,t,n],e)}function Sl(t,n){return wo([Rs,t],n)}function xl(t,n,e){return Ti("tasks",r=r=>{if(null===r)return e(n(null));(r=r.filter((n=>n.tombstone||n.projectId===t))).length>0&&e(n(r))}),()=>Pi("tasks",r);var r}function Ml(t,n,e){return wo(t.id?[Ks,t,n]:[Zs,n],e)}function Ol(t,n){return wo([Xs,t],n)}function Vl(t,n){return to((e=>{if(null===e)return n(t(null));(e=e.filter((t=>t.tombstone||t.taskId))).length>0&&n(t(e))}))}function Ll([t]){return ro("AdminTasks"===t?".view.grid-sidebar":"AdminTask"===t?".view.grid-main":"")}function Rl(t){return Z({class:"viewport"},Z({class:"view is-active"},Sc("Tasks"),Oc(t)))}function _l([t]){return Z({class:"viewport grid is-two"},Sc("Tasks"),ut({class:"view grid-sidebar",classes:{"is-active":"AdminTask"!==t}},Sc("Tasks"),Vc()),function(t){return ut({class:"view grid-main",classes:{"is-active":t}},xc("Task"),Rc())}("AdminTask"===t))}const ql=["AdminTasks","AdminTask","NewAdminTask","EditAdminTask","AdminTaskInvoice","NewAdminTaskInvoice","EditAdminTaskInvoice"];function Wl([t,{projectId:n,taskId:e,id:r,active:i}]){const s="AdminTask"===t,o="AdminTaskInvoice"===t,c="NewAdminTask"===t||"EditAdminTask"===t,a="NewAdminTaskInvoice"===t||"EditAdminTaskInvoice"===t;return{projectId:n,taskId:e=o||a?i||e:c?i||r:s?r:void 0,invoiceId:o?r:void 0,formTaskId:c?r:void 0,formInvoiceId:a?r:void 0,isList:"AdminTasks"===t,isDetails:s,isInvoice:o,isForm:c,isInvoiceForm:a}}const Bl=se(O((function({tasks:t,activeId:n},e){return[{activeId:n,tasks:t,itemWithMenu:null},null]}),(function(t,n,e){switch(t.tag){case zl:return n.tasks=t.tasks,[n,null];case Gl:return n.activeId=t.id,[n,null];case Hl:return function({id:t,status:n},e,r){const i=On(e.tasks,{id:t});return i?[e,Ul(i,{status:n},Yl)]:[e,null]}(t,n);case Yl:return function({result:t},n,e){return po(t)?[n,Xn({type:"danger",message:"An error occured and the changes couldn’t be saved. Please try again."})]:[n,null]}(t,n);case Jl:return[n,Sl(t.id,Ql)];case Ql:return function({result:t},n,e){if(po(t))return[n,Xn({type:"danger",message:"An error occured and the task couldn’t be deleted. Please try again."})];const{projectId:r,id:i}=ho(t,null);return i===n.activeId?[n,Wn(Dn(r))]:[n,null]}(t,n);case Zl:return n.itemWithMenu=n.itemWithMenu!==t.id?t.id:null,[n,null];case Kl:return n.itemWithMenu=null,[n,null];default:throw"Unmatched message"}}),(function({tasks:t,activeId:n,itemWithMenu:e}){return J("ul",{class:"list"},...t.map((t=>[t.id,Xl(t,n,e)])))}),(function({itemWithMenu:t},n){const e=[ae(n,"tasks",zl),ae(n,"activeId",Gl)];t&&e.push(so(Kl(),{capture:!0}));return e}),{tasks:Array.isArray,activeId:_n},{}));const zl=t=>({tag:zl,tasks:t}),Gl=t=>({tag:Gl,id:t}),Hl=(t,n)=>({tag:Hl,id:t,status:n}),Yl=t=>({tag:Yl,result:t}),Jl=t=>({tag:Jl,id:t}),Ql=t=>({tag:Ql,result:t}),Zl=t=>({tag:Zl,id:t}),Kl=()=>({tag:Kl});function Xl(t,n,e){const{id:r,projectId:i,status:s}=t;return nt({id:r,classes:{"list-item":!0,"is-active":r===n}},function(t,n,e,r,i){return Yc(i,Zl(t),nt({},function(t,n){return"COMPLETED"===n?Pe({onClick:Ft(Hl(t,"IN_PROGRESS"))},"Mark as in progress"):Pe({onClick:Ft(Hl(t,"COMPLETED"))},"Mark as completed")}(t,r)),nt({},Pe({to:Pn(n,t,{active:e})},"Edit task")),nt({},Pe({onClick:Ft(Jl(t))},"Delete task")))}(r,i,n,s,r===e),Pe({to:Tn(i,r),class:"list-item-face"},function({name:t,tags:n,project:e}){return at({class:"list-item-header"},Jc(n||[]),ft({class:"title has-subtitle is-truncated"},t),mt({class:"subtitle is-truncated"},function({id:t,name:n}){return Ne({to:An(t)},K({},n))}(e)))}(t),function({status:t,deadline:n,user:e,invoices:r}){return Z({class:"list-item-status"},"COMPLETED"===t?Zc(t):n&&Kc(n),e&&Tc(e,!0),K({styles:{margin:"0","margin-left":"auto"}}),ea(r))}(t)))}const td=se(O((function({task:t,invoices:n},e){return[{task:t,invoices:nd(t,n),itemWithMenu:null},null]}),(function(t,n,e){switch(t.tag){case ed:return n.invoices=nd(n.task,t.invoices),[n,null];case rd:return[n,Ol(t.id,id)];case id:return function({result:t},n,e){return po(t)?[n,Xn({type:"danger",message:"An error occured and the invoice couldn’t be deleted. Please try again."})]:[n,null]}(t,n);case sd:return n.itemWithMenu=n.itemWithMenu!==t.id?t.id:null,[n,null];case od:return n.itemWithMenu=null,[n,null];case cd:return[n,Wn(t.path)];default:throw"Unmatched message"}}),(function({invoices:t,itemWithMenu:n}){return jt({class:"invoice-table table is-fullwidth"},Ct({},Tt({},Pt({},"Status"),Pt({},"Due date"),Pt({},"Payment"),Pt({}))),J("tbody",{},...t.map((t=>[t.id,ad(t,n)]))),Et({},Tt({},Pt({}),Pt({}),Pt({},"Total: ",Aa(function(t){return t.reduce(((t,n)=>t+Number(n.total)),0)}(t))),Pt({}))))}),(function({itemWithMenu:t},n){const e=[ae(n,"invoices",ed)];t&&e.push(so(od(),{capture:!0}));return e}),{task:va,invoices:Array.isArray},{}));function nd(t,n){return n.map((n=>({...n,task:t}))).sort(((t,n)=>Date.parse(t.dueDate)-Date.parse(n.dueDate)))}const ed=t=>({tag:ed,invoices:t}),rd=t=>({tag:rd,id:t}),id=t=>({tag:id,result:t}),sd=t=>({tag:sd,id:t}),od=()=>({tag:od}),cd=t=>({tag:cd,path:t});function ad(t,n){const{task:{projectId:e},taskId:r,id:i}=t,s=$n(e,r,i),o={onClick:Ft(cd(s))};return Tt({},Nt(o,na(t)),Nt(o,ta(t)),Nt(o,Aa(t.total)),Nt({},function({task:{projectId:t},taskId:n,id:e},r){return Yc(r,sd(e),nt({},Pe({to:$n(t,n,e)},"View invoice")),nt({},Pe({to:Fn(t,n,e)},"Edit invoice")),nt({},Pe({onClick:Ft(rd(e))},"Delete invoice")))}(t,i===n)))}const ud=se(O((function({task:t},n){return[{task:t,menu:!1},null]}),(function(t,n,e){switch(t.tag){case ld:return n.task=t.task,[n,null];case dd:return function({status:t},n,e){return[n,Ul(n.task,{status:t},fd)]}(t,n);case fd:return function({result:t},n,e){return po(t)?[n,Xn({type:"danger",message:"An error occured and the changes couldn’t be saved. Please try again."})]:[n,null]}(t,n);case md:return[n,Sl(n.task.id,pd)];case pd:return function({result:t},n,e){if(po(t))return[n,Xn({type:"danger",message:"An error occured and the task couldn’t be deleted. Please try again."})];const{projectId:r}=ho(t,null);return[n,Wn(Dn(r))]}(t,n);case gd:return n.menu=!n.menu,[n,null];case hd:return n.menu=!1,[n,null];default:throw"Unmatched message"}}),(function({task:t,menu:n}){return Z({class:"task"},function(t,n){return at({class:"task-header"},function({projectId:t,id:n,status:e},r){return Yc(r,gd(),nt({},function(t){return"COMPLETED"===t?Pe({onClick:Ft(dd("IN_PROGRESS"))},"Mark as in progress"):Pe({onClick:Ft(dd("COMPLETED"))},"Mark as completed")}(e)),nt({},Pe({to:Nn(t,n)},"Add invoice")),nt({},Pe({to:Pn(t,n)},"Edit task")),nt({},Pe({onClick:Ft(md())},"Delete task")))}(t,n),Jc(t.tags||[]),lt({class:"title has-subtitle"},t.name),dt({class:"subtitle"},function({id:t,name:n}){return Ne({to:An(t)},K({},n))}(t.project)),function({status:t,deadline:n,catTool:e,user:r}){const i="COMPLETED"===t,s=i?null:"auto";return Z({class:"task-status"},i&&Zc(t),n&&Kc(n,s,!0),e&&K({class:"tag"},e),r&&Tc(r))}(t))}(t,n),function(t){const{projectId:n,id:e,invoices:r}=t;return ut({class:"task-section task-invoices"},dt({class:"title"},"Invoices"),0!==r.length?td({task:t,invoices:r}):null,nc("Add invoice",Nn(n,e)))}(t),t.notes&&function({notes:t}){return ut({class:"task-section"},dt({class:"title"},"Notes"),...Vo(t))}(t))}),(function({menu:t},n){const e=[ae(n,"task",ld)];t&&e.push(so(hd(),{capture:!0}));return e}),{task:va},{}));const ld=t=>({tag:ld,task:t}),dd=t=>({tag:dd,status:t}),fd=t=>({tag:fd,result:t}),md=()=>({tag:md}),pd=t=>({tag:pd,result:t}),gd=()=>({tag:gd}),hd=()=>({tag:hd});function vd(t,n,e,r){const i=r.map((t=>[t.id,t.name])),s=t.deadline&&new Date(t.deadline);return new Eu({projectId:t.projectId||n.id,userId:wd(t.userId,e),tagIds:Nu("tagIds",t.tagIds,{options:i}),name:Nu("name",t.name),catTool:Nu("catTool",t.catTool),date:Nu("date",ss(s)),time:Nu("time",os(s)),notes:Nu("notes",t.notes)})}function wd(t,n){const e=n.filter((n=>!n.isDisabled||n.id===t)).map((t=>[t.id,Id(t)]));return Nu("userId",t,{placeholder:"Select a user...",options:e})}function Id({profile:{firstName:t,lastName:n,status:e}}){return`${t} ${n}${e?"*":""}`}const yd=se(O((function({task:t,project:n,users:e,tags:r},i){return[{task:t,project:n,users:e,tags:r,form:vd(t,n,e,r),isDisabled:!1},null]}),(function(t,n,e){switch(t.tag){case Ad:return function({task:t},n,e){const{project:r,users:i,tags:s}=n;return n.task=t,n.form=vd(t,r,i,s),[n,null]}(t,n);case bd:return function({name:t,value:n},e,r){const i=e.form.setValue(t,n),s=Os(e.task,i.getValues());return e.form=$u(i,s,!0),[e,null]}(t,n);case kd:return function(t,n,e){const r=n.form.getValues(),i=Os(n.task,r);if(!i.isValid)return n.form=$u(n.form,i,!1),[n,null];return n.isDisabled=!0,[n,Jn(!1),Fl(n.task,r,jd)]}(0,n);case jd:return function({result:t},n,e){if(po(t))return function(t,n,e){if(n.isDisabled=!1,t instanceof Ji)return n.form=$u(n.form,t,!1),[n,Jn(!0)];return[n,Jn(!0),Xn({type:"danger",message:"An error occured and the changes couldn’t be saved. Please try again."})]}(t.error,n);const{projectId:r,id:i}=ho(t,null),s=Tn(r,i);return[n,Jn(!0),qn(s)]}(t,n);default:throw"Unmatched message"}}),(function({task:t,isDisabled:n,form:e}){return ht({class:"form task-form",onSubmit:xt(kd())},vt({disabled:n},Cd(e,"name","Name",nu),Cd(e,"userId","Responsible",au()),Cd(e,"tagIds","Tags",uu()),Cd(e,"catTool","CAT tool",nu),Cd(e,"date","Due date",ou),Cd(e,"time","Due time",cu),Cd(e,"notes","Notes",eu)),kt({type:"submit",class:"button is-primary",disabled:n},t.id?"Save task":"Add task"))}),(function(t,n){return[ae(n,"task",Ad)]}),{task:va,project:va,users:Array.isArray,tags:Array.isArray},{}));const Ad=t=>({tag:Ad,task:t}),bd=t=>n=>({tag:bd,name:t,value:n}),kd=()=>({tag:kd}),jd=t=>({tag:jd,result:t});function Cd(t,n,e,r){const{value:i,errors:s,props:o}=t.get(n);return Xa(e,r(i,bd(n),o),s.join(", "))}const Dd=se(O((function({invoice:t},n){return[{invoice:t,menu:!1},null]}),(function(t,n,e){switch(t.tag){case Ed:return n.invoice=t.invoice,[n,null];case Td:return[n,Ol(n.invoice.id,Pd)];case Pd:return function({result:t},n,e){if(po(t))return[n,Xn({type:"danger",message:"An error occured and the invoice couldn’t be deleted. Please try again."})];const r=ho(t,{}).taskId;return[n,Wn(Tn(r))]}(t,n);case Nd:return n.menu=!n.menu,[n,null];case $d:return n.menu=!1,[n,null];default:throw"Unmatched message"}}),(function({invoice:t,menu:n}){return Z({class:"invoice"},function(t,n){return at({class:"invoice-header"},function({task:{projectId:t},taskId:n,id:e},r){return Yc(r,Nd(),nt({},Pe({to:Fn(t,n,e)},"Edit invoice")),nt({},Pe({onClick:Ft(Td())},"Delete invoice")))}(t,n),lt({class:"title has-subtitle"},Aa(t.total)),dt({class:"subtitle"},function({projectId:t,id:n,name:e}){return Ne({to:Tn(t,n)},K({},e))}(t.task)),function(t){return Z({class:"invoice-status"},ta(t),na(t,!0))}(t))}(t,n),function(t){return ut({class:"invoice-section"},dt({class:"title"},"Detail"),function({items:t,total:n}){return Z({class:"table-containter"},jt({class:"invoice-items-table table is-fullwidth"},Ct({},Tt({},Pt({},"Description"),Pt({},"Quantity"),Pt({},"Price"))),Dt({},...t.map(Fd)),Et({},Tt({},Pt({}),Pt({},"Total"),Pt({},Aa(n))))))}(t))}(t),function({notes:t}){return t?ut({class:"invoice-section"},dt({class:"title"},"Notes"),...Vo(t)):null}(t))}),(function({menu:t},n){const e=[ae(n,"invoice",Ed)];t&&e.push(so($d(),{capture:!0}));return e}),{invoice:va},{}));const Ed=t=>({tag:Ed,invoice:t}),Td=()=>({tag:Td}),Pd=t=>({tag:Pd,result:t}),Nd=()=>({tag:Nd}),$d=()=>({tag:$d});function Fd({description:t,quantity:n,price:e}){return Tt({},Nt({},t),Nt({},ya(n)),Nt({},Aa(e)))}function Ud(t,n){const e={disabled:!0,options:[[n.id,n.name]]};return new Eu({taskId:Nu("taskId",n.id,e),dueDate:Nu("dueDate",Sd(t.dueDate)),sentAt:Nu("sentAt",Sd(t.sentAt)),receivedAt:Nu("receivedAt",Sd(t.receivedAt)),paidAt:Nu("paidAt",Sd(t.paidAt)),items:(r=t.items,r&&r.length>0?r:[{}]).map(xd),notes:Nu("notes",t.notes)});var r}function Sd(t){return t?ss(new Date(t)):""}function xd({id:t,description:n,quantity:e,price:r}){const i={id:t,description:Nu("description",n),quantity:Nu("quantity",e),price:Nu("price",r)};return new Eu(i,{key:t||Md()})}const Md=(()=>{let t=0;return()=>String(t++)})();function Od({items:t}){return t.reduce(((t,n)=>t+function(t){const n=Number(t.getValue("quantity")),e=Number(t.getValue("price"));return Number.isNaN(n)||Number.isNaN(e)?0:n*e}(n)),0)}const Vd=se(O((function({invoice:t,task:n},e){return[{invoice:t,task:n,form:Ud(t,n),isDisabled:!1},null]}),(function(t,n,e){switch(t.tag){case Ld:return function({invoice:t},n,e){return n.invoice=t,n.form=Ud(t,n.task),[n,null]}(t,n);case Rd:return function({name:t,value:n},e,r){const i=e.form.setValue(t,n),s=Js(e.invoice,i.getValues());return e.form=$u(i,s,!0),[e,null]}(t,n);case _d:return function(t,n,e){return n.form=function(t,n={}){return t.items.push(xd(n)),t}(n.form),[n,null]}(0,n);case qd:return function({index:t},n,e){return n.form=function(t,n){return t.items.splice(n,1),t}(n.form,t),[n,null]}(t,n);case Wd:return function(t,n,e){const r=n.form.getValues(),i=Js(n.invoice,r);if(!i.isValid)return n.form=$u(n.form,i,!1),[n,null];return n.form.isDisabled=!0,[n,Jn(!1),Ml(n.invoice,r,Bd)]}(0,n);case Bd:return function({result:t},n,e){if(po(t))return function(t,n,e){if(n.isDisabled=!1,t instanceof Ji)return n.form=$u(n.form,t,!1),[n,Jn(!0)];return[n,Jn(!0),Xn({type:"danger",message:"An error occured and the changes couldn’t be saved. Please try again."})]}(t.error,n);const{id:r,taskId:i}=ho(t,null),s=n.task.projectId;return[n,Jn(!0),qn($n(s,i,r))]}(t,n);default:throw"Unmatched message"}}),(function({invoice:t,isDisabled:n,form:e}){return ht({class:"form invoice-form",onSubmit:xt(Wd())},vt({disabled:n},zd(e,"taskId","Task",au()),zd(e,"dueDate","Due date",ou),zd(e,"sentAt","Sent on",ou),zd(e,"receivedAt","Received on",ou),zd(e,"paidAt","Paid on",ou),function(t){const n=t.items,e=n.length>1;return Z({class:"invoice-form-items"},Z({class:"invoice-form-items-header"},wt({class:"label"},"Description"),wt({class:"label"},"Quantity"),wt({class:"label"},"Price")),J("div",{class:"invoice-form-items-list"},...n.map(((t,n)=>[t.getMeta("key"),Gd(t,n,e)]))),Z({class:"invoice-form-items-footer"},kt({class:"button is-link",onClick:Ft(_d())},"Add item +"),gt({},`Total: ${Aa(Od(t))}`)))}(e),zd(e,"notes","Notes",eu)),kt({type:"submit",class:"button is-primary",disabled:n},t.id?"Save invoice":"Add invoice"))}),(function(t,n){return[ae(n,"invoice",Ld)]}),{invoice:va,task:va},{}));const Ld=t=>({tag:Ld,invoice:t}),Rd=t=>n=>({tag:Rd,name:t,value:n}),_d=()=>({tag:_d}),qd=t=>({tag:qd,index:t}),Wd=()=>({tag:Wd}),Bd=t=>({tag:Bd,result:t});function zd(t,n,e,r){const{value:i,errors:s,props:o}=t.get(n);return Xa(e,r(i,Rd(n),o),s.join(", "))}function Gd(t,n,e=!0){return vt({class:"invoice-form-item"},Z({class:"invoice-form-item-header"},wt({class:"label"},`Item #${n+1}`),function(t,n=!1){return X({disabled:n,class:"button is-close is-light",title:"Remove item",onClick:!n&&Ft(t)})}(qd(n),!e)),Z({class:"invoice-form-item-controls"},Hd(n,t.description,"Description",nu),Hd(n,t.quantity,"Quantity",ru),Hd(n,t.price,"Price",ru)),function({description:t,quantity:n,price:e}){const r=[...t.errors.map((t=>`description ${t}`)),...n.errors.map((t=>`quantity ${t}`)),...e.errors.map((t=>`price ${t}`))];return 0===r.length?null:pt({class:"help is-error"},r.join(", "))}(t))}function Hd(t,{name:n,value:e,isValid:r,props:i},s,o){return Z({classes:{field:!0,"has-error":!r}},Z({class:"control"},o(e,Rd(`items[${t}].${n}`),{...i,placeholder:s})))}const Yd=se(O(Jd,(function(t,n,e){switch(t.tag){case Qd:return function({page:t},n,e){const r=n.page.current,i=t[1].projectId,s=r[1].projectId;return i!==s?Jd({page:t}):(n.page={current:t,retiring:r},[n,Ll(t),de(300,Zd())])}(t,n);case Zd:return n.page.retiring=null,[n,null];case Kd:return function({result:t},n,e){const r=n.data,i=fc(r),s=po(t)&&Mc(t.error),o=pc(r)&&Mc(r.error);return n.data=mo(t)?uc(t.data):mc(r)?n.data:lc(t.error),s?[n,o?null:ic()]:i?[n,ce(e,"ready"),Jn(!0)]:[n,null]}(t,n,e);case Xd:return function({collection:t,changes:n},e,r){return e.data=hc(e.data,(e=>(e[t]=Ts(e[t],n),e))),[e,null]}(t,n);case tf:return[n,Bn()];default:throw"Unmatched message"}}),(function({page:t,data:n}){if(pc(n))return Rl(n.error);if(!mc(n))return _l(t.current);const e=vc(n,{}),r=function({current:t,retiring:n}){t=Wl(t),n=n?Wl(n):{};const{isList:e,isDetails:r,isForm:i,isInvoice:s,isInvoiceForm:o}=t,c=i||s||o,a=n.isInvoice,u=n.isForm,l=n.isInvoiceForm,{projectId:d,taskId:f}=t;return{projectId:d,taskId:f,invoiceId:t.invoiceId||n.invoiceId,formTaskId:t.formTaskId||n.formTaskId,formInvoiceId:t.formInvoiceId||n.formInvoiceId,isDrawer:c,isList:e,isDetails:r,isInvoice:s,wasInvoice:a,isForm:i,wasForm:u,isInvoiceForm:o,wasInvoiceForm:l}}(t);return function({tasks:t,invoices:n},e){const{projectId:r,taskId:i,invoiceId:s,formTaskId:o,formInvoiceId:c}=e;return i&&!On(t,{id:i,projectId:r})||s&&!On(n,{id:s,taskId:i})||o&&!On(t,{id:o,projectId:r})||c&&!On(n,{id:c,taskId:i})}(e,r)?Rl(new RangeError("NOT_FOUND")):function({tasks:t}){return 0===t.length}(e)?function(t,{projectId:n,formTaskId:e,isForm:r,wasForm:i}){const s=Pl(t,e);return Z({class:"viewport has-drawers grid is-one"},Sc("Tasks"),zc(r,tf()),ut({class:"is-hidden"}),function(t,n){const e=nc("Add a task",En(t));return ut({class:"view grid-main",classes:{"is-active":n}},Sc("Tasks"),tc({title:"There are no tasks",message:"Create a task with the button below.",action:e}))}(n,!r),nf(s,r,i))}(e,r):function(t,n){const e=function({project:t,invoices:n,tags:e,tasks:r,users:i}){const s=[],o=t=>t.id,c=t.id,a=Ln(e,o),u=Ln(i,o),l=Rn(n,(t=>t.taskId));for(const{...n}of r)n.projectId===c&&(n.project=t,n.invoices=l[n.id]||[],n.tags=Vn(n.tagIds,(t=>a[t])),n.user=u[n.userId]||void 0,s.push(n));return s.sort(_o)}(t),r=n.taskId||e[0].id,i=On(e,{id:r}),s=Pl(t,n.formTaskId),o=function({invoices:t,tasks:n},e){const r=On(t,{id:e});if(!r)return null;const i=On(n,{id:r.taskId});return{...r,task:i}}(t,n.invoiceId),c=function({invoices:t,tasks:n},e,r){const i=On(n,{id:e});return{invoice:r?On(t,{id:r}):{},task:i}}(t,n.taskId,n.formInvoiceId);return Z({class:"viewport has-drawers grid is-two"},Sc("Tasks"),zc(n.isDrawer,tf()),function(t,n,e){return ut({class:"view grid-sidebar",classes:{"is-active":e}},Sc("Tasks"),Bl({tasks:t,activeId:n}))}(e,r,n.isList),function(t,n){return ut({class:"view grid-main",classes:{"is-active":n}},xc("Task",tf()),ud({task:t}))}(i,n.isDetails),nf(s,n.isForm,n.wasForm),function(t,n,e){return n||e?ut({class:"view",classes:{"is-active":n}},xc("Invoice",tf()),Dd({invoice:t})):ut({class:"view"})}(o,n.isInvoice,n.wasInvoice),function(t,n,e){return n||e?ut({class:"view",classes:{"is-active":n}},xc((t.invoice.id?"Edit":"New")+" invoice",tf()),Vd(t)):ut({class:"view"})}(c,n.isInvoiceForm,n.wasInvoiceForm))}(e,r)}),(function(t,n){const e=[ae(n,"page",Qd)];if(mc(t.data)){const{project:n}=vc(t.data,{});e.push((r=n.id,i=Xd("tasks"),[xl,r,i])),e.push(function(t){return[Vl,t]}(Xd("invoices")))}var r,i;return e}),{page:function(t){return Array.isArray(t)&&ql.includes(t[0])}},{ready:!0}));function Jd({page:t},n){const e=t[1].projectId;return[{page:{current:t,retiring:null},data:ac()},...[Jn(!1),Nl(e,Kd),$l(e,Kd)]]}const Qd=t=>({tag:Qd,page:t}),Zd=()=>({tag:Zd}),Kd=t=>({tag:Kd,result:t}),Xd=t=>n=>({tag:Xd,collection:t,changes:n}),tf=()=>({tag:tf});function nf(t,n,e){return n||e?ut({class:"view",classes:{"is-active":n}},xc((t.task.id?"Edit":"New")+" task",tf()),yd(t)):ut({class:"view"})}async function ef(){const t=await Fr();if(!t.user)throw new Error("UNAUTHORIZED");return{currentUser:t.user,users:await yl()}}async function rf(){return await bi(),ef()}function sf({users:t},n){return{user:n?On(t,{id:n}):{}}}function of(t,n){return Lo(Cc(t),Cc(n))}function cf(t){return wo([rf],t)}function af(t,n,e){return wo(t.id?[kl,t,n]:[bl,n],e)}function uf(t,n,e){return wo([kl,t,n],e)}function lf(t,n){return wo([jl,t],n)}function df(t,n){return wo([Dl,t],n)}function ff(t,n){return Ti("users",e=e=>n(t(e))),()=>Pi("users",e);var e}function mf([t]){return ro("AdminUsers"===t?".view.grid-sidebar":"AdminUser"===t?".view.grid-main":"")}function pf(t){return Z({class:"viewport"},Z({class:"view is-active"},Sc("Users"),Oc(t)))}function gf([t]){return Z({class:"viewport grid is-two"},Sc("Users"),ut({class:"view grid-sidebar",classes:{"is-active":"AdminUser"!==t}},Sc("Users"),_c()),function(t){return ut({class:"view grid-main",classes:{"is-active":t}},xc("User"),Rc())}("AdminUser"===t))}const hf=["AdminUsers","AdminUser","NewAdminUser","EditAdminUser"];function vf([t,{id:n,active:e}]){const r="AdminUser"===t,i="NewAdminUser"===t||"EditAdminUser"===t;return{userId:i?e||n:r?n:void 0,formUserId:i?n:void 0,isList:"AdminUsers"===t,isDetails:r,isForm:i}}function wf(t,n,e){const r=[];let i,s=[];for(const o of t){const t=n(o);t!==i&&(i=t,s=[],r.push([i,s])),s.push(e(o))}return r}function If(t,n,e){const r=t.map((([t,n])=>t));return Z({class:"directory"},function(t,n){return tt({class:"directory-list"},...t.map((t=>function([t,n],e){const r="directory-group-"+t.toLowerCase();return nt({id:r,class:"directory-group"},K({class:"directory-group-label"},t),tt({class:"directory-list"},...n.map((t=>function({label:t,path:n},e){return nt({classes:{"directory-item":!0,"is-active":e}},Pe({to:n,class:"directory-item-face"},t))}(t,e(t))))))}(t,n))))}(t,n),function(t,n){return ct({class:"directory-index"},tt({class:"directory-index-list"},...t.map((t=>function(t,n){const e="directory-group-"+t.toLowerCase();return nt({class:"directory-index-item"},X({class:"directory-index-item-face",onClick:Ft(n(e))},t))}(t,n)))))}(r,e))}const yf=se(O((function({users:t,activeId:n},e){return[{activeId:n,groups:jf(t)},null]}),(function(t,n){switch(t.tag){case Af:return n.groups=jf(t.users),[n,null];case bf:return n.activeId=t.id,[n,null];case kf:return[n,io(t.nodeId)];default:throw"Unmatched message"}}),(function({groups:t,activeId:n}){return If(t,(t=>t.id===n),kf)}),(function(t,n){return[ae(n,"users",Af),ae(n,"activeId",bf)]}),{users:Array.isArray,activeId:_n},{}));const Af=t=>({tag:Af,users:t}),bf=t=>({tag:bf,id:t}),kf=t=>({tag:kf,nodeId:t});function jf(t){return wf(t,Cf,Df)}function Cf(t){return Cc(t)[0].toUpperCase()}function Df(t){return{id:t.id,label:Cc(t),path:xn(t.id)}}const Ef=se(O((function({currentUser:t,user:n},e){return[{currentUser:t,user:n,menu:!1},null]}),(function(t,n,e){switch(t.tag){case Tf:return n.currentUser=t.user,[n,null];case Pf:return n.user=t.user,[n,null];case Nf:return[n,(r=n.user.id,i=$f,wo([Cl,r],i))];case $f:return function({result:t},n,e){const r=mo(t)?{type:"success",message:"Success, all user sessions have been closed."}:{type:"danger",message:"An error occured, please try again."};return[n,Xn(r)]}(t,n);case Ff:return[n,lf(n.user.id,Uf)];case Uf:return function({result:t},n,e){const r=mo(t)?{type:"success",message:"Success, a new password was generated."}:{type:"danger",message:"An error occured, please try again."};return[n,Xn(r)]}(t,n);case Sf:return function(t,n,e){const r=jc(n.user),i={isDisabled:!r.isDisabled};return[n,uf(r,i,xf)]}(0,n);case xf:return function({result:t},n,e){return po(t)?[n,Xn({type:"danger",message:"An error occured and the changes couldn’t be saved. Please try again."})]:[n,null]}(t,n);case Mf:return[n,df(n.user.id,Of)];case Of:return function({result:t},n,e){return po(t)?[n,Xn({type:"danger",message:"An error occured and the user couldn’t be deleted. Please try again."})]:[n,Wn(Un())]}(t,n);case Vf:return n.menu=!n.menu,[n,null];case Lf:return n.menu=!1,[n,null];default:throw"Unmatched message"}var r,i}),(function({currentUser:t,user:n,menu:e}){const r=n.id===t.id,{details:i,notes:s}=n.profile;return Z({class:"user"},function(t,n){return at({class:"user-header"},function(t,n){return Yc(n,Vf(),nt({},Pe({to:Mn(t.id)},"Edit user")))}(t,n),lt({class:"title has-subtitle"},Cc(t)),dt({class:"subtitle"},(e=t.email,Ne({href:`mailto:${e}`},K({},e)))),function({isDisabled:t,profile:n}){return Z({class:"project-status"},function(t){return K({class:"tag "+(t?"is-danger":"is-success")},t?"Disabled":"Enabled")}(t),!t&&function({isActive:t,status:n}){const e=t?n?"is-info":"is-success":"is-danger";if(!n){return Z({class:"tag "+e},t?"Active":"Inactive")}return Z({class:"tag "+e},K({class:"tag-label"},"Status:"),K({class:"tag-value"},n))}(n))}(t));var e}(n,e),i&&i.length&&function(t){return ut({class:"user-section"},dt({class:"title"},"Details"),et({class:"user-details-list"},...t.map(Rf)))}(i),s&&function(t){return ut({class:"user-section"},dt({class:"title"},"Notes"),...Vo(t))}(s),!r&&function({isDisabled:t}){return ut({class:"user-section"},dt({class:"title"},"User account"),function(){const t="Close all currently active sessions for this user (all devices). This will force the user to login again with username/email and password across all their devices.";return Z({class:"user-account-item"},ft({class:"user-account-item-title"},"Reset sessions"),pt({},t),kt({class:"button is-primary",onClick:Ft(Nf())},"Close all user sessions"))}(),t?Z({class:"user-account-item"},ft({class:"user-account-item-title"},"Enable account"),pt({},gt({},"This user account is disabled.")," Enable it to allow the user to login and access the platform again."),kt({class:"button is-primary",onClick:Ft(Sf())},"Enable user account")):function(){const t="Block this user’s account: No data will be deleted, but the user won’t be able to login until an administrator enables the account again.";return Z({class:"user-account-item"},ft({class:"user-account-item-title"},"Disable account"),pt({},t),kt({class:"button is-primary",onClick:Ft(Sf())},"Disable user account"))}(),Z({class:"user-account-item"},ft({class:"user-account-item-title"},"Reset password"),pt({class:"callout is-danger"},"This operation is irreversible!"),pt({},"Set a new random password for this user account."),kt({class:"button is-danger",onClick:Ft(Ff())},"Reset user password")),function(){const t="There must be no tasks assigned (old or new) to this user in order to successfully delete this account.";return Z({class:"user-account-item"},ft({class:"user-account-item-title"},"Delete account"),pt({class:"callout is-danger"},"This operation is irreversible!"),pt({class:"callout is-info"},t),pt({},"Permanently delete this user account and profile data."),kt({class:"button is-danger",onClick:Ft(Mf())},"Permanently delete user and all related data"))}())}(n))}),(function({menu:t},n){const e=[ae(n,"currentUser",Tf),ae(n,"user",Pf)];t&&e.push(so(Lf(),{capture:!0}));return e}),{currentUser:va,user:va},{}));const Tf=t=>({tag:Tf,user:t}),Pf=t=>({tag:Pf,user:t}),Nf=()=>({tag:Nf}),$f=t=>({tag:$f,result:t}),Ff=()=>({tag:Ff}),Uf=t=>({tag:Uf,result:t}),Sf=()=>({tag:Sf}),xf=t=>({tag:xf,result:t}),Mf=()=>({tag:Mf}),Of=t=>({tag:Of,result:t}),Vf=()=>({tag:Vf}),Lf=()=>({tag:Lf});function Rf({name:t,value:n}){return Z({class:"user-details-item"},rt({},t),it({},n))}function _f(t){const n=t.profile||{};return new Eu({firstName:Nu("firstName",n.firstName),lastName:Nu("lastName",n.lastName),username:Nu("username",t.username),email:Nu("email",t.email),isActive:Nu("isActive",n.isActive),status:Nu("status",n.status),notes:Nu("notes",n.notes)})}const qf=se(O((function({user:t},n){return[{user:jc(t),form:_f(t),isDisabled:!1},null]}),(function(t,n,e){switch(t.tag){case Wf:return function({user:t},n,e){return n.user=jc(t),n.form=_f(t),[n,null]}(t,n);case Bf:return function({name:t,value:n},e,r){const i=e.form.setValue(t,n),s=Al(e.user,i.getValues());return e.form=$u(i,s,!0),[e,null]}(t,n);case zf:return function(t,n,e){const r=n.form.getValues(),i=Al(n.user,r);if(!i.isValid)return n.form=$u(n.form,i,!1),[n,null];return n.isDisabled=!0,[n,Jn(!1),af(n.user,r,Gf)]}(0,n);case Gf:return function({result:t},n,e){if(po(t))return function(t,n,e){if(n.isDisabled=!1,t instanceof Ji)return n.form=$u(n.form,t,!1),[n,Jn(!0)];return[n,Jn(!0),Xn({type:"danger",message:"An error occured and the changes couldn’t be saved. Please try again."})]}(t.error,n);const{id:r}=ho(t,null);return[n,Jn(!0),qn(xn(r))]}(t,n);default:throw"Unmatched message"}}),(function({user:t,isDisabled:n,form:e}){return ht({class:"form user-form",onSubmit:xt(zf())},vt({disabled:n},Hf(e,"firstName","First name",nu),Hf(e,"lastName","Last name",nu),Hf(e,"username","Username",nu),Hf(e,"email","Email",nu),function(t){const n=t.get("isActive"),e=t.get("status"),r=e.errors.join(", ");return Z({classes:{field:!0,"has-error":!!r}},wt({class:"label"},"Status"),Z({class:"control"},function({value:t}){return wt({class:"checkbox"},function(t,n,e={}){return It({...e,checked:t,type:"checkbox",class:tu("checkbox",e.class),onChange:n&&(r=n,(t,n)=>n(r(t.target.checked)))});var r}(t,Bf("isActive"))," Is active?")}(n),function({value:t}){return nu(t,Bf("status"),{placeholder:"Status message..."})}(e)),r&&pt({class:"help is-error"},r))}(e),Hf(e,"notes","Notes",eu)),kt({type:"submit",class:"button is-primary",disabled:n},t.id?"Save user":"Add user"))}),(function(t,n){return[ae(n,"user",Wf)]}),{user:va},{}));const Wf=t=>({tag:Wf,user:t}),Bf=t=>n=>({tag:Bf,name:t,value:n}),zf=()=>({tag:zf}),Gf=t=>({tag:Gf,result:t});function Hf(t,n,e,r){const{value:i,errors:s,props:o}=t.get(n);return Xa(e,r(i,Bf(n),o),s.join(", "))}const Yf=se(O((function({page:t},n){const e={page:{current:t,retiring:null},data:ac()},r=[Jn(!1),(i=Zf,wo([ef],i)),cf(Zf)];var i;return[e,...r]}),(function(t,n,e){switch(t.tag){case Jf:return n.page={current:t.page,retiring:n.page.current},[n,mf(t.page),de(300,Qf())];case Qf:return n.page.retiring=null,[n,null];case Zf:return function({result:t},n,e){const r=n.data,i=fc(r),s=po(t)&&Mc(t.error),o=pc(r)&&Mc(r.error);return n.data=mo(t)?uc(t.data):mc(r)?n.data:lc(t.error),s?[n,o?null:ic()]:i?[n,ce(e,"ready"),Jn(!0)]:[n,null]}(t,n,e);case Kf:return function({changes:t},n,e){return n.data=hc(n.data,(n=>(n.users=Ts(n.users,t),n))),[n,null]}(t,n);case Xf:return[n,Bn()];default:throw"Unmatched message"}}),(function({page:t,data:n}){if(pc(n))return pf(n.error);if(!mc(n))return gf(t.current);const e=vc(n,{}),r=function({current:t,retiring:n}){t=vf(t),n=n&&vf(n);const{isList:e,isDetails:r,isForm:i}=t,s=i,o=n&&n.isForm;return{userId:t.userId,formUserId:t.formUserId||n&&n.formUserId,isDrawer:s,isList:e,isDetails:r,isForm:i,wasForm:o}}(t);return function({users:t},n){const{userId:e,formUserId:r}=n;return e&&!On(t,{id:e})||r&&!On(t,{id:r})}(e,r)?pf(new RangeError("NOT_FOUND")):function({users:t}){return 0===t.length}(e)?function(t,{formUserId:n,isForm:e,wasForm:r}){const i=sf(t,n);return Z({class:"viewport has-drawers grid is-one"},Sc("Users"),zc(e,Xf()),ut({class:"is-hidden"}),function(t){const n=nc("Add a user",Sn());return ut({class:"view grid-main",classes:{"is-active":t}},Sc("Users"),tc({title:"There are no users",message:"Create your first user with the button below.",action:n}))}(!e),tm(i,e,r))}(e,r):function(t,n){const e=t.currentUser,r=function({users:t}){return t.sort(of)}(t),i=n.userId||r[0].id,s=On(r,{id:i}),o=sf(t,n.formUserId);return Z({class:"viewport has-drawers grid is-two"},Sc("Users"),zc(n.isDrawer,Xf()),function(t,n,e){return ut({class:"view grid-sidebar",classes:{"is-active":e}},Sc("Users"),yf({users:t,activeId:n}))}(r,i,n.isList),function(t,n,e){return ut({class:"view grid-main",classes:{"is-active":e}},xc("User",Xf()),Ef({currentUser:t,user:n}))}(e,s,n.isDetails),tm(o,n.isForm,n.wasForm))}(e,r)}),(function(t,n){const e=[ae(n,"page",Jf)];mc(t.data)&&e.push((r=Kf,[ff,r]));var r;return e}),{page:function(t){return Array.isArray(t)&&hf.includes(t[0])}},{ready:!0}));const Jf=t=>({tag:Jf,page:t}),Qf=()=>({tag:Qf}),Zf=t=>({tag:Zf,result:t}),Kf=t=>({tag:Kf,changes:t}),Xf=()=>({tag:Xf});function tm(t,n,e){return n||e?ut({class:"view",classes:{"is-active":n}},xc((t.user.id?"Edit":"New")+" user",Xf()),qf(t)):ut({class:"view"})}async function nm(){return{clients:await Eo()}}async function em(){return await bi(),nm()}function rm({clients:t},n){return{client:n?On(t,{id:n}):{}}}function im(t){return wo([em],t)}function sm(t,n,e){return wo(t.id?[No,t,n]:[Po,n],e)}function om(t,n){return Ti("clients",e=e=>n(t(e))),()=>Pi("clients",e);var e}function cm([t]){return ro("AdminClients"===t?".view.grid-sidebar":"AdminClient"===t?".view.grid-main":"")}function am(t){return Z({class:"viewport"},Z({class:"view is-active"},Sc("Clients"),Oc(t)))}function um([t]){return Z({class:"viewport grid is-two"},Sc("Clients"),ut({class:"view grid-sidebar",classes:{"is-active":"AdminClient"!==t}},Sc("Clients"),_c()),function(t){return ut({class:"view grid-main",classes:{"is-active":t}},xc("Client"),Rc())}("AdminClient"===t))}const lm=["AdminClients","AdminClient","NewAdminClient","EditAdminClient"];function dm([t,{id:n,active:e}]){const r="AdminClient"===t,i="NewAdminClient"===t||"EditAdminClient"===t;return{clientId:i?e||n:r?n:void 0,formClientId:i?n:void 0,isList:"AdminClients"===t,isDetails:r,isForm:i}}const fm=se(O((function({clients:t,activeId:n},e){return[{activeId:n,groups:hm(t)},null]}),(function(t,n){switch(t.tag){case mm:return n.groups=hm(t.clients),[n,null];case pm:return n.activeId=t.id,[n,null];case gm:return[n,io(t.nodeId)];default:throw"Unmatched message"}}),(function({groups:t,activeId:n}){return If(t,(t=>t.id===n),gm)}),(function(t,n){return[ae(n,"clients",mm),ae(n,"activeId",pm)]}),{clients:Array.isArray,activeId:_n},{}));const mm=t=>({tag:mm,clients:t}),pm=t=>({tag:pm,id:t}),gm=t=>({tag:gm,nodeId:t});function hm(t){return wf(t,vm,wm)}function vm({name:t}){return t[0].toUpperCase()}function wm({id:t,name:n}){return{id:t,label:n,path:mn(t)}}const Im=se(O((function({client:t},n){return[{client:t,menu:!1},null]}),(function(t,n,e){switch(t.tag){case ym:return n.client=t.client,[n,null];case Am:return[n,(r=n.client.id,i=bm,wo([$o,r],i))];case bm:return function({result:t},n,e){return po(t)?[n,Xn({type:"danger",message:"An error occured and the client couldn’t be deleted. Please try again."})]:[n,Wn(dn())]}(t,n);case km:return n.menu=!n.menu,[n,null];case jm:return n.menu=!1,[n,null];default:throw"Unmatched message"}var r,i}),(function({client:t,menu:n}){return Z({class:"client-account"},function(t,n){return at({class:"client-account-header"},function({id:t},n){return Yc(n,km(),nt({},Pe({to:gn(t)},"Client accounts")),nt({},Pe({to:pn(t)},"Edit client")),nt({},Pe({onClick:Ft(Am())},"Delete client")))}(t,n),lt({class:"title"},t.name))}(t,n),t.notes&&function({notes:t}){return ut({class:"client-account-section"},dt({class:"title"},"Notes"),...Vo(t))}(t))}),(function({menu:t},n){const e=[ae(n,"client",ym)];t&&e.push(so(jm(),{capture:!0}));return e}),{client:va},{}));const ym=t=>({tag:ym,client:t}),Am=()=>({tag:Am}),bm=t=>({tag:bm,result:t}),km=()=>({tag:km}),jm=()=>({tag:jm});function Cm(t){return new Eu({name:Nu("name",t.name),notes:Nu("notes",t.notes)})}const Dm=se(O((function({client:t},n){return[{client:t,form:Cm(t),isDisabled:!1},null]}),(function(t,n,e){switch(t.tag){case Em:return function({client:t},n,e){return n.client=t,n.form=Cm(t),[n,null]}(t,n);case Tm:return function({name:t,value:n},e,r){const i=e.form.setValue(t,n),s=To(e.client,i.getValues());return e.form=$u(i,s,!0),[e,null]}(t,n);case Pm:return function(t,n,e){const r=n.form.getValues(),i=To(n.client,r);if(!i.isValid)return n.form=$u(n.form,i,!1),[n,null];return n.isDisabled=!0,[n,Jn(!1),sm(n.client,r,Nm)]}(0,n);case Nm:return function({result:t},n,e){if(po(t))return function(t,n,e){if(n.isDisabled=!1,t instanceof Ji)return n.form=$u(n.form,t,!1),[n,Jn(!0)];return[n,Jn(!0),Xn({type:"danger",message:"An error occured and the changes couldn’t be saved. Please try again."})]}(t.error,n);const{id:r}=ho(t,null);return[n,Jn(!0),qn(mn(r))]}(t,n);default:throw"Unmatched message"}}),(function({client:t,isDisabled:n,form:e}){return ht({class:"form client-form",onSubmit:xt(Pm())},vt({disabled:n},$m(e,"name","Name",nu),$m(e,"notes","Notes",eu)),kt({type:"submit",class:"button is-primary",disabled:n},t.id?"Save client":"Add client"))}),(function(t,n){return[ae(n,"client",Em)]}),{client:va},{}));const Em=t=>({tag:Em,client:t}),Tm=t=>n=>({tag:Tm,name:t,value:n}),Pm=()=>({tag:Pm}),Nm=t=>({tag:Nm,result:t});function $m(t,n,e,r){const{value:i,errors:s,props:o}=t.get(n);return Xa(e,r(i,Tm(n),o),s.join(", "))}const Fm=se(O((function({page:t},n){const e={page:{current:t,retiring:null},data:ac()},r=[Jn(!1),(i=xm,wo([nm],i)),im(xm)];var i;return[e,...r]}),(function(t,n,e){switch(t.tag){case Um:return n.page={current:t.page,retiring:n.page.current},[n,cm(t.page),de(300,Sm())];case Sm:return n.page.retiring=null,[n,null];case xm:return function({result:t},n,e){const r=n.data,i=fc(r),s=po(t)&&Mc(t.error),o=pc(r)&&Mc(r.error);return n.data=mo(t)?uc(t.data):mc(r)?n.data:lc(t.error),s?[n,o?null:ic()]:i?[n,ce(e,"ready"),Jn(!0)]:[n,null]}(t,n,e);case Mm:return function({changes:t},n,e){return n.data=hc(n.data,(n=>(n.clients=Ts(n.clients,t),n))),[n,null]}(t,n);case Om:return[n,Bn()];default:throw"Unmatched message"}}),(function({page:t,data:n}){if(pc(n))return am(n.error);if(!mc(n))return um(t.current);const e=vc(n,{}),r=function({current:t,retiring:n}){t=dm(t),n=n&&dm(n);const{isList:e,isDetails:r,isForm:i}=t,s=i,o=n&&n.isForm;return{clientId:t.clientId,formClientId:t.formClientId||n&&n.formClientId,isDrawer:s,isList:e,isDetails:r,isForm:i,wasForm:o}}(t);return function({clients:t},n){const{clientId:e,formClientId:r}=n;return e&&!On(t,{id:e})||r&&!On(t,{id:r})}(e,r)?am(new RangeError("NOT_FOUND")):function({clients:t}){return 0===t.length}(e)?function(t,{formClientId:n,isForm:e,wasForm:r}){const i=rm(t,n);return Z({class:"viewport has-drawers grid is-one"},Sc("Clients"),zc(e,Om()),ut({class:"is-hidden"}),function(t){const n=nc("Add a client",fn());return ut({class:"view grid-main",classes:{"is-active":t}},Sc("Clients"),tc({title:"There are no clients",message:"Create your first client with the button below.",action:n}))}(!e),Vm(i,e,r))}(e,r):function(t,n){const e=function({clients:t}){return t.sort(Ro)}(t),r=n.clientId||e[0].id,i=On(e,{id:r}),s=rm(t,n.formClientId);return Z({class:"viewport has-drawers grid is-two"},Sc("Clients"),zc(n.isDrawer,Om()),function(t,n,e){return ut({class:"view grid-sidebar",classes:{"is-active":e}},Sc("Clients"),fm({clients:t,activeId:n}))}(e,r,n.isList),function(t,n){return ut({class:"view grid-main",classes:{"is-active":n}},xc("Client",Om()),Im({client:t}))}(i,n.isDetails),Vm(s,n.isForm,n.wasForm))}(e,r)}),(function(t,n){const e=[ae(n,"page",Um)];mc(t.data)&&e.push((r=Mm,[om,r]));var r;return e}),{page:function(t){return Array.isArray(t)&&lm.includes(t[0])}},{ready:!0}));const Um=t=>({tag:Um,page:t}),Sm=()=>({tag:Sm}),xm=t=>({tag:xm,result:t}),Mm=t=>({tag:Mm,changes:t}),Om=()=>({tag:Om});function Vm(t,n,e){return n||e?ut({class:"view",classes:{"is-active":n}},xc((t.client.id?"Edit":"New")+" client",Om()),Dm(t)):ut({class:"view"})}async function Lm(t){const[n,e]=await Promise.all([(r=t,ji("clients",r)),Uo((n=>n.clientId===t))]);var r;return{client:n,clientAccounts:e}}async function Rm(t){return await bi(),Lm(t)}function _m({client:t,clientAccounts:n},e){return{client:t,clientAccount:e?On(n,{id:e}):{}}}function qm(t,n){return wo([Lm,t],n)}function Wm(t,n){return wo([Rm,t],n)}function Bm(t,n,e){return wo(t.id?[Mo,t,n]:[xo,n],e)}function zm(t,n,e){return Ti("clientAccounts",r=r=>{if(null===r)return e(n(null));(r=r.filter((n=>n.tombstone||n.clientId===t))).length>0&&e(n(r))}),()=>Pi("clientAccounts",r);var r}function Gm([t]){return ro("AdminClientAccounts"===t?".view.grid-sidebar":"AdminClientAccount"===t?".view.grid-main":"")}function Hm(t){return Z({class:"viewport"},Z({class:"view is-active"},Sc("Client accounts"),Oc(t)))}function Ym([t]){return Z({class:"viewport grid is-two"},Sc("Client accounts"),ut({class:"view grid-sidebar",classes:{"is-active":"AdminClientAccount"!==t}},Sc("Client accounts"),_c()),function(t){return ut({class:"view grid-main",classes:{"is-active":t}},xc("Client account"),Rc())}("AdminClientAccount"===t))}const Jm=["AdminClientAccounts","AdminClientAccount","NewAdminClientAccount","EditAdminClientAccount"];function Qm([t,{clientId:n,id:e,active:r}]){const i="AdminClientAccount"===t,s="NewAdminClientAccount"===t||"EditAdminClientAccount"===t;return{clientId:n,clientAccountId:s?r||e:i?e:void 0,formClientAccountId:s?e:void 0,isList:"AdminClientAccounts"===t,isDetails:i,isForm:s}}const Zm=se(O((function({clientAccounts:t,activeId:n},e){return[{activeId:n,groups:np(t)},null]}),(function(t,n){switch(t.tag){case Km:return n.groups=np(t.clientAccounts),[n,null];case Xm:return n.activeId=t.id,[n,null];case tp:return[n,io(t.nodeId)];default:throw"Unmatched message"}}),(function({groups:t,activeId:n}){return If(t,(t=>t.id===n),tp)}),(function(t,n){return[ae(n,"clientAccounts",Km),ae(n,"activeId",Xm)]}),{clientAccounts:Array.isArray,activeId:_n},{}));const Km=t=>({tag:Km,clientAccounts:t}),Xm=t=>({tag:Xm,id:t}),tp=t=>({tag:tp,nodeId:t});function np(t){return wf(t,ep,rp)}function ep({name:t}){return t[0].toUpperCase()}function rp({id:t,clientId:n,name:e}){return{id:t,label:e,path:vn(n,t)}}const ip=se(O((function({clientAccount:t},n){return[{clientAccount:t,menu:!1},null]}),(function(t,n,e){switch(t.tag){case sp:return n.clientAccount=t.clientAccount,[n,null];case op:return[n,(r=n.clientAccount.id,i=cp,wo([Oo,r],i))];case cp:return function({result:t},n,e){if(po(t))return[n,Xn({type:"danger",message:"An error occured and the account couldn’t be deleted. Please try again."})];const{clientId:r}=ho(t,null);return[n,Wn(gn(r))]}(t,n);case ap:return n.menu=!n.menu,[n,null];case up:return n.menu=!1,[n,null];default:throw"Unmatched message"}var r,i}),(function({clientAccount:t,menu:n}){return Z({class:"client-account"},function(t,n){return at({class:"client-account-header"},function({clientId:t,id:n},e){return Yc(e,ap(),nt({},Pe({to:wn(t,n)},"Edit account")),nt({},Pe({onClick:Ft(op())},"Delete account")))}(t,n),lt({class:"title has-subtitle"},t.name),dt({class:"subtitle"},function({id:t,name:n}){return Ne({to:mn(t)},K({},n))}(t.client)))}(t,n),t.notes&&function({notes:t}){return ut({class:"client-account-section"},dt({class:"title"},"Notes"),...Vo(t))}(t))}),(function({menu:t},n){const e=[ae(n,"clientAccount",sp)];t&&e.push(so(up(),{capture:!0}));return e}),{clientAccount:va},{}));const sp=t=>({tag:sp,clientAccount:t}),op=()=>({tag:op}),cp=t=>({tag:cp,result:t}),ap=()=>({tag:ap}),up=()=>({tag:up});function lp(t,n){return new Eu({clientId:t.clientId||n.id,name:Nu("name",t.name),notes:Nu("notes",t.notes)})}const dp=se(O((function({clientAccount:t,client:n},e){return[{clientAccount:t,client:n,form:lp(t,n),isDisabled:!1},null]}),(function(t,n,e){switch(t.tag){case fp:return function({clientAccount:t},n,e){return n.clientAccount=t,n.form=lp(t,n.client),[n,null]}(t,n);case mp:return function({name:t,value:n},e,r){const i=e.form.setValue(t,n),s=So(e.clientAccount,i.getValues());return e.form=$u(i,s,!0),[e,null]}(t,n);case pp:return function(t,n,e){const r=n.form.getValues(),i=So(n.clientAccount,r);if(!i.isValid)return n.form=$u(n.form,i,!1),[n,null];return n.isDisabled=!0,[n,Jn(!1),Bm(n.clientAccount,r,gp)]}(0,n);case gp:return function({result:t},n,e){if(po(t))return function(t,n,e){if(n.isDisabled=!1,t instanceof Ji)return n.form=$u(n.form,t,!1),[n,Jn(!0)];return[n,Jn(!0),Xn({type:"danger",message:"An error occured and the changes couldn’t be saved. Please try again."})]}(t.error,n);const{clientId:r,id:i}=ho(t,null),s=vn(r,i);return[n,Jn(!0),qn(s)]}(t,n);default:throw"Unmatched message"}}),(function({clientAccount:t,isDisabled:n,form:e}){return ht({class:"form client-account-form",onSubmit:xt(pp())},vt({disabled:n},hp(e,"name","Name",nu),hp(e,"notes","Notes",eu)),kt({type:"submit",class:"button is-primary",disabled:n},t.id?"Save account":"Add account"))}),(function(t,n){return[ae(n,"clientAccount",fp)]}),{clientAccount:va,client:va},{}));const fp=t=>({tag:fp,clientAccount:t}),mp=t=>n=>({tag:mp,name:t,value:n}),pp=()=>({tag:pp}),gp=t=>({tag:gp,result:t});function hp(t,n,e,r){const{value:i,errors:s,props:o}=t.get(n);return Xa(e,r(i,mp(n),o),s.join(", "))}const vp=se(O(wp,(function(t,n,e){switch(t.tag){case Ip:return function({page:t},n,e){const r=n.page.current,i=t[1].clientId,s=r[1].clientId;return i!==s?wp({page:t}):(n.page={current:t,retiring:r},[n,Gm(t),de(300,yp())])}(t,n);case yp:return n.page.retiring=null,[n,null];case Ap:return function({result:t},n,e){const r=n.data,i=fc(r),s=po(t)&&Mc(t.error),o=pc(r)&&Mc(r.error);return n.data=mo(t)?uc(t.data):mc(r)?n.data:lc(t.error),s?[n,o?null:ic()]:i?[n,ce(e,"ready"),Jn(!0)]:[n,null]}(t,n,e);case bp:return function({changes:t},n,e){return n.data=hc(n.data,(n=>(n.clientAccounts=Ts(n.clientAccounts,t),n))),[n,null]}(t,n);case kp:return[n,Bn()];default:throw"Unmatched message"}}),(function({page:t,data:n}){if(pc(n))return Hm(n.error);if(!mc(n))return Ym(t.current);const e=vc(n,{}),r=function({current:t,retiring:n}){t=Qm(t),n=n&&Qm(n);const{isList:e,isDetails:r,isForm:i,clientId:s,clientAccountId:o}=t,c=i,a=n&&n.isForm;return{clientId:s,clientAccountId:o,formClientAccountId:t.formClientAccountId||n&&n.formClientAccountId,isDrawer:c,isList:e,isDetails:r,isForm:i,wasForm:a}}(t);return function({clientAccounts:t},n){const{clientId:e,clientAccountId:r,formClientAccountId:i}=n;return r&&!On(t,{id:r,clientId:e})||i&&!On(t,{id:i,clientId:e})}(e,r)?Hm(new RangeError("NOT_FOUND")):function({clientAccounts:t}){return 0===t.length}(e)?function(t,{clientId:n,formClientAccountId:e,isForm:r,wasForm:i}){const s=_m(t,e);return Z({class:"viewport has-drawers grid is-one"},Sc("Client accounts"),zc(r,kp()),ut({class:"is-hidden"}),function(t,n){const e=nc("Add an account",hn(t));return ut({class:"view grid-main",classes:{"is-active":n}},Sc("Client accounts"),tc({title:"There are no client accounts",message:"Create an account with the button below.",action:e}))}(n,!r),jp(s,r,i))}(e,r):function(t,n){const e=function({client:t,clientAccounts:n}){const e=[],r=t.id;for(const{...i}of n)i.clientId===r&&(i.client=t,e.push(i));return e.sort(Ro)}(t),r=n.clientAccountId||e[0].id,i=On(e,{id:r}),s=_m(t,n.formClientAccountId);return Z({class:"viewport has-drawers grid is-two"},Sc("Client accounts"),zc(n.isDrawer,kp()),function(t,n,e){return ut({class:"view grid-sidebar",classes:{"is-active":e}},Sc("Client accounts"),Zm({clientAccounts:t,activeId:n}))}(e,r,n.isList),function(t,n){return ut({class:"view grid-main",classes:{"is-active":n}},xc("Client account",kp()),ip({clientAccount:t}))}(i,n.isDetails),jp(s,n.isForm,n.wasForm))}(e,r)}),(function(t,n){const e=[ae(n,"page",Ip)];if(mc(t.data)){const{client:n}=vc(t.data,{});e.push([zm,n.id,bp])}return e}),{page:function(t){return Array.isArray(t)&&Jm.includes(t[0])}},{ready:!0}));function wp({page:t},n){const e=t[1].clientId;return[{page:{current:t,retiring:null},data:ac()},...[Jn(!1),qm(e,Ap),Wm(e,Ap)]]}const Ip=t=>({tag:Ip,page:t}),yp=()=>({tag:yp}),Ap=t=>({tag:Ap,result:t}),bp=t=>({tag:bp,changes:t}),kp=()=>({tag:kp});function jp(t,n,e){if(!n&&!e)return ut({class:"view"});const r=!!t.clientAccount.id;return ut({class:"view",classes:{"is-active":n}},xc((r?"Edit":"New")+" client account",kp()),dp(t))}function Cp(t){switch(t[0]){case"AdminProjects":case"AdminProject":case"NewAdminProject":case"EditAdminProject":case"AdminProjectInvoice":case"NewAdminProjectInvoice":case"EditAdminProjectInvoice":return"AdminProjects";case"AdminTasks":case"AdminTask":case"NewAdminTask":case"EditAdminTask":case"AdminTaskInvoice":case"NewAdminTaskInvoice":case"EditAdminTaskInvoice":return"AdminTasks";case"AdminUsers":case"AdminUser":case"NewAdminUser":case"EditAdminUser":return"AdminUsers";case"AdminClients":case"AdminClient":case"NewAdminClient":case"EditAdminClient":return"AdminClients";case"AdminClientAccounts":case"AdminClientAccount":case"NewAdminClientAccount":case"EditAdminClientAccount":return"AdminClientAccounts";default:return"NotFound"}}const Dp=se(O((function({state:t},n){return[{isReady:!0,current:t,retiring:null},null]}),(function(t,n,e){switch(t.tag){case Ep:return n.isReady=!1,n.retiring=n.current,n.current=t.state,[n,null];case Tp:return n.isReady=!0,[n,de(300,Pp())];case Pp:return n.retiring=null,[n,null];default:throw"Unmatched message"}}),(function(t){const n=function({isReady:t,current:n,retiring:e}){if(null===e||Cp(n.page)===Cp(e.page))return[[n.page,!0,!1]];const r=[n.page,t,!t],i=[e.page,!t,!1];return n.timestamp>e.timestamp?[i,r]:[r,i]}(t),e=t.current.page;return Z({class:"dashboard"},$e(e),J("main",{class:"dashboard-main viewport"},...n.map(Np)))}),(function(t,n){return[ae(n,"state",Ep)]}),{state:t=>t&&Array.isArray(t.page)},{}));const Ep=t=>({tag:Ep,state:t}),Tp=()=>({tag:Tp}),Pp=()=>({tag:Pp});function Np([t,n,e]){const r=Cp(t);return[r,$p({isActive:n},function(t){switch(t){case"AdminProjects":return fl;case"AdminTasks":return Yd;case"AdminUsers":return Yf;case"AdminClients":return Fm;case"AdminClientAccounts":return vp;default:return Se}}(r)({page:t,onReady:e?$t(Tp()):void 0}))]}function $p({isActive:t},...n){return Z({classes:{view:!0,"is-active":t}},...n)}const Fp=se(O((function(t,n){return[{redirect:t.r||un(),login:"",password:"",disabled:!0,error:null},ec(Up)]}),(function(t,n,e){switch(t.tag){case Up:return function({result:t},n,e){const r=ho(t,{}).user?qn(n.redirect):ce(e,"statuschange","ready");return n.disabled=!1,[n,r]}(t,n,e);case Sp:return n.login=t.value,[n,null];case xp:return n.password=t.value,[n,null];case Mp:return function(t,n,e){const{login:r,password:i}=n;if(!r||!i)return n.error="Missing login or password",[n,null];return n.error=null,n.disabled=!0,[n,rc(r,i,Op)]}(0,n);case Op:return function({result:t},n,e){if(mo(t))return[n,qn(n.redirect)];const r=t.error||{};return n.disabled=!1,n.error="BAD_CREDENTIALS"===r.message?"Wrong username/email or password.":"An error occured.",[n,null]}(t,n);default:throw"Unmatched message"}}),(function(t){return Z({class:"login-page"},Z({class:"login-page-content"},lt({class:"login-page-greeting"},"Welcome to TSociety"),pt({class:"has-centered-text has-mute-text"},"Enter your credentials to access your account"),function({login:t,password:n,error:e,disabled:r}){return ht({class:"form login-page-form",onSubmit:xt(Mp())},e&&pt({class:"alert is-danger is-fullwidth"},e),vt({disabled:r},Vp("Login",t,Sp,iu),Vp("Password",n,xp,su)),kt({type:"submit",class:"button is-primary is-fullwidth",disabled:r},"Login"))}(t)))}),(function(t,n){return[]}),{redirect:_n},{statuschange:_n}));const Up=t=>({tag:Up,result:t}),Sp=t=>({tag:Sp,value:t}),xp=t=>({tag:xp,value:t}),Mp=()=>({tag:Mp}),Op=t=>({tag:Op,result:t});function Vp(t,n,e,r){return Xa(t,r(n,e))}const Lp=O((function(t,n){const e=Rp(t),r=e.page,i={state:e,isReady:!0,notifications:[]};return _n(r)?[{...i,state:null},qn(r)]:[i,zn(e)]}),(function(t,n,e){switch(t.tag){case _p:return function({url:t,state:n},e,r){const i=Rp(t,n),s=i.page;return _n(s)?[e,qn(s)]:(e.state=i,e.isReady=!0,e.notifications=[],i!==n?[e,zn(i)]:[e,null])}(t,n);case qp:return n.isReady=t.isReady,[n,null];case Wp:return n.notifications=(r=n.notifications,i=t.notification,r.unshift(function(t){!_n(t)&&"message"in t||(t={type:"info",message:t});const{type:n,message:e}=t;return{id:String(Date.now()),type:n,message:e}}(i)),r.splice(5,r.length),r),[n,null];case Bp:return n.notifications=n.notifications.filter((n=>n.id!==t.id)),[n,null];default:throw"Unmatched message"}var r,i}),(function({state:t,isReady:n,notifications:e}){return[(r=!n,Z({classes:{"app-progress":!0,"is-active":r}},Z({class:"app-progress-scaffold is-primary"},Z({class:"app-progress-bar"})),Z({class:"app-progress-scaffold is-secondary"},Z({class:"app-progress-bar"})))),zp(t),Gp(e)];var r}),(function(t,n){return[(e=_p,[Hn,e]),Qn(qp),te(Wp)];var e}));function Rp(t,n){return n&&void 0!==n.timestamp?n:{page:en(t),timestamp:Date.now()}}const _p=(t,n)=>({tag:_p,url:t,state:n}),qp=t=>({tag:qp,isReady:t}),Wp=t=>({tag:Wp,notification:t}),Bp=t=>({tag:Bp,id:t});function zp(t){if(null===t)return Z({});const[n,e]=t.page;return"Login"===n?Fp({}):Dp({state:t})}function Gp(t){return J("ul",{class:"app-notifications",aria:{live:"polite",atomic:"true"}},...t.map((t=>[t.id,Hp(t)])))}function Hp({id:t,type:n,message:e}){return nt({role:"alert",class:`notification is-${n}`,aria:{live:"assertive",atomic:"true"}},Z({class:"notification-body"},...function(t=[]){return Array.isArray(t)?t:null==t?[]:[t]}(e)),kt({type:"button",class:"button is-close",aria:{label:"Close"},onClick:Ft(Bp(t))}))}!function(){const t=sessionStorage.redirect;delete sessionStorage.redirect,history.replaceState(null,"",t);const n=document.getElementById("app");n.classList.add("app"),n.innerHTML="",V(n,Lp,[location])}(),console.log("App is ready.");
