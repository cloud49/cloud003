!function(){"use strict";const t=document.createElement.bind(document),n=document.createElementNS.bind(document),e=document.createTextNode.bind(document),r=document.createDocumentFragment.bind(document);function i(e,r){return void 0===e?t(r):n(e,r)}const s=window.requestIdleCallback||((t,{timeout:n}={})=>setTimeout(t,n));function o(t){const{nodeType:n,namespaceURI:e,attributes:r,childNodes:i}=t;if(3===n)return t.textContent;if(1!==n)return null;t.__vdom__||(t.__vdom__={handlers:{}});const s=t.tagName.toLowerCase(),c="http://www.w3.org/1999/xhtml"===e?void 0:e,a={},u=[];for(const{nodeName:t,nodeValue:n}of r)a[t]=n;for(const t of i){const n=o(t);n&&u.push(n)}return{namespace:c,name:s,attributes:a,events:{},children:u}}function c(t,n={}){if("string"==typeof t)return e(t);if(void 0!==t.create)return t.create(t,n);const{namespace:r,name:s,attributes:o,events:a,children:d}=t,f=i(r,s);f.__vdom__={handlers:{}},u(f,o,{}),l(f,a,{},n);for(const t of d)f.appendChild(c(t,n));return f}function a(t,n,e=o(t),r={}){return n===e?t:!n||function(t,n){return t!==n&&"string"==typeof t||"string"==typeof n||t.name!==n.name||t.namespace!==n.namespace||t.patch!==n.patch}(n,e)?f(t,n,e,r):void 0!==n.patch?n.patch(t,n,e,r):(u(t,n.attributes,e.attributes),l(t,n.events,e.events,r),d(t,n.children,e.children,r),t)}function u(t,n,e){const r={...e,...n};for(const i in r){let r=n[i];r!==e[i]&&("value"===i?t.value=void 0===r?"":r:"boolean"==typeof r&&(t[i]=r,r=r?i:void 0),void 0!==r?t.setAttribute(i,r):t.removeAttribute(i))}return t}function l(t,n,e,{lift:r}={}){const i={...e,...n},s=t.__vdom__.handlers;for(const o in i){let i=s[o],c=n[o];const a=e[o];c?(a||(i=s[o]=t=>i.action(t),t.addEventListener(o,i)),void 0!==r&&(c=r(c,a,i.action)),i.action=c):(t.removeEventListener(o,i),delete s[o])}return t}function d(t,n,e,i={}){void 0===e&&(e=Array.from(t.childNodes).map(o));const s=t.childNodes,u=n.length,l=e.length,d=Math.min(u,l);for(let t=0;t<d;t++)a(s[t],n[t],e[t],i);for(let t=u;t<l;t++)f(s[u],null,e[t],i);if(u>l){const e=r();for(let t=l;t<u;t++)e.appendChild(c(n[t],i));t.appendChild(e)}return t}function f(t,n,e,r={}){const i=t.parentNode,o=n?c(n,r):null;return i&&(o?i.replaceChild(o,t):i.removeChild(t)),(void 0!==e.unmount||e.children)&&s((()=>m(t,e)),{timeout:3e3}),o}function m(t,n){if(void 0!==n.unmount)return n.unmount(t,n);const e=t.childNodes,r=n.children||[];for(let t=0,n=r.length;t<n;t++)m(e[t],r[t]);return t}function p(t){if(!t||"string"!=typeof t||"length"===t)throw new RangeError("Invalid topic")}function g(t,n,e){p(n);const r=t[n]=t[n]||[];for(const n of r)if(n===e)return t;return t.length=(t.length||0)+1,r.push(e),t}function h(t,n,e){p(n);const r=t[n]||[],i=t[n]=[];for(const n of r)n===e?t.length=(t.length||1)-1:i.push(n);return i.length||delete t[n],t}function v(t,n,...e){p(n);const r=t[n]||[];for(const t of r)new Promise((n=>{t(...e),n()}));return t}class w{constructor(){this.isOpen=!0,this.ports=[]}createPort(){!function({isOpen:t}){if(!t)throw new Error("Channel is closed.")}(this);const t=new I(this);return this.ports.push(t),t}close(){const t=this.ports;this.ports=[],this.isOpen=!1;for(const n in t)n.close()}}class I{constructor(t){this.subs={},this.isOpen=!0,this.channel=t}subscribe(t,n){y(this),g(this.subs,t,n)}unsubscribe(t,n){y(this),h(this.subs,t,n)}publish(t,...n){y(this);const e=this.channel.ports;for(const r of e)r!==this&&v(r.subs,t,...n)}close(){const t=this.channel;this.subs={},this.isOpen=!1,this.channel=null,t.ports=t.ports.filter((t=>t!==this))}}function y({isOpen:t}){if(!t)throw new Error("Port is closed.")}function A(t,{topicsIn:n,topicsOut:e}){return new b(t.createPort(),n,e)}class b{constructor(t,n,e){this.port=t,this.topicsIn=n,this.topicsOut=e}publish(t,...n){const e=this.topicsIn;k(e,t),function(t,n,...e){const r=t[n];if(!0!==r&&!r(...e))throw new TypeError("Invalid port message")}(e,t,...n),this.port.publish(t,...n)}subscribe(t,n){k(this.topicsOut,t),this.port.subscribe(t,n)}unsubscribe(t,n){k(this.topicsOut,t),this.port.unsubscribe(t,n)}}function k(t,n){if(!t[n])throw new RangeError(`Invalid port topic: "${n}"`)}const j=Function.prototype.call,C=j.bind(Object.prototype.toString),D=j.bind(Object.prototype.hasOwnProperty),E=t=>"number"==typeof t&&t!=t;function T(t,n){if(t===n)return!0;if(E(t))return E(n);if("object"!=typeof t||"object"!=typeof n)return!1;const e=C(t);if(C(n)!==e)return!1;if("[object Date]"===e)return t.getTime()===n.getTime();if("length"in t){let e=t.length;if(n.length!==e)return!1;for(;e--;)if(!T(t[e],n[e]))return!1;return!0}for(const e in t)if(D(t,e)&&!T(t[e],n[e]))return!1;for(const e in n)if(D(n,e)&&!(e in t))return!1;return!0}const P=window.setImmediate||((t,...n)=>setTimeout((()=>t(...n)),0)),N=["init","update","view","subscriptions"];function $(t){for(const n of N)if("function"!=typeof t[n])throw new TypeError(`"${n}" is not a function`)}function F([t,...n],e){return t(...n,e)}function U(t,n){if(t.length!==n.length||t[0]!==n[0])return!1;for(let e=1,r=t.length;e<r;e++)if(!T(t[e],n[e]))return!1;return!0}const{requestAnimationFrame:S,cancelAnimationFrame:x}=window,M=Promise.prototype.then.bind(Promise.resolve());function O(t,n,e,r,i={},s={}){const o={init:t,update:n,view:e,subscriptions:r,topicsIn:i,topicsOut:s};return $(o),o}function V(t,n,e=[],r=!1){"string"==typeof t&&(t=document.getElementById(t)),function(t,n){if(!(n instanceof HTMLElement))throw new TypeError(`"${t}" is not an HTML element`)}("root",t),$(n);const{init:i,update:s,view:o,subscriptions:c}=n,u=r?a:d,l={lift:t=>n=>t(n,k)},f=function(t){let n=null;const e=()=>{n=null,t()};return function(t){if(!0!==t)return void(null===n&&(n=[1,S(e)]));const[r,i]=n||[];0!==r&&(1===r&&x(i),n=[0,M(e)])}}(j),m=new w,p=m.createPort(),g={root:t,port:A(m,n),unmount:function(){const n=b.subscriptions;y=!1,requestAnimationFrame((()=>t.innerHTML=""));for(const{cancel:t}of n)P(t)}};let h,[v,...I]=i(...e,p),y=!0,b={};function k(t,n=!1){y&&([v,...I]=s(t,v,p),f(n),b=C(I,c(v,p),b))}function j(){if(!y)return;const n=h;h=o(v),(t=u(t,h,n,l))!==g.root&&(g.root=t)}function C(t,n,{subscriptions:e=[]}){const r=[];null===t[0]&&1===t.length&&(t=[]);for(const t of n){const n=e.findIndex((n=>U(t,n.effect)));if(n>-1){r.push(e[n]),e.splice(n,1);continue}const i=F(t,k);r.push({effect:t,cancel:i})}for(const{cancel:t}of e)P(t);for(const n of t)P(F,n,k);return{subscriptions:r}}return j(),b=C(I,c(v,p),b),g}const L=RegExp.prototype.test.bind(/^on[A-Z]/);function R({classes:t,styles:n,aria:e,data:r,...i}){const s={},o={};for(const t in i){const n=i[t];null!=n&&(L(t)?o[(c=t,c.slice(2).toLowerCase())]=n:s[t]=n)}var c;if(e&&_("aria",e,s),r&&_("data",r,s),t){let n=s.class||"";for(const e in t)t[e]&&(0!==n.length&&(n+=" "),n+=e);n&&(s.class=n)}if(n){let t=s.style||"";t&&";"!==t[t.length-1]&&(t+=";");for(const e in n){const r=n[e];r&&(t+=`${e}:${r};`)}t&&(s.style=t)}return[s,o]}function _(t,n,e){for(const r in n){const i=`${t}-${r}`;i in e||(e[i]=n[r])}return e}function q(t,n,{is:e,...r},...i){if(void 0!==e)return e(t,n,r,...i);const[s,o]=R(r);return{namespace:t,name:n,attributes:s,events:o,children:i=i.filter(Boolean)}}function W(t,n,e){let r=0,i=e.length-1;const s=n[t];for(;r<i;){const t=r+Math.ceil((i-r)/2);n[e[t]]<s?r=t:i=t-1}return r}function B(t,n,e,i={}){void 0===e&&(e=Array.from(t.childNodes).map(o));const s=function({childNodes:t},n,e,r){let i=0;const s=Math.min(n.length,e.length);for(;i<s;){const[s,o]=n[i],[c,u]=e[i];if(s!==c)break;a(t[i],o,u,r),i++}return i}(t,n,e,i),u=function({childNodes:t},n,e,r,i){let s=n.length,o=e.length;for(;s-- >r&&o-- >r;){const[r,c]=n[s],[u,l]=e[o];if(r!==u)break;a(t[o],c,l,i)}return n.length-s-1}(t,n,e,s,i),l=s+u;return l===n.length?function(t,n,e,r,i){const s=t.childNodes;for(let t=n.length-r-1;t>=e;t--)f(s[t],null,n[t][1],i);return t}(t,e,s,u,i):l===e.length?function(t,n,e,i,s){const o=r();for(let t=e,r=n.length-i;t<r;t++)o.appendChild(c(n[t][1],s));return t.insertBefore(o,t.childNodes[e]),t}(t,n,s,u,i):function(t,n,e,i=0,s=0,o){const u=t.childNodes,l=r(),d=[],m={},p={},g=n.length-s;for(let t=i;t<g;t++)p[n[t][0]]=t;for(let t=i,n=0,r=e.length-s;t<r;t++){const[r,i]=e[t],s=u[t-n],c=p[r];void 0!==c?(d.push(c),m[r]=[s,i]):(f(s,null,i,o),n++)}const h=function(t){const n=t.length,e=[null,0],r=new Array(n);for(let i=0;i<n;i++){const n=W(i,t,e),s=e[n+1];r[i]=e[n],(void 0===s||t[i]<t[s])&&(e[n+1]=i)}const i=e.length-1,s=new Array(i);for(let n=i-1,o=e[i];n>=0;n--)s[n]=t[o],o=r[o];return s}(d);for(let e=i,r=0,s=h[r];e<g;e++){const[i,u]=n[e],[d,f]=m[i]||[];e!==s?(l.appendChild(d||c(u,o)),d&&a(d,u,f,o)):(t.insertBefore(l,d),a(d,u,f,o),s=h[++r])}t.insertBefore(l,u[g])}(t,n,e,s,u,i)}function z(t,n,e,...r){const[i,s]=R(e);return r=function(t){const n={},e=[];for(const r of t){if(!r)continue;const[t,i]=r;H(t),Y(t,n),n[t]=!0,i&&e.push(r)}return e}(r),new G(t,n,i,s,r)}class G{constructor(t,n,e,r,i){this.namespace=t,this.name=n,this.attributes=e,this.events=r,this.children=i}get node(){return{...this,children:this.children.map((([t,n])=>n))}}create({namespace:t,name:n,attributes:e,events:r,children:s},o={}){const a=i(t,n);a.__vdom__={handlers:{}},u(a,e,{}),l(a,r,{},o);for(const[t,n]of s)a.appendChild(c(n,o));return a}patch(t,n,e,r={}){return u(t,n.attributes,e.attributes),l(t,n.events,e.events,r),B(t,n.children,e.children,r),t}}function H(t){if("string"!=typeof t||""===t)throw new TypeError("VDOM: Invalid key")}function Y(t,n){if(t in n)throw new RangeError(`VDOM: Key "${t}" is not unique`)}function J(t,n,...e){return z(void 0,t,n,...e)}function Q(t){return(n,...e)=>q(void 0,t,n,...e)}const Z=Q("div"),K=Q("span"),X=Q("a"),tt=Q("ul"),nt=Q("li"),et=Q("dl"),rt=Q("dt"),it=Q("dd"),st=Q("time"),ot=Q("progress"),ct=Q("nav"),at=Q("header"),ut=Q("section"),lt=Q("h1"),dt=Q("h2"),ft=Q("h3"),mt=Q("h4"),pt=Q("p"),gt=Q("strong"),ht=Q("form"),vt=Q("fieldset"),wt=Q("label"),It=Q("input"),yt=Q("textarea"),At=Q("select"),bt=Q("option"),kt=Q("button"),jt=Q("table"),Ct=Q("thead"),Dt=Q("tbody"),Et=Q("tfoot"),Tt=Q("tr"),Pt=Q("th"),Nt=Q("td");function $t(t,n=!1){return"function"==typeof t?(e,r)=>r(t(e),n):(e,r)=>r(t,n)}function Ft(t){return function(n,e){n.preventDefault(),e(t)}}function Ut(t){return function({currentTarget:n,relatedTarget:e},r){n.contains(e)||r(t(!!e))}}function St(t,n=!1){return(e,r)=>r(t(e.target.value),n)}function xt(t){return function(n,e){n.preventDefault(),e(t)}}function Mt(t,n){if("string"!=typeof n)throw new TypeError(`"${t}" is not a string.`)}function Ot(t,n){if("function"!=typeof n)throw new TypeError(`"${t}" is not a function.`)}const Vt=RegExp.prototype.test.bind(new RegExp("^[:*][a-z][a-z\\d_]*$","i"));function Lt(t,n){return t instanceof URL?t:new URL(t,n)}function Rt(t){const n={},e=t.split("&"),r=e[0];"?"===r[0]&&(e[0]=r.substring(1));for(const t of e){let[e,r]=t.split("=");void 0!==r&&(e=decodeURIComponent(e),r=decodeURIComponent(r),n[e]=r)}return n}function _t({origin:t,routes:n,registry:e},r){!function(t,n,e){if(n.origin!==e)throw new TypeError(`"${t}" is not of same origin.`)}("url",r=Lt(r,t),t);let i=!1,s=n;const o=[],c=r.pathname.split("/").filter(Boolean);for(let t=0,n=c.length;t<n&&0!==s.length;t++){const n=c[t],r=e[t]||{},i=[];for(const t in r[n]||{})s[t]&&(i[t]=!0);for(const t in r["*"]||{})s[t]&&(i[t]=!0);for(const t in r["**"]||{})s[t]&&(o[t]=!0);s=i}for(const t in s)o[t]=!0;for(const t in o){const e=n[t],s=qt(e,r,c),o=e.validator;if(s&&(!o||o(s,r))){i={target:e.target,params:s};break}}return i}function qt({machine:t},n,e){e||(e=n.pathname.split("/").filter(Boolean));let r={};const i=[];for(let n=0,s=e.length;n<s;n++){const s=e[n],o=t,c=o.arrows||{},a=c["*"];if(!(t=c[s]||a)){if([t,n,r]=i.pop()||[],t)continue;return!1}a&&a!==t&&i.push([a,n,{...r}]);const u=t.name;u&&(r[u]=t===o?r[u]+"/"+s:s)}return!!t.isFinal&&(r={...Rt(n.search),...r},r)}const Wt=window.history;let Bt=[];function zt(t){Bt=Bt.filter((n=>n!==t)),0===Bt.length&&window.removeEventListener("popstate",Ht)}function Gt(t,n){for(const e of Bt)setTimeout((()=>e(t,n)),0)}function Ht({state:t}){Gt(window.location,t)}function Yt(t=1){Wt.go(-1*t)}function Jt(t,n=null){const e=window.location;if((t=Lt(t,e)).origin!==e.origin)return e.assign(t);t.toString()!==e.toString()&&(Wt.pushState(n,"",t),Gt(t,n))}function Qt(t,n=null){const e=window.location;if((t=Lt(t,e)).origin!==e.origin)return e.assign(t);t.toString()!==e.toString()&&(Wt.replaceState(n,"",t),Gt(t,n))}const Zt=(Mt("origin",Kt=window.location.origin),Xt&&Ot("defaultTarget",Xt),{origin:Kt,routes:[],registry:{},defaultTarget:Xt});var Kt,Xt;function tn(t){return n=>[t,n]}function nn(t,n,e){const r=e&&rn.bind(void 0,e);return function(t,n,e,r){Mt("path",n),r&&Ot("validator",r);const{origin:i,routes:s,registry:o}=t,c=(n=new URL(n,i).pathname).split("/").filter(Boolean);let a={arrows:{}};const u=s.length;s[u]={path:n,machine:a,target:e,validator:r};for(let t=0,n=c.length;t<n;t++){let n,e=c[t],r=e,i=e;Vt(e)&&(i="*",n=e.substring(1),r=":"===e[0]?"*":"**");const s=o[t]=o[t]||{};(s[r]=s[r]||{})[u]=!0,a=a.arrows[i]={name:n,arrows:{}},"**"===r&&(a.arrows["*"]=a)}return a.isFinal=!0,t}(Zt,t,n,r)}function en(t){const{target:n,params:e}=_t(Zt,t)||{};return n?n(e):["NotFound",{url:t.toString()}]}function rn(t,n){for(const e in t)if(!t[e](n[e]))return!1;return!0}const sn=RegExp.prototype.test.bind(new RegExp("^[:*][a-z][a-z\\d_]*$","i"));function on(t){let n=0,e="/";const r=[],i=t.split("/").filter(Boolean);for(const t of i)sn(t)?(n++,r.push(e),e="/"):e+=t+"/";return r.push(e),function(...t){const e=t[n];t=t.splice(0,n);for(let e=0;e<n;e++)cn(t[e]);return function(t,n){let e="";const r=t.length,i=n.length,s=Math.max(r,i);for(let o=0;o<s;o++)o<r&&(e+=t[o]),o<i&&(e+=n[o]);return e}(r,t)+function(t={}){let n="";for(const e in t){const r=t[e];void 0!==r&&(n&&(n+="&"),n+=encodeURIComponent(e)+"="+encodeURIComponent(r))}return n?"?"+n:""}(e)}}function cn(t){const n=typeof t;if("string"===n||"number"===n)return;throw t?new TypeError("Invalid path parameter."):new TypeError("Missing path parameter.")}const an=RegExp.prototype.test.bind(/^[1-9]\d*$/),un=on("/"),ln=on("/login"),dn=on("/admin/clients"),fn=on("/admin/clients/new"),mn=on("/admin/clients/:id"),pn=on("/admin/clients/:id/edit"),gn=on("/admin/clients/:clientId/accounts"),hn=on("/admin/clients/:clientId/accounts/new"),vn=on("/admin/clients/:clientId/accounts/:id"),wn=on("/admin/clients/:clientId/accounts/:id/edit"),In=on("/admin/projects"),yn=on("/admin/projects/new"),An=on("/admin/projects/:id"),bn=on("/admin/projects/:id/edit"),kn=on("/admin/projects/:projectId/invoices/new"),jn=on("/admin/projects/:projectId/invoices/:id"),Cn=on("/admin/projects/:projectId/invoices/:id/edit"),Dn=on("/admin/projects/:projectId/tasks"),En=on("/admin/projects/:projectId/tasks/new"),Tn=on("/admin/projects/:projectId/tasks/:id"),Pn=on("/admin/projects/:projectId/tasks/:id/edit"),Nn=on("/admin/projects/:projectId/tasks/:taskId/invoices/new"),$n=on("/admin/projects/:projectId/tasks/:taskId/invoices/:id"),Fn=on("/admin/projects/:projectId/tasks/:taskId/invoices/:id/edit"),Un=on("/admin/users"),Sn=on("/admin/users/new"),xn=on("/admin/users/:id"),Mn=on("/admin/users/:id/edit");function On(t,n){for(const e of t){let t=!0;for(const r in n)if(e[r]!==n[r]){t=!1;break}if(t)return e}}function Vn(t,n){const e=[];for(let r=0,i=t.length;r<i;r++){const i=n(t[r],r,t);void 0!==i&&e.push(i)}return e}function Ln(t,n){const e={};for(const r of t)e[n(r)]=r;return e}function Rn(t,n){const e={};for(const r of t){const t=n(r);void 0===e[t]&&(e[t]=[]),e[t].push(r)}return e}function _n(t){return"string"==typeof t}function qn(t,n=null){return[Qt,t,n]}function Wn(t,n=null){return[Jt,t,n]}function Bn(){return[Yt,1]}function zn(t){return[Gn,t]}function Gn(t,n){history.replaceState(t,"")}function Hn(t,n){const e=(e,r)=>n(t(e,r),!0);return function(t){Ot("handler",t),0===Bt.length&&window.addEventListener("popstate",Ht),Bt.push(t)}(e),zt.bind(void 0,e)}nn(un(),function(t){return n=>function(t,n){const e=t.split("/").filter(Boolean);for(let t=0,r=e.length;t<r;t++){const r=e[t];if(!Vt(r))continue;const i=r.substring(1);e[t]=n[i]||""}return e.join("/")}(t,n)}(In())),nn(ln(),tn("Login")),nn(dn(),tn("AdminClients")),nn(fn(),tn("NewAdminClient")),nn(mn(":id"),tn("AdminClient"),{id:an}),nn(pn(":id"),tn("EditAdminClient"),{id:an}),nn(gn(":clientId"),tn("AdminClientAccounts"),{clientId:an}),nn(hn(":clientId"),tn("NewAdminClientAccount"),{clientId:an}),nn(vn(":clientId",":id"),tn("AdminClientAccount"),{clientId:an,id:an}),nn(wn(":clientId",":id"),tn("EditAdminClientAccount"),{clientId:an,id:an}),nn(In(),tn("AdminProjects")),nn(yn(),tn("NewAdminProject")),nn(An(":id"),tn("AdminProject"),{id:an}),nn(bn(":id"),tn("EditAdminProject"),{id:an}),nn(kn(":projectId"),tn("NewAdminProjectInvoice"),{projectId:an}),nn(jn(":projectId",":id"),tn("AdminProjectInvoice"),{projectId:an,id:an}),nn(Cn(":projectId",":id"),tn("EditAdminProjectInvoice"),{projectId:an,id:an}),nn(Dn(":projectId"),tn("AdminTasks"),{projectId:an}),nn(En(":projectId"),tn("NewAdminTask"),{projectId:an}),nn(Tn(":projectId",":id"),tn("AdminTask"),{projectId:an,id:an}),nn(Pn(":projectId",":id"),tn("EditAdminTask"),{projectId:an,id:an}),nn(Nn(":projectId",":taskId"),tn("NewAdminTaskInvoice"),{projectId:an,taskId:an}),nn($n(":projectId",":taskId",":id"),tn("AdminTaskInvoice"),{projectId:an,taskId:an,id:an}),nn(Fn(":projectId",":taskId",":id"),tn("EditAdminTaskInvoice"),{projectId:an,taskId:an,id:an}),nn(Un(),tn("AdminUsers")),nn(Sn(),tn("NewAdminUser")),nn(xn(":id"),tn("AdminUser"),{id:an}),nn(Mn(":id"),tn("EditAdminUser"),{id:an});const Yn={};function Jn(t){return[Zn,t]}function Qn(t){return[Kn,t]}function Zn(t,n){return v(Yn,"progress",t)}function Kn(t,n){const e=e=>n(t(e));return g(Yn,"progress",e),()=>h(Yn,"progress",e)}function Xn(t){return[ne,t]}function te(t){return[ee,t]}function ne(t,n){v(Yn,"notifications",t)}function ee(t,n){const e=e=>n(t(e));return g(Yn,"notifications",e),()=>h(Yn,"notifications",e)}const re=RegExp.prototype.test.bind(/^on[A-Z]/);function ie({port:t,handlers:n},e,r,{lift:i}={}){const s=t.topicsOut,o={...r,...e};for(const c in o){if(!(c in s))continue;let o=n[c],a=e[c];const u=r[c];a?(u||(o=n[c]=t=>o.action(t),t.subscribe(c,o)),void 0!==i&&(a=i(a,u,o.action)),o.action=a):(t.unsubscribe(c,o),delete n[c])}}function se(t){return n=>new oe(t,n)}class oe{constructor(t,n){const[e,r]=function(t){const n={},e={};for(const i in t){const s=t[i];null!=s&&(re(i)?e[(r=i,r.slice(2).toLowerCase())]=s:n[i]=s)}var r;return[n,e]}(n);this.program=t,this.attributes=function(t,n){const e={};for(const r in n){if(!(r in t))continue;const i=t[r],s=n[r];if(!0!==s&&!s(i))throw new TypeError("Invalid attribute");e[r]=i}return e}(e,t.topicsIn),this.events=r}get node(){const[t,n]=this.program,[e]=t(this.attributes,{});return n(e)}create({program:t,attributes:n,events:e},r={}){const i=V(document.createElement("div"),t,[n],!0),s=i.root;return i.handlers={},ie(i,e,{},r),s.__vdom__.app=i,s}patch(t,n,e,r={}){if(n.program!==e.program)return function(t,n,e,r={}){const i=t.parentNode,s=n.create(n,r);return i&&i.replaceChild(s,t),s}(t,n,0,r);const i=t.__vdom__.app;return function({port:t},n,e){const r=t.topicsIn,i={...e,...n};for(let s in i){if(!(s in r))continue;const i=n[s];T(i,e[s])||t.publish(s,i)}}(i,n.attributes,e.attributes),ie(i,n.events,e.events,r),t}unmount({__vdom__:{app:t}}){t.unmount()}}function ce(t,n,...e){return[ue,t,n,e]}function ae(t,n,e){return[le,t,n,e]}function ue(t,n,e,r){t.publish(n,...e)}function le(t,n,e,r){const i=(...t)=>r(e(...t));return t.subscribe(n,i),()=>t.unsubscribe(n,i)}function de(t,n){return[fe,t,n]}function fe(t,n,e){setTimeout((()=>e(n)),t)}function me(t){return(n,...e)=>q("http://www.w3.org/2000/svg",t,n,...e)}const pe=me("svg"),ge=me("symbol"),he=me("use"),ve=me("path"),we=me("circle");function Ie(t,...n){return ge({id:t,viewBox:"0 0 512 512"},...n)}Ie("bell",ve({fill:"none",stroke:"currentColor","stroke-width":"45","stroke-linecap":"round","stroke-linejoin":"round",d:"M256 32c-88 0-160 72-160 160v94c0 20-13 38-32 45-10 3-16 12-16 22v21c0 9 0 14 2 17 1 3 4 6 7 7 3 2 8 2 17 2h364c9 0 14 0 17-2 3-1 6-4 7-7 2-3 2-8 2-17v-21c0-10-6-19-16-22-19-7-32-25-32-45v-94c0-88-72-160-160-160z"}),ve({fill:"none",stroke:"currentColor","stroke-width":"45",d:"M256 480c44 0 80-29 80-64 0-6-1-11-3-16H179c-2 5-3 10-3 16 0 35 36 64 80 64z"})),Ie("search",ve({fill:"currentColor","fill-rule":"evenodd","clip-rule":"evenodd",stroke:"none",d:"M342.8 322h23.1L512 468.4 468.4 512 322 366v-23.2l-7.9-8.2a190.3 190.3 0 1120.5-20.5l8.2 8zM58.5 190.3c0 72.9 58.9 131.7 131.8 131.7S322 263.2 322 190.3c0-73-58.8-131.8-131.7-131.8A131.6 131.6 0 0058.5 190.3z"})),Ie("kebab",we({cx:"256",cy:"472",r:"40",fill:"currentColor"}),we({cx:"256",cy:"256",r:"40",fill:"currentColor"}),we({cx:"256",cy:"40",r:"40",fill:"currentColor"})),Ie("chevron-up",ve({fill:"none",stroke:"currentColor","stroke-width":"40","stroke-linejoin":"round",d:"M16 376l240-240 240 240"})),Ie("chevron-down",ve({fill:"none",stroke:"currentColor","stroke-width":"40","stroke-linejoin":"round",d:"M16 136l240 240 240-240"})),Ie("arrow-left",ve({fill:"currentColor",stroke:"currentColor","stroke-width":"40","stroke-linecap":"round","stroke-linejoin":"round",d:"M171 91L9 256m0 0l162 165M9 256h494"})),Ie("times",ve({fill:"none",stroke:"currentColor","stroke-width":"70",d:"M64 63l385 385m0-385L64 448"})),Ie("external-link",ve({fill:"currentColor","fill-rule":"evenodd",stroke:"none",d:"M57 57v398h398V256h57v199c0 31-26 57-57 57H57c-32 0-57-26-57-57V57C0 26 25 0 57 0h199v57H57zm256 0V0h199v199h-57V97L176 377l-41-41L415 57H313z"})),Ie("clock",we({fill:"none",stroke:"currentColor","stroke-width":"65",cx:"256",cy:"256",r:"223"}),ve({fill:"none",stroke:"currentColor","stroke-width":"65","stroke-linecap":"round","stroke-linejoin":"round",d:"M256 133v123l67 67"})),Ie("translation",ve({fill:"currentColor","fill-rule":"evenodd","clip-rule":"evenodd","stroke-width":"45",d:"M276 304l-59-58 1-1c40-45 69-97 86-152h68V47H209V0h-46v47H0v46h260c-16 45-40 87-74 125-21-24-39-51-54-78H86c17 38 40 73 69 106L37 363l33 33 116-117 73 73 17-48zm131-118h-46L256 465h47l26-69h110l26 69h47L407 186zm-23 62l-38 101h76l-38-101z"})),Ie("person",ve({fill:"none",stroke:"currentColor","stroke-width":"45",d:"M484 506a227 227 0 00-455 0"}),we({fill:"none",stroke:"currentColor","stroke-width":"45",cx:"256",cy:"142",r:"114"})),Ie("people",ve({fill:"none",stroke:"currentColor","stroke-width":"40",d:"M486 374a125 125 0 00-214-88c-8 8-12 18-12 18"}),we({fill:"none",stroke:"currentColor","stroke-width":"40",cx:"361",cy:"174",r:"53"}),ve({fill:"none",stroke:"currentColor","stroke-width":"40",d:"M312 414a143 143 0 10-286 0"}),we({fill:"none",stroke:"currentColor","stroke-width":"40",cx:"169",cy:"184",r:"63"}));const ye=Function.prototype.bind.bind((function(t,n={}){return n.class="icon "+(n.class||""),K(n,pe({class:"svg-icon"},he({href:"#"+t})))}),null);ye("bell");const Ae=ye("search"),be=ye("kebab");ye("chevron-up"),ye("chevron-down");const ke=ye("arrow-left");ye("times");const je=ye("external-link"),Ce=ye("clock"),De=ye("translation"),Ee=ye("person"),Te=ye("people");function Pe(t,...n){const e=t.to;return delete t.to,e&&(t.href=e,t.onClick=t=>{t.preventDefault(),t.stopPropagation(),Jt(e)}),X(t,...n)}function Ne(t,...n){return t.class="has-icon "+(t.class||""),Pe(t,je({style:"font-size: 0.85em"}),...n)}function $e(t){const n=t[0];return ct({class:"dashboard-nav app-nav",role:"navigation","aria-label":"main navigation"},tt({},nt({class:"is-hidden-mobile"},X({href:"#",title:"Search"},Ae())),nt({},function([t,n]){const e=n.active||n.id;switch(t){case"AdminProjects":case"AdminProject":case"EditAdminProject":return function(t,n){return Ue("Add a new project",Fe(),yn({active:t}),n)}(e);case"AdminTasks":case"AdminTask":case"EditAdminTask":return function(t,n,e){return Ue("Add a new task",Fe(),En(t,{active:n}),e)}(n.projectId,e);case"AdminUsers":case"AdminUser":case"EditAdminUser":return function(t,n){return Ue("Add a new user",Fe(),Sn({active:t}),n)}(e);case"AdminClients":case"AdminClient":case"EditAdminClient":return function(t,n){return Ue("Add a new client",Fe(),fn({active:t}),n)}(e);case"AdminClientAccounts":case"AdminClientAccount":case"EditAdminClientAccount":return function(t,n,e){return Ue("Add a new client account",Fe(),hn(t,{active:n}),e)}(n.clientId,e);default:return K({},Fe())}}(t)),nt({},(e="AdminProjects"===n,Ue("Projects",De({styles:{"font-size":"1.1em"}}),In(),e))),nt({},function(t){return Ue("Clients",Te({styles:{"font-size":"1.2em"}}),dn(),t)}("AdminClients"===n)),nt({},function(t){return Ue("Users",Ee({styles:{"font-size":"0.9em"}}),Un(),t)}("AdminUsers"===n))));var e}function Fe(){return K({styles:{"font-size":"1.8em","line-height":"1em"}},"+")}function Ue(t,n,e,r=!1){return r?K({title:t},n):Pe({to:e,title:t},n)}const Se=se(O((function(t,n){return[{},ce(n,"stateChange","ready")]}),(function(t,n,e){return[n,null]}),(function(t){return Z({class:"box is-centered"},Z({class:"box-content has-centered-text"},lt({class:"title has-large-text"},"The page you are looking for doesn’t exist."),Pe({to:un(),class:"button is-primary"},"Go home")))}),(function(t,n){return[]}),{},{stateChange:_n}));const xe="\n  fragment ProjectFields on Project {\n    id\n    clientAccountId\n    name\n    code\n    deadline\n    brief\n    notes\n    status\n\n    tags {\n      id\n    }\n  }\n  ",Me="\n  fragment ProjectErrorFields on ProjectErrors {\n    tagIds\n    name\n    code\n    deadline\n    brief\n    notes\n    status\n  }\n  ",Oe=`\n  query GetProjects {\n    projects {\n      ...ProjectFields\n    }\n  }\n\n  ${xe}\n  `,Ve=`\n  mutation CreateProject($clientAccountId: ID!, $input: ProjectInput!) {\n    createProject(clientAccountId: $clientAccountId, input: $input) {\n      project { ...ProjectFields }\n      errors { ...ProjectErrorFields }\n    }\n  }\n\n  ${xe}\n  ${Me}\n  `,Le=`\n  mutation UpdateProject($id: ID!, $input: ProjectInput!) {\n    updateProject(id: $id, input: $input) {\n      project { ...ProjectFields }\n      errors { ...ProjectErrorFields }\n    }\n  }\n\n  ${xe}\n  ${Me}\n  `,Re=`\n  mutation DeleteProject($id: ID!) {\n    deleteProject(id: $id) {\n      project {\n        ...ProjectFields\n      }\n    }\n  }\n\n  ${xe}\n  `,_e=window.API.send;function qe({tags:t=[],...n}){return n.tagIds=t.map((t=>t.id)),n}async function We(){return(await _e(Oe)).projects.map(qe)}const Be="\n  fragment TaskFields on Task {\n    id\n    projectId\n    userId\n    name\n    deadline\n    catTool\n    notes\n    status\n\n    tags {\n      id\n    }\n  }\n  ",ze="\n  fragment TaskErrorFields on TaskErrors {\n    userId\n    tagIds\n    name\n    deadline\n    catTool\n    notes\n    status\n  }\n  ",Ge=`\n  query GetTasks($projectId: ID) {\n    tasks(projectId: $projectId) {\n      ...TaskFields\n    }\n  }\n\n  ${Be}\n  `,He=`\n  mutation CreateTask($projectId: ID!, $input: TaskInput!) {\n    createTask(projectId: $projectId, input: $input) {\n      task { ...TaskFields }\n      errors { ...TaskErrorFields }\n    }\n  }\n\n  ${Be}\n  ${ze}\n  `,Ye=`\n  mutation UpdateTask($id: ID!, $input: TaskInput!) {\n    updateTask(id: $id, input: $input) {\n      task { ...TaskFields }\n      errors { ...TaskErrorFields }\n    }\n  }\n\n  ${Be}\n  ${ze}\n  `,Je=`\n  mutation DeleteTask($id: ID!) {\n    deleteTask(id: $id) {\n      task {\n        ...TaskFields\n      }\n    }\n  }\n\n  ${Be}\n  `,Qe=window.API.send;function Ze({tags:t=[],...n}){return n.tagIds=t.map((t=>t.id)),n}async function Ke(t){return(await Qe(Ge,{projectId:t})).tasks.map(Ze)}function Xe(t,n){if("function"!=typeof n)throw new TypeError(`"${t}" must be a function`)}function tr(t){if(!t)throw new TypeError("Missing or invalid id")}function nr(t,n,e,r){return Xe("filter",e),void 0!==r&&function(t,n){if(!Number.isInteger(n)||n<1)throw new TypeError(`"${t}" must be a positive integer`)}("limit",r),function(t,n,e,r){return Xe("reducer",e),new Promise(((i,s)=>{let o=!1;const c=()=>o=!0,a=t.transaction(n,"readonly"),u=a.objectStore(n);function l({target:{result:t}}){t&&(r=e(r,t.value,c),o||t.continue())}a.oncomplete=t=>i(r),a.onerror=t=>s(t.target.error);u.openCursor().onsuccess=l}))}(t,n,(function(t,n,i){return e(n)&&(t.push(n),t.length===r&&i()),t}),[])}function er(t,n){return function(t,n,e){return rr(t,"rw",n,e)}(t,n,(t=>t.clear()))}async function rr(t,n,e,r){return Array.isArray(e)||(e=[e]),"r"===n&&(n="readonly"),"rw"===n&&(n="readwrite"),new Promise(((i,s)=>{const o=t.transaction(e,n),c=e.map((t=>o.objectStore(t))),a=r(...c)||[];Array.isArray(a)?(o.oncomplete=()=>i(a.map((t=>t.result))),o.onerror=()=>s(a.map((t=>t.error)))):(o.oncomplete=()=>i(a.result),o.onerror=()=>s(a.error))}))}function ir(t,n,e){return rr(t,"r",n,e)}async function sr(t,n,e){const r=await function(t,n,e=(()=>{})){return new Promise(((r,i)=>{indexedDB||i(new Error("IndexedDB not supported"));const s=indexedDB.open(t,n);s.onupgradeneeded=t=>e(t.target.result,t.newVersion,t.oldVersion),s.onsuccess=t=>r(t.target.result),s.onblocked=t=>i(new Error("Database is blocked")),s.onerror=t=>i(t.target.error)}))}(t,n,e),i={db:r,subs:{}};return r.addEventListener("versionchange",(async function(){or(i),v(i.subs,"@migration")})),i}async function or(t){const{db:n,subs:e}=t;n&&await function(t){return t.close()}(n),t.db=void 0,t.subs={},v(e,"@close")}async function cr(t){const{db:n}=t;await or(t),n&&await function(t){return new Promise(((n,e)=>{const r=indexedDB.deleteDatabase(t.name);r.onsuccess=t=>n(t.target.result),r.onblocked=t=>e(new Error("Database is blocked")),r.onerror=t=>e(t.target.error)}))}(n)}function ar({db:t},n){return function(t,n){return ir(t,n,(t=>t.getAll()))}(t,n)}function ur({db:t},n,e){return function(t,n,e){return ir(t,n,(t=>t.get(e)))}(t,n,e)}async function lr({db:t,subs:n},e,...r){r.forEach((t=>tr(t&&t.id)));const i=await function(t,n,...e){return new Promise(((r,i)=>{const s=1===e.length?e[0]:e,o=t.transaction(n,"readwrite"),c=o.objectStore(n);o.oncomplete=t=>r(s),o.onerror=t=>i(t.target.error);for(const t of e)c.add(t)}))}(t,e,...r);return v(n,e,1===r.length?[i]:i),i}async function dr({db:t,subs:n},e,...r){r.forEach((t=>tr(t&&t.id)));const i=await function(t,n,...e){return new Promise(((r,i)=>{const s=1===e.length?e[0]:e,o=t.transaction(n,"readwrite"),c=o.objectStore(n);o.oncomplete=t=>r(s),o.onerror=t=>i(t.target.error);for(const t of e)c.put(t)}))}(t,e,...r);return v(n,e,1===r.length?[i]:i),i}async function fr({db:t,subs:n},e,r,i){tr(r);const s=await function(t,n,e,r){return new Promise(((i,s)=>{let o;const c=t.transaction(n,"readwrite"),a=c.objectStore(n);c.oncomplete=t=>i(o),c.onerror=t=>s(t.target.error),a.get(e).onsuccess=function({target:{result:t}}){const n={...t,...r,id:e};a.put(n).onsuccess=()=>o=n}}))}(t,e,r,i);return v(n,e,[s]),s}async function mr({db:t,subs:n},e,...r){r.forEach(tr);const i=await function(t,n,...e){return new Promise(((r,i)=>{const s=[],o=t.transaction(n,"readwrite"),c=o.objectStore(n),a=e.length;function u(t,n,e){c.delete(n).onsuccess=()=>s[t]=e}o.oncomplete=t=>r(1===a?s[0]:s),o.onerror=t=>i(t.target.error);for(let t=0;t<a;t++){const n=e[t];c.get(n).onsuccess=e=>u(t,n,e.target.result)}}))}(t,e,...r);return v(n,e,r.map((t=>({id:t,tombstone:!0})))),i}function pr({subs:t},n,e){g(t,n,e)}function gr(t,n,e){!function(t){hr(t,"meta")}(t),function(t){const n=hr(t,"clients");n.createIndex("name","name",{unique:!0}),vr(n)}(t),function(t){const n=hr(t,"clientAccounts");n.createIndex("clientId","clientId"),n.createIndex("name","name"),vr(n)}(t),function(t){const n=hr(t,"invoices");n.createIndex("projectId","projectId"),n.createIndex("taskId","taskId"),vr(n)}(t),function(t){const n=hr(t,"projects");n.createIndex("clientAccountId","clientAccountId"),n.createIndex("name","name",{unique:!0}),n.createIndex("code","code",{unique:!0}),n.createIndex("deadline","deadline"),n.createIndex("status","status"),vr(n)}(t),function(t){hr(t,"tags").createIndex("name","name",{unique:!0})}(t),function(t){const n=hr(t,"tasks");n.createIndex("projectId","projectId"),n.createIndex("userId","userId"),n.createIndex("name","name"),n.createIndex("deadline","deadline"),n.createIndex("status","status"),vr(n)}(t),function(t){const n=hr(t,"users");n.createIndex("isDisabled","isDisabled"),n.createIndex("isActive","isActive"),vr(n)}(t)}function hr(t,n,e="id"){return t.objectStoreNames.contains(n)&&t.deleteObjectStore(n),t.createObjectStore(n,{keyPath:e})}function vr(t){t.createIndex("insertedAt","insertedAt"),t.createIndex("updatedAt","updatedAt")}const wr="\n  fragment UserFields on User {\n    id\n    email\n    role\n    isDisabled\n\n    profile {\n      firstName\n      lastName\n      color\n    }\n  }\n  ",Ir=`\n  mutation SignIn($login: String!, $password: String!) {\n    signIn(login: $login, password: $password) {\n      token\n      user {\n        ...UserFields\n      }\n    }\n  }\n\n  ${wr}\n  `,yr=`\n  mutation CreateSession($token: String!) {\n    createSession(token: $token) {\n      token\n      user {\n        ...UserFields\n      }\n    }\n  }\n\n  ${wr}\n  `,{fetch:Ar,disconnect:br,send:kr}=window.API;function jr(t){const n=localStorage.getItem(Dr(t));return null===n?null:(e=n,JSON.parse(Pr(e)));var e}function Cr(t,n){const e=Dr(t),r=localStorage.getItem(e),i=(s=n,Pr(JSON.stringify(s)));var s;i!==r&&(localStorage.setItem(e,i),v(Er,t,t,n))}function Dr(t){return"#vault#"+t}const Er={},Tr=btoa(location.origin+navigator.userAgent+"VYNseA8BAfW9UIM");function Pr(t){let n="";const e=Tr.length;for(let r=0,i=t.length;r<i;++r)n+=String.fromCharCode(Tr.charCodeAt(r%e)^t.charCodeAt(r));return n}let Nr,$r;async function Fr(){return void 0===Nr&&await async function(){void 0===$r&&($r=async function(){const t={},n=jr("token");if(n){const{user:e,token:r}=await async function(t){return(await Ar(yr,{token:t})).createSession}(n);Cr("token",r),t.user=e}Nr=t}().finally((()=>$r=void 0)));return await $r,Nr}(),Nr}async function Ur(t,n){if(!t||!n)throw new Error("Missing login or password");const{user:e,token:r}=await async function(t,n){return(await Ar(Ir,{login:t,password:n})).signIn}(t,n);return Cr("token",r),Nr={user:e},Nr}async function Sr(){return window.onbeforeunload=t=>t.preventDefault(),await async function(){if(void 0===wi)return;wi=await cr(wi)}(),window.onbeforeunload=void 0,function(t){const n=Dr(t);null!==localStorage.getItem(n)&&(localStorage.removeItem(n),v(Er,t,t,null))}("token"),Nr=void 0,br()}const xr="\n  fragment ClientFields on Client {\n    id\n    name\n    notes\n  }\n  ",Mr="\n  fragment ClientErrorFields on ClientErrors {\n    name\n    notes\n  }\n  ",Or=`\n  query GetClients {\n    clients {\n      ...ClientFields\n    }\n  }\n\n  ${xr}\n  `,Vr=`\n  mutation CreateClient($input: ClientInput!) {\n    createClient(input: $input) {\n      client { ...ClientFields }\n      errors { ...ClientErrorFields }\n    }\n  }\n\n  ${xr}\n  ${Mr}\n  `,Lr=`\n  mutation UpdateClient($id: ID!, $input: ClientInput!) {\n    updateClient(id: $id, input: $input) {\n      client { ...ClientFields }\n      errors { ...ClientErrorFields }\n    }\n  }\n\n  ${xr}\n  ${Mr}\n  `,Rr=`\n  mutation DeleteClient($id: ID!) {\n    deleteClient(id: $id) {\n      client {\n        ...ClientFields\n      }\n    }\n  }\n\n  ${xr}\n  `,_r=window.API.send;async function qr(){return(await _r(Or)).clients}const Wr="\n  fragment ClientAccountFields on ClientAccount {\n    id\n    clientId\n    name\n    notes\n  }\n  ",Br="\n  fragment ClientAccountErrorFields on ClientAccountErrors {\n    name\n    notes\n  }\n  ",zr=`\n  query GetClientAccounts($clientId: ID) {\n    clientAccounts(clientId: $clientId) {\n      ...ClientAccountFields\n    }\n  }\n\n  ${Wr}\n  `,Gr=`\n  mutation CreateClientAccount($clientId: ID, $input: ClientAccountInput!) {\n    createClientAccount(clientId: $clientId, input: $input) {\n      clientAccount { ...ClientAccountFields }\n      errors { ...ClientAccountErrorFields }\n    }\n  }\n\n  ${Wr}\n  ${Br}\n  `,Hr=`\n  mutation UpdateClientAccount($id: ID!, $input: ClientAccountInput!) {\n    updateClientAccount(id: $id, input: $input) {\n      clientAccount { ...ClientAccountFields }\n      errors { ...ClientAccountErrorFields }\n    }\n  }\n\n  ${Wr}\n  ${Br}\n  `,Yr=`\n  mutation DeleteClientAccount($id: ID!) {\n    deleteClientAccount(id: $id) {\n      clientAccount {\n        ...ClientAccountFields\n      }\n    }\n  }\n\n  ${Wr}\n  `,Jr=window.API.send;async function Qr(){return(await Jr(zr)).clientAccounts}const Zr="\n  fragment InvoiceFields on Invoice {\n    id\n    projectId\n    taskId\n    dueDate\n    sentAt\n    receivedAt\n    paidAt\n    total\n    notes\n\n    items {\n      id\n      description\n      quantity\n      price\n    }\n  }\n  ",Kr="\n  fragment InvoiceErrorFields on InvoiceErrors {\n    dueDate\n    sentAt\n    receivedAt\n    paidAt\n    notes\n\n    items {\n      description\n      quantity\n      price\n    }\n  }\n  ",Xr=`\n  query GetInvoices {\n    invoices {\n      ...InvoiceFields\n    }\n  }\n\n  ${Zr}\n  `,ti=`\n  mutation CreateIncomingInvoice($projectId: ID!, $input: InvoiceInput!) {\n    createIncomingInvoice(projectId: $projectId, input: $input) {\n      invoice { ...InvoiceFields }\n      errors { ...InvoiceErrorFields }\n    }\n  }\n\n  ${Zr}\n  ${Kr}\n  `,ni=`\n  mutation CreateOutgoingInvoice($taskId: ID!, $input: InvoiceInput!) {\n    createOutgoingInvoice(taskId: $taskId, input: $input) {\n      invoice { ...InvoiceFields }\n      errors { ...InvoiceErrorFields }\n    }\n  }\n\n  ${Zr}\n  ${Kr}\n  `,ei=`\n  mutation UpdateInvoice($id: ID!, $input: InvoiceInput!) {\n    updateInvoice(id: $id, input: $input) {\n      invoice { ...InvoiceFields }\n      errors { ...InvoiceErrorFields }\n    }\n  }\n\n  ${Zr}\n  ${Kr}\n  `,ri=`\n  mutation DeleteInvoice($id: ID!) {\n    deleteInvoice(id: $id) {\n      invoice {\n        ...InvoiceFields\n      }\n    }\n  }\n\n  ${Zr}\n  `,ii=window.API.send;async function si(){return(await ii(Xr)).invoices}const oi=window.API.send;async function ci(){return(await oi("\n  query GetTags {\n    tags {\n      id\n      name\n      style\n    }\n  }\n  ")).tags}const ai="\n  fragment UserFields on User {\n    id\n    username\n    email\n    role\n    isDisabled\n\n    profile {\n      firstName\n      lastName\n      color\n      isActive\n      status\n      notes\n\n      details {\n        name\n        value\n      }\n    }\n  }\n  ",ui="\n  fragment UserErrorFields on UserErrors {\n    username\n    email\n    role\n    isDisabled\n\n    profile {\n      firstName\n      lastName\n      color\n      isActive\n      status\n      notes\n\n      details {\n        name\n        value\n      }\n    }\n  }\n  ",li=`\n  query GetUsers {\n    users {\n      ...UserFields\n    }\n  }\n\n  ${ai}\n  `,di=`\n  mutation CreateUser($input: UserInput!) {\n    createUser(input: $input) {\n      user { ...UserFields }\n      errors { ...UserErrorFields }\n    }\n  }\n\n  ${ai}\n  ${ui}\n  `,fi=`\n  mutation UpdateUser($id: ID!, $input: UserInput!) {\n    updateUser(id: $id, input: $input) {\n      user { ...UserFields }\n      errors { ...UserErrorFields }\n    }\n  }\n\n  ${ai}\n  ${ui}\n  `,mi=`\n  mutation DeleteUser($id: ID!) {\n    deleteUser(id: $id) {\n      user {\n        ...UserFields\n      }\n    }\n  }\n\n  ${ai}\n  `,pi=window.API.send;async function gi(){return(await pi(li)).users}async function hi(t){const n=await async function(){if(!(await Fr()).user)throw new Error("UNAUTHORIZED");const[t,n,e,r,i,s,o]=await Promise.all([qr(),Qr(),si(),We(),ci(),Ke(),gi()]);return{clients:t,clientAccounts:n,invoices:e,projects:r,tags:i,tasks:s,users:o}}();await Promise.all(Object.entries(n).map((async function([n,e]){await er(t.db,n),await lr(t,n,...e)})));const e=Date.now();return await dr(t,"meta",{id:"synchedAt",value:e}),e}const vi=12e4;let wi,Ii,yi,Ai;async function bi(){void 0===wi&&(void 0===yi&&(yi=async function(){const t=await sr("elliot",2,gr),n=await async function(t){const n=await ur(t,"meta","synchedAt");return n&&n.value}(t);pr(t,"@close",(()=>wi=void 0)),pr(t,"@migration",(()=>window.location.reload())),n||(Ii=await hi(t));wi=t}().finally((()=>yi=void 0))),await yi)}async function ki(){void 0===Ai&&(Ai=async function(){await bi(),(!Ii||Date.now()-Ii>vi)&&(Ii=await hi(wi))}().finally((()=>Ai=void 0))),await Ai}async function ji(t,n,e){return await bi(),void 0===n?ar(wi,t):function({db:t},n,e,r){return nr(t,n,e,r)}(wi,t,n,e)}async function Ci(t,n){return await bi(),ur(wi,t,n)}async function Di(t,...n){return await bi(),lr(wi,t,...n)}async function Ei(t,n,e){return await bi(),fr(wi,t,n,e)}async function Ti(t,...n){return await bi(),mr(wi,t,...n)}async function Pi(t,n){await bi(),pr(wi,t,n)}async function Ni(t,n){void 0!==wi&&function({subs:t},n,e){h(t,n,e)}(wi,t,n)}function $i(t,n){if(!Array.isArray(n))throw new TypeError(`"${t}" must be an array.`)}function Fi(t,n){if(!(e=n)||"[object Object]"!==Mi(e))throw new TypeError(`"${t}" must be an object.`);var e}function Ui(t,n){if("number"!=typeof n||Number.isNaN(n))throw new TypeError(`"${t}" must be a number.`)}function Si(t,n){if("function"!=typeof n)throw new TypeError(`"${t}" must be a function.`)}function xi(t,n){if(!t.types[n]&&!t.relations[n])throw new RangeError(`Field "${n}" doesn't exist in changeset.`)}const Mi=(Oi=Object.prototype.toString).call.bind(Oi);var Oi;const Vi=(t=>t.call.bind(t))(Object.prototype.hasOwnProperty),Li=RegExp.prototype.test.bind(/^\s*$/);function Ri(t){return null==t||""===t||"string"==typeof t&&Li(t)}function _i(t,n){if("any"===t||"string"===t&&"string"==typeof n)return[!0,n];if(Ri(n))return[!0,null];if("function"==typeof t)return t(n);switch(t){case"id":return function(t){return"number"==typeof t&&Number.isInteger(t)?[!0,String(t)]:"string"!=typeof t||/\s/.test(t)?[!1,t]:[!0,t]}(n);case"string":return function(t){return["string","number","boolean"].includes(typeof t)?[!0,String(t)]:[!1,t]}(n);case"number":return function(t){const n="string"==typeof t?Number(t):t;return"number"!=typeof n||Number.isNaN(n)?[!1,t]:[!0,n]}(n);case"boolean":return function(t){return!0===t||"true"===t?[!0,!0]:!1===t||"false"===t?[!0,!1]:[!1,t]}(n);case"datetime":return function(t){const n=t instanceof Date||"number"==typeof t||"string"==typeof t&&t!==String(Number(t))?new Date(t):NaN;return isNaN(n)?[!1,t]:[!0,n]}(n);default:throw new RangeError(`Unknown type: "${t}".`)}}function qi(t){return function(n){if(!Array.isArray(n))return[!1,n];const e=[];for(const r of n){const[i,s]=_i(t,r);if(!i)return[!1,n];e.push(s)}return[!0,e]}}function Wi(t){return Si("validator",t),function(n,e,r){return!(e in r.changes)||Ri(n)?[]:t(n,e,r)}}function Bi(t){return Si("fn",t),function(n,e,r){return t(r,e)&&Ri(n)?[{code:"blank"}]:[]}}function zi(t){"number"==typeof t&&(t={min:t,max:t});const{min:n,max:e}=t,r=void 0!==n,i=void 0!==e;if(r&&Ui("min",n),i&&Ui("max",e),r&&i&&n>e)throw new RangeError('"min" can’t be greater than "max".');return Wi(((t,s,o)=>{const c=t.length;return r&&c<n?[{code:"tooShort",min:n}]:i&&c>e?[{code:"tooLong",max:e}]:[]}))}function Gi(t){return $i("list",t),Wi(((n,e,r)=>t.includes(n)?[]:[{code:"outside",list:t}]))}function Hi(t){return function(t,n){if("[object RegExp]"!==Mi(n))throw new TypeError(`"${t}" must be a RegExp.`)}("pattern",t),Wi(((n,e,r)=>t.test(n)?[]:[{code:"invalid"}]))}function Yi(t){const n=function(t){const n={};for(const e in Ji){const r=t[e];void 0!==r&&(Ui(e,r),n[e]=r)}return n}(t);return Wi(((t,e,r)=>{for(const e in n){const r=n[e];if((0,Ji[e])(t,r))return[{code:"number",type:e,number:r}]}return[]}))}const Ji={is:(t,n)=>t!==n,not:(t,n)=>t===n,greaterThan:(t,n)=>t<=n,greaterOrEqual:(t,n)=>t<n,lessOrEqual:(t,n)=>t>n,lessThan:(t,n)=>t>=n};class Qi{constructor(t,n={}){Fi("types",t),Fi("data",n);const e={},r={};for(const n in t)e[n]=[],r[n]=[];this._prepare=()=>this,this.isValid=!0,this.types=t,this.relations={},this.required=[],this.data=n,this.changes={},this.params={},this.errors=e,this.validations=r}tap(t){return t(this)||this}prepareWith(t){return Si("fn",t),this._prepare=t,this}prepare(){return this.isValid&&this._prepare(this)||this}applyChanges(){if(!this.isValid)return this.data;const{data:t,changes:n}=this.prepare(),e={...t};for(const t in n)e[t]=Zi(n[t]);return e}cast(t,n){Fi("params",t),$i("permitted",n);for(const e in t){if(!Vi(t,e))continue;const r=this.params[e]=t[e];if(!n.includes(e))continue;const i=this.types[e],[s,o]=_i(i,r);s?this.put(e,o):(this.deleteChange(e),this.addError(e,{code:"invalid",type:i}))}return this}castOne(t,n,{required:e=!0}={}){Si("fn",n),this.relations[t]=["one",n];const r=this.params[t];if(void 0===r)return e&&this.addError(t,{code:"blank"}),this;const i=this.data[t]||{};return(this.changes[t]=n(i,r)).isValid||(this.isValid=!1),this}castMany(t,n,{required:e=!0,primaryKey:r="id"}={}){Si("fn",n),this.relations[t]=["many",n];const i=this.data[t]||[],s=this.params[t];if(void 0===s)return e&&this.addError(t,{code:"blank"}),this;if(!Array.isArray(i))throw TypeError(`"${t}" data must be a list`);if(!Array.isArray(s))throw TypeError(`"${t}" params must be a list`);return this.changes[t]=s.map((t=>{const e=t[r],s=i.find((t=>t[r]===e))||{},o=n(s,t);return o.isValid||(this.isValid=!1),o})),this}get(t,n){xi(this,t);const e=t in this.changes?this.changes[t]:this.data[t];return void 0!==e?e:n}getChange(t,n){return xi(this,t),t in this.changes?this.changes[t]:n}put(t,n){return xi(this,t),!function(t,n){if(!Array.isArray(t))return t===n;if(!Array.isArray(n)||t.length!==n.length)return!1;for(let e=0,r=t.length;e<r;e++)if(t[e]!==n[e])return!1;return!0}(n,this.data[t])?this.changes[t]=n:delete this.changes[t],this}deleteChange(t){return xi(this,t),delete this.changes[t],this}addError(t,...n){return xi(this,t),0!==n.length&&(this.errors[t].push(...n),this.isValid=!1),this}require(t){$i("keys",t);const n=this.required,e=this.errors,r=function(t,n,e){return Ri(t)?[{code:"blank"}]:[]};for(const i of t){if(xi(this,i),-1===n.indexOf(i)&&n.push(i),e[i].some((t=>"invalid"===t.code)))continue;const t=r(this.get(i),i,this);this.addError(i,...t)}return this}validate(t,n){xi(this,t),Si("fn",n);const e=n(this.get(t),t,this);return this.validations[t].push(n),this.addError(t,...e),this}}function Zi(t){return Array.isArray(t)?t.map(Zi):t instanceof Qi?t.applyChanges():t}const Ki=864e5,Xi=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],ts=["January","February","March","April","May","June","July","August","September","October","November","December"],ns=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function es(t,n="full"){switch("string"==typeof t&&(t=new Date(t)),n){case"short":return t.getDate().toString().padStart(2,"0")+"/"+(t.getMonth()+1).toString().padStart(2,"0")+"/"+t.getFullYear();case"compact":return ns[t.getMonth()]+" "+t.getDate()+", "+t.getFullYear();default:return Xi[t.getDay()]+", "+ts[t.getMonth()]+" "+t.getDate()+", "+t.getFullYear()}}function rs(t){return"string"==typeof t&&(t=new Date(t)),t.getHours().toString().padStart(2,"0")+":"+t.getMinutes().toString().padStart(2,"0")+"hs"}function is(t,n="full"){return"string"==typeof t&&(t=new Date(t)),es(t,n)+" "+rs(t)}function ss(t,n="00:00"){if(!us(t))throw new TypeError("Invalid date string");if(!ls(n))throw new TypeError("Invalid time string");const e=t.split("-").concat(n.split(":"));return e[1]-=1,new Date(...e)}function os(t){return t?("string"==typeof t&&(t=new Date(t)),t.getFullYear()+"-"+(t.getMonth()+1).toString().padStart(2,"0")+"-"+t.getDate().toString().padStart(2,"0")):""}function cs(t){return t?("string"==typeof t&&(t=new Date(t)),t.getHours().toString().padStart(2,"0")+":"+t.getMinutes().toString().padStart(2,"0")):""}function as(t){if("string"==typeof t&&(t=new Date(t)),t instanceof Date&&(t=t.getTime()),"number"!=typeof t)throw new TypeError("Invalid timestamp");const n=Date.now();return Math.floor((t-n)/Ki)}function us(t){try{return t===new Date(t).toISOString().split("T")[0]}catch(t){return!1}}function ls(t){if("string"!=typeof t||!/^\d{2}:\d{2}$/.test(t))return!1;const[n,e]=t.split(":");return!(parseInt(n)>23||parseInt(e)>59)}function ds(t,n){return"number"!=typeof t&&"string"!=typeof t||(t=new Date(t)),"number"!=typeof n&&"string"!=typeof n||(n=new Date(n)),t.getFullYear()===n.getFullYear()&&t.getMonth()===n.getMonth()&&t.getDate()===n.getDate()}function fs(t){return ds(t,Date.now()-Ki)}function ms(t){return ds(t,Date.now())}function ps(t){return ds(t,Date.now()+Ki)}function gs(){return Wi(((t,n,e)=>us(t)?[]:[{code:"invalid"}]))}const hs=["clientAccountId","name"],vs=["tagIds","code","date","time","brief","notes","status"],ws=["PENDING","IN_PROGRESS","COMPLETED"],Is={id:"id",clientId:"id",clientAccountId:"id",tagIds:qi("id"),name:"string",code:"string",date:"string",time:"string",deadline:"string",brief:"string",notes:"string",status:"string"};function ys({...t}={},n={}){if(t.tagIds||(t.tagIds=(t.tags||[]).map((t=>t.id))),t.clientAccount){const{id:n,clientId:e}=t.clientAccount;t.clientId=e,t.clientAccountId=n}return new Qi(Is,t).cast(n,[...hs,...vs]).require(hs).validate("name",zi({max:255})).validate("code",zi({max:255})).validate("date",gs()).validate("time",Wi(((t,n,e)=>ls(t)?[]:[{code:"invalid"}]))).validate("brief",zi({max:1024})).validate("notes",zi({max:4096})).validate("status",Gi(ws)).prepareWith(As)}function As(t){const n=t.changes;if("date"in n||"time"in n){const n=t.get("date"),e=t.get("time")||"00:00",r=n?ss(n,e).toISOString():null;t.put("deadline",r)}return t}const bs=["projectId","name"],ks=["userId","tagIds","date","time","catTool","notes","status"],js=["PENDING","IN_PROGRESS","COMPLETED"],Cs={id:"id",projectId:"id",userId:"id",tagIds:qi("id"),name:"string",date:"string",time:"string",deadline:"string",catTool:"string",notes:"string",status:"string"};function Ds(t){const n=t.changes;if("date"in n||"time"in n){const n=t.get("date"),e=t.get("time")||"00:00",r=n?ss(n,e).toISOString():null;t.put("deadline",r)}return t}function Es(t,n){if(!(t instanceof Qi))throw new TypeError("Invalid changeset");return Ts(t,n)}function Ts(t,n){if(!t||!n)return t;const{types:e,relations:r}=t;for(const r in e)t.addError(r,...n[r]||[]);for(const e in r){const[i]=r[e],s=n[e],o=t.getChange(e);if("one"===i)Ts(o,s);else if("many"===i)for(let t=0,n=o.length;t<n;t++)Ts(o[t],s[t])}return t}function Ps(t,n){if(null===n)return[];const e=[],r={};for(const n of t)r[n.id]=e.length,e.push(n);for(const t of n){const n=r[t.id],i=void 0!==n;t.tombstone?i&&e.splice(n,1):i?e.splice(n,1,t):e.push(t)}return e}async function Ns(t){return ji("tags",t)}function $s(t){const{...n}=t.prepare().changes;return delete n.clientAccountId,delete n.clientId,delete n.date,delete n.time,n}function Fs(t={},n={}){return ys(t,n)}async function Us(t={}){const n=Fs({},t);if(!n.isValid)throw n;const e=n.get("clientAccountId"),r=$s(n),{project:i,errors:s}=await async function(t,n){const e=(await _e(Ve,{clientAccountId:t,input:n})).createProject;return e.project&&(e.project=qe(e.project)),e}(e,r);if(s)throw Es(n,s);return Di("projects",i)}async function Ss(t,n={}){const e=Fs(t,n);if(!e.isValid)throw e;const r=e.get("id"),i=$s(e),{project:s,errors:o}=await async function(t,n){const e=(await _e(Le,{id:t,input:n})).updateProject;return e.project&&(e.project=qe(e.project)),e}(r,i);if(o)throw Es(e,o);return Ei("projects",r,s)}async function xs(t){return await async function(t){return qe((await _e(Re,{id:t})).deleteProject.project)}(t),Ti("projects",t)}function Ms(t){const{...n}=t.prepare().changes;return delete n.projectId,delete n.date,delete n.time,n}function Os(t){return ji("tasks",t)}function Vs(t={},n={}){return function({...t}={},n={}){return t.tagIds||(t.tagIds=(t.tags||[]).map((t=>t.id))),new Qi(Cs,t).cast(n,[...bs,...ks]).require(bs).validate("name",zi({max:255})).validate("date",Hi(/^\d{4}-\d{2}-\d{2}$/)).validate("time",Hi(/^\d\d:\d\d$/)).validate("catTool",zi({max:255})).validate("notes",zi({max:4096})).validate("status",Gi(js)).prepareWith(Ds)}(t,n)}async function Ls(t={}){const n=Vs({},t);if(!n.isValid)throw n;const e=n.get("projectId"),r=Ms(n),{task:i,errors:s}=await async function(t,n){const e=(await Qe(He,{projectId:t,input:n})).createTask;return e.task&&(e.task=Ze(e.task)),e}(e,r);if(s)throw Es(n,s);return Di("tasks",i)}async function Rs(t,n={}){const e=Vs(t,n);if(!e.isValid)throw e;const r=e.get("id"),i=Ms(e),{task:s,errors:o}=await async function(t,n){const e=(await Qe(Ye,{id:t,input:n})).updateTask;return e.task&&(e.task=Ze(e.task)),e}(r,i);if(o)throw Es(e,o);return Ei("tasks",r,s)}async function _s(t){return await async function(t){return Ze((await Qe(Je,{id:t})).deleteTask.task)}(t),Ti("tasks",t)}const qs=["projectId","taskId","dueDate","sentAt","receivedAt","paidAt","notes"],Ws=["description","quantity","price"],Bs={id:"id",projectId:"id",taskId:"id",dueDate:"string",sentAt:"string",receivedAt:"string",paidAt:"string",notes:"string",items:qi("any")},zs={description:"string",quantity:"number",price:"number"};function Gs(t={},n){return new Qi(Bs,t).cast(function({...t}){const n=["dueDate","sentAt","receivedAt","paidAt"];for(const e of n)""===t[e]&&(t[e]=null);return t}(n),qs).castMany("items",((t,e)=>function(t={},n={},e){return new Qi(zs,t).cast(n,Ws).require(Ws).validate("description",zi({max:4096})).validate("description",(r=e||[],Wi(((t,n,e)=>r.filter((e=>e[n]===t)).length>1?[{code:"taken"}]:[])))).validate("quantity",Yi({greaterThan:0})).validate("price",Yi({greaterThan:0}));var r}(t,e,n.items)),{required:!0}).validate("projectId",Bi((t=>!t.get("taskId")))).validate("taskId",Bi((t=>!t.get("projectId")))).validate("dueDate",gs()).validate("sentAt",gs()).validate("receivedAt",gs()).validate("paidAt",gs()).validate("notes",zi({max:4096})).validate("items",zi({min:1})).prepareWith(Hs)}function Hs(t){const n=t.getChange("dueDate"),e=t.getChange("sentAt"),r=t.getChange("receivedAt"),i=t.getChange("paidAt");return n&&t.put("dueDate",ss(n).toISOString()),e&&t.put("sentAt",ss(e).toISOString()),r&&t.put("receivedAt",ss(r).toISOString()),i&&t.put("paidAt",ss(i).toISOString()),t}function Ys(t){const{items:n,...e}=t.prepare().changes;return delete e.projectId,delete e.taskId,n.length>0&&(e.items=n.map((t=>t.applyChanges()))),e}function Js(t){return ji("invoices",t)}function Qs(t={},n={}){return Gs(t,n)}async function Zs(t={}){const n=t.projectId,e=Qs({},t);if(!n||!e.isValid)throw e;const r=Ys(e),{invoice:i,errors:s}=await async function(t,n){return(await ii(ti,{projectId:t,input:n})).createIncomingInvoice}(n,r);if(s)throw Es(e,s);return Di("invoices",i)}async function Ks(t={}){const n=t.taskId,e=Qs({},t);if(!n||!e.isValid)throw e;const r=Ys(e),{invoice:i,errors:s}=await async function(t,n){return(await ii(ni,{taskId:t,input:n})).createOutgoingInvoice}(n,r);if(s)throw Es(e,s);return Di("invoices",i)}async function Xs(t,n={}){const e=Qs(t,n);if(!e.isValid)throw e;const r=e.get("id"),i=Ys(e),{invoice:s,errors:o}=await async function(t,n){return(await ii(ei,{id:t,input:n})).updateInvoice}(r,i);if(o)throw Es(e,o);return Ei("invoices",r,s)}async function to(t){return await async function(t){return(await ii(ri,{id:t})).deleteInvoice.invoice}(t),Ti("invoices",t)}function no(t){return Pi("invoices",t),()=>Ni("invoices",t)}const eo=window.requestAnimationFrame,ro=document.getElementById("app");function io(t){return[co,t]}function so(t){return[ao,t]}function oo(t,n={}){return[uo,t,n]}function co(t){t&&eo((function(){const n=ro.querySelector(t);n&&(n.scrollTop=0)}))}function ao(t){document.getElementById(t).scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})}function uo(t,{capture:n,exceptions:e},r){const i=n&&e?({target:n})=>n.closest(e)||r(t):()=>r(t);return document.addEventListener("click",i,n),()=>document.removeEventListener("click",i,n)}const lo=(window||global||void 0).Error,fo=t=>({tag:fo,data:t}),mo=t=>({tag:mo,error:t}),po=ho.bind(void 0,fo),go=ho.bind(void 0,mo);function ho(t,n){return wo(n),n.tag===t}function vo(t,n){return wo(t),po(t)?t.data:n}function wo(t){if(!function(t){return t&&(t.tag===fo||t.tag===mo)}(t))throw new lo("Not a Result instance")}function Io(t,n){return[yo,t,n]}function yo([t,...n],e,r){return void 0===e?t(...n):t(...n).then((t=>fo(t))).catch((t=>mo(t))).then((t=>r(e(t))))}const Ao=["name"],bo=["notes"],ko={id:"id",name:"string",notes:"string"};const jo=["clientId","name"],Co=["notes"],Do={id:"id",clientId:"id",name:"string",notes:"string"};function Eo(t){return{...t.prepare().changes}}function To(t){return ji("clients",t)}function Po(t={},n={}){return function(t={},n={}){return new Qi(ko,t).cast(n,[...Ao,...bo]).require(Ao).validate("name",zi({max:255})).validate("notes",zi({max:4096}))}(t,n)}async function No(t={}){const n=Po({},t);if(!n.isValid)throw n;const e=Eo(n),{client:r,errors:i}=await async function(t){return(await _r(Vr,{input:t})).createClient}(e);if(i)throw Es(n,i);return Di("clients",r)}async function $o(t,n={}){const e=Po(t,n);if(!e.isValid)throw e;const r=e.get("id"),i=Eo(e),{client:s,errors:o}=await async function(t,n){return(await _r(Lr,{id:t,input:n})).updateClient}(r,i);if(o)throw Es(e,o);return Ei("clients",r,s)}async function Fo(t){return await async function(t){return(await _r(Rr,{id:t})).deleteClient.client}(t),Ti("clients",t)}function Uo(t){const{...n}=t.prepare().changes;return delete n.clientId,n}function So(t){return ji("clientAccounts",t)}function xo(t={},n={}){return function(t={},n={}){return new Qi(Do,t).cast(n,[...jo,...Co]).require(jo).validate("name",zi({max:255})).validate("notes",zi({max:4096}))}(t,n)}async function Mo(t={}){const n=xo({},t);if(!n.isValid)throw n;const e=n.get("clientId"),r=Uo(n),{clientAccount:i,errors:s}=await async function(t,n){return(await Jr(Gr,{clientId:t,input:n})).createClientAccount}(e,r);if(s)throw Es(n,s);return Di("clientAccounts",i)}async function Oo(t,n={}){const e=xo(t,n);if(!e.isValid)throw e;const r=e.get("id"),i=Uo(e),{clientAccount:s,errors:o}=await async function(t,n){return(await Jr(Hr,{id:t,input:n})).updateClientAccount}(r,i);if(o)throw Es(e,o);return Ei("clientAccounts",r,s)}async function Vo(t){return await async function(t){return(await Jr(Yr,{id:t})).deleteClientAccount.clientAccount}(t),Ti("clientAccounts",t)}function Lo(t){return(t||"").split("\n").filter(Boolean).map((t=>pt({},t)))}function Ro(t,n){return t.localeCompare(n,{sensitivity:"base",numeric:!0})}function _o(t,n){return Ro(t.name,n.name)}function qo(t,n){return"COMPLETED"===t.status&&"COMPLETED"!==n.status?1:"COMPLETED"!==t.status&&"COMPLETED"===n.status?-1:Date.parse(t.deadline)-Date.parse(n.deadline)}async function Wo(){const[t,n,e,r,i,s]=await Promise.all([To(),So(),Js((t=>t.projectId)),ji("projects",o),Ns(),Os()]);var o;return{clients:t,clientAccounts:n,invoices:e,projects:r,tags:i,tasks:s}}async function Bo(){return await ki(),Wo()}function zo({clients:t,clientAccounts:n,projects:e,tags:r},i){return{project:i?On(e,{id:i}):{},clients:t,clientAccounts:n,tags:r}}function Go(t){return Io([Bo],t)}function Ho(t,n,e){return Io(t.id?[Ss,t,n]:[Us,n],e)}function Yo(t,n,e){return Io([Ss,t,n],e)}function Jo(t,n){return Io([xs,t],n)}function Qo(t,n){return Pi("projects",e=e=>n(t(e))),()=>Ni("projects",e);var e}function Zo(t,n,e){return Io(t.id?[Xs,t,n]:[Zs,n],e)}function Ko(t,n){return Io([to,t],n)}function Xo(t,n){return no((e=>{if(null===e)return n(t(null));(e=e.filter((t=>t.tombstone||t.projectId))).length>0&&n(t(e))}))}function tc([t]){return io("AdminProjects"===t?".view.grid-sidebar":"AdminProject"===t?".view.grid-main":"")}function nc({title:t,message:n,action:e}){return function(...t){return Z({class:"box is-centered"},Z({class:"box-content has-centered-text"},...t))}(lt({class:"title has-large-text"},t),pt({class:"subtitle"},n),e)}function ec(t,n){return Pe({to:n,class:"button is-primary"},t)}function rc(t){return Io([Fr],t)}function ic(t,n,e){return Io([Ur,t,n],e)}function sc(){return[oc]}function oc(){const{pathname:t,search:n,hash:e}=window.location,r=t+n+e;Sr(),Jt(ln({r:r}))}const cc=(window||global||void 0).Error,ac=()=>({tag:ac}),uc=()=>({tag:uc}),lc=t=>({tag:lc,data:t}),dc=t=>({tag:dc,error:t}),fc=[ac,uc,lc,dc];hc.bind(void 0,ac);const mc=hc.bind(void 0,uc),pc=hc.bind(void 0,lc),gc=hc.bind(void 0,dc);function hc(t,n){return Ic(n),n.tag===t}function vc(t,n){return Ic(t),pc(t)?lc(n(t.data)):t}function wc(t,n){return Ic(t),pc(t)?t.data:n}function Ic(t){if(!function(t){return t&&fc.includes(t.tag)}(t))throw new cc("Not a RemoteData instance")}const yc=["firstName","lastName","username","email"],Ac=["isDisabled","isActive","status","notes"],bc=/^[a-z\d][a-z\d_-]+$/,kc=/^[^@\s]+@[^@\s]+\.[^@\s]+$/,jc={id:"id",isDisabled:"boolean",firstName:"string",lastName:"string",username:"string",email:"string",isActive:"boolean",status:"string",notes:"string"};function Cc(t){const n=t.profile||{};return{id:t.id,isDisabled:t.isDisabled,firstName:n.firstName,lastName:n.lastName,username:t.username,email:t.email,isActive:n.isActive,status:n.status,notes:n.notes}}function Dc({profile:{firstName:t,lastName:n}}){return t+" "+n}function Ec(t){const n=t.get("isActive");return null==n&&t.put("isActive",!0),t}function Tc({profile:{firstName:t,color:n}}){return K({class:"avatar",style:`background: ${n}`},t[0])}function Pc(t,n=!1){const e=n?function({profile:{firstName:t,lastName:n}}){return t+" "+n[0]+"."}(t):Dc(t);return Pe({to:xn(t.id),class:"avatar-flag"},Tc(t),K({class:"avatar-flag-label"},e))}const Nc=se(O((function(t){return[{isActive:!1,currentUser:uc()},rc($c)]}),(function(t,n,e){switch(t.tag){case $c:return function({result:t},n,e){const r=vo(t,{}).user;return n.currentUser=r?lc(r):dc(),[n,null]}(t,n);case Fc:return n.isActive=!n.isActive,[n,null];case Uc:return n.isActive=!1,[n,null];case Sc:return[n,sc()];default:throw"Unmatched message"}}),(function({isActive:t,currentUser:n}){if(!pc(n))return ct({});const e=wc(n,null);return ct({class:"user-menu",onClick:t?void 0:Ft(Fc())},Tc(e),t&&tt({class:"user-menu-items"},at({class:"user-menu-title"},Dc(e)),nt({},Pe({to:xn(e.id)},"Account")),nt({},Pe({onClick:Ft(Sc())},"Logout"))))}),(function({isActive:t},n){return t?[oo(Uc(),{capture:!0})]:[]}),{},{}));const $c=t=>({tag:$c,result:t}),Fc=()=>({tag:Fc}),Uc=()=>({tag:Uc}),Sc=()=>({tag:Sc});function xc(t){return at({class:"app-header grid-header"},lt({class:"app-header-title"},t),Nc())}function Mc(t,n){return at({class:"app-header is-subheader"},n&&kt({class:"button is-link",onClick:Ft(n)},ke()),lt({class:"app-header-title is-truncated"},t))}function Oc(t){return"UNAUTHORIZED"===t.message}function Vc(t){const{title:n,message:e}=function(t={}){switch(t&&t.message){case"UNAUTHORIZED":return{title:"Not authorized.",message:"You are not authorized to view this page."};case"NOT_FOUND":return{title:"Not found.",message:"The page you are looking for doesn’t exist."};default:return{title:"An error occured.",message:"Check your internet connection and try reloading the page or contact an administrator is the error persists."}}}(t);return nc({title:n,message:e,action:ec("Go home",un())})}function Lc(){return tt({class:"list"},Rc(),Rc(),Rc(),Rc())}function Rc(){return nt({class:"list-item"},Z({class:"list-item-face"},at({class:"list-item-header"},ft({class:"title is-mock"})),Z({class:"list-item-status"},K({class:"tag is-mock"}))))}function _c(){return Z({class:"details-mock"},at({class:"details-mock-header"},lt({class:"title is-mock"})),ut({class:"details-mock-body"}))}function qc(){return Z({class:"directory"},tt({class:"directory-list"},nt({class:"directory-group"},K({class:"directory-group-label"},""),tt({class:"directory-list"},Wc(),Wc(),Wc(),Wc(),Wc(),Wc()))))}function Wc(){return nt({class:"directory-item-mock"},K({class:"text-mock"}))}function Bc(t){return Z({class:"viewport"},Z({class:"view is-active"},xc("Projects"),Vc(t)))}function zc([t]){return Z({class:"viewport grid is-two"},xc("Projects"),ut({class:"view grid-sidebar",classes:{"is-active":"AdminProject"!==t}},xc("Projects"),Lc()),function(t){return ut({class:"view grid-main",classes:{"is-active":t}},Mc("Project"),_c())}("AdminProject"===t))}function Gc(t,n){return Z({classes:{backdrop:!0,"is-active":t},aria:{hidden:"true"},onClick:n?Ft(n):void 0})}const Hc=["AdminProjects","AdminProject","NewAdminProject","EditAdminProject","AdminProjectInvoice","NewAdminProjectInvoice","EditAdminProjectInvoice"];function Yc([t,{projectId:n,id:e,active:r}]){const i="AdminProject"===t,s="AdminProjectInvoice"===t,o="NewAdminProject"===t||"EditAdminProject"===t,c="NewAdminProjectInvoice"===t||"EditAdminProjectInvoice"===t;return{projectId:n=s||c?r||n:o?r||e:i?e:void 0,invoiceId:s?e:void 0,formProjectId:o?e:void 0,formInvoiceId:c?e:void 0,isList:"AdminProjects"===t,isDetails:i,isInvoice:s,isForm:o,isInvoiceForm:c}}function Jc(t,n,...e){return ct({class:"section-menu",onClick:t?void 0:Ft(n)},be({class:"section-menu-button"}),t&&tt({class:"section-menu-items"},...e))}function Qc(t=[]){return Z({class:"tags"},...t.map((({name:t,style:n})=>Zc({style:n},t))))}function Zc({type:t,class:n,...e},...r){const i=t?`tag is-${t}`:"tag";return K({...e,class:n=n?i+" "+n:i},...r)}function Kc(t){return"COMPLETED"===t?K({class:"tag is-success"},"Completed"):K({class:"tag"},"In progress")}function Xc(t,n="auto",e=!1){if(!t)throw new Error("Missing datetime");const r=new Date(t),i=as(r);"auto"===n&&(n=i<1?"danger":i<7?"warning":null);const s=e?is(r,"compact"):fs(t)?"Yesterday at "+rs(t):ms(t)?"Today at "+rs(t):ps(t)?"Tomorrow at "+rs(t):i<1?es(r,"compact"):i<2?"1 day left":i<7?`${i} days left`:es(r,"compact");return st({datetime:t,title:is(r),class:"tag"+(n?` is-${n}`:"")},Ce(),K({},s))}const ta=["NOT_PAID","NOT_SENT","SENT","PAID"];function na({dueDate:t,paidAt:n}){if(!t)return null;const[e,r]=n?["success",!0]:["auto",!1];return function(t,n="auto",e=!1){if(!t)throw new Error("Missing datetime");const r=new Date(t),i=as(r);"auto"===n&&(n=i<1?"danger":i<7?"warning":null);const s=e?es(r,"compact"):fs(r)?"Yesterday":ms(r)?"Today":ps(r)?"Tomorrow":i<1?es(r,"compact"):i<2?"1 day left":i<7?`${i} days left`:es(r,"compact");return st({date:r,title:es(r),class:"tag"+(n?` is-${n}`:"")},Ce(),K({},s))}(t,e,r)}function ea({paidAt:t,receivedAt:n,sentAt:e},r=!1){const[i,s,o]=t?["success","Paid",`Paid on ${es(t,"compact")}`]:n?[void 0,"Received",`Received on ${es(n,"compact")}`]:e?[void 0,"Sent",`Sent on ${es(e,"compact")}`]:["danger","Not sent","Not sent"];return r?Zc({type:i},o):Zc({type:i,title:o},s)}function ra(t){if(!t||0===t.length)return null;if(!Array.isArray(t))throw TypeError("invoices must be a list");const n=function(t){return t.map(ia).reduce(sa,"PAID")}(t),[e,r]="PAID"===n?[void 0,"$ Paid"]:"SENT"===n?["warning","$ Sent"]:"NOT_PAID"===n?["danger","$ Not paid"]:["danger","$ Not sent"];return Zc({type:e,class:"is-transparent"},r)}function ia({dueDate:t,sentAt:n,paidAt:e}){return e?"PAID":n?t&&Date.parse(t)<Date.now()?"NOT_PAID":"SENT":"NOT_SENT"}function sa(t,n){const e=ta.indexOf(t),r=ta.indexOf(n);if(-1===e||-1===r)throw RangeError("Unknown payment status");return e<r?t:n}const oa=se(O((function({projects:t,activeId:n},e){return[{activeId:n,projects:t,itemWithMenu:null},null]}),(function(t,n,e){switch(t.tag){case ca:return n.projects=t.projects,[n,null];case aa:return n.activeId=t.id,[n,null];case ua:return function({id:t,status:n},e,r){const i=On(e.projects,{id:t});return i?[e,Yo(i,{status:n},la)]:[e,null]}(t,n);case la:return function({result:t},n,e){return go(t)?[n,Xn({type:"danger",message:"An error occured and the changes couldn’t be saved. Please try again."})]:[n,null]}(t,n);case da:return[n,Jo(t.id,fa)];case fa:return function({result:t},n,e){if(go(t))return[n,Xn({type:"danger",message:"An error occured and the project couldn’t be deleted. Please try again."})];const{id:r}=vo(t,null);return r===n.activeId?[n,Wn(In())]:[n,null]}(t,n);case ma:return n.itemWithMenu=n.itemWithMenu!==t.id?t.id:null,[n,null];case pa:return n.itemWithMenu=null,[n,null];default:throw"Unmatched message"}}),(function({projects:t,activeId:n,itemWithMenu:e}){return J("ul",{class:"list"},...t.map((t=>[t.id,ga(t,n,e)])))}),(function({itemWithMenu:t},n){const e=[ae(n,"projects",ca),ae(n,"activeId",aa)];t&&e.push(oo(pa(),{capture:!0}));return e}),{projects:Array.isArray,activeId:_n},{}));const ca=t=>({tag:ca,projects:t}),aa=t=>({tag:aa,id:t}),ua=(t,n)=>({tag:ua,id:t,status:n}),la=t=>({tag:la,result:t}),da=t=>({tag:da,id:t}),fa=t=>({tag:fa,result:t}),ma=t=>({tag:ma,id:t}),pa=()=>({tag:pa});function ga(t,n,e){const{id:r,status:i}=t;return nt({id:r,classes:{"list-item":!0,"is-active":r===n}},function(t,n,e,r){return Jc(r,ma(t),nt({},Pe({to:Dn(t)},"Tasks")),nt({},function(t,n){return"COMPLETED"===n?Pe({onClick:Ft(ua(t,"IN_PROGRESS"))},"Mark as in progress"):Pe({onClick:Ft(ua(t,"COMPLETED"))},"Mark as completed")}(t,e)),nt({},Pe({to:kn(t)},"Add invoice")),nt({},Pe({to:bn(t,{active:n})},"Edit project")),nt({},Pe({onClick:Ft(da(t))},"Delete project")))}(r,n,i,r===e),Pe({to:An(r),class:"list-item-face"},function({name:t,code:n,clientAccount:e,tags:r}){return at({class:"list-item-header"},Qc(r||[]),function(t,n){return t?ft({class:"title has-subtitle is-mute is-truncated"},gt({},t)," | ",n):ft({class:"title has-subtitle is-truncated"},n)}(n,t),mt({class:"subtitle is-truncated"},function({clientId:t,id:n,name:e}){return Ne({to:vn(t,n)},K({},e))}(e)))}(t),function({id:t,status:n,deadline:e,tasks:r,invoices:i}){const s=r.length,o=r.filter((t=>"COMPLETED"===t.status)).length;return Z({class:"list-item-status"},"COMPLETED"===n?Kc(n):e&&Xc(e),Ne({to:Dn(t)},gt({},`${o} / ${s} tasks`)),K({styles:{margin:"0","margin-left":"auto"}}),ra(i))}(t)))}const ha=(t=>t.call.bind(t))(Object.prototype.toString),va=(t=>t.call.bind(t))(Object.prototype.hasOwnProperty);function wa(t){return t&&"[object Object]"===ha(t)}function Ia(...t){t=t.filter(Boolean);const n={};for(const e of t)for(const t in e)va(e,t)&&(n[t]=e[t]);return n}function ya(t){return"auto"===t?{min:void 0,max:void 0}:"number"==typeof t?{min:t,max:t}:t||{}}function Aa(t,{compact:n=!1,precision:e="auto"}={}){const{max:r,min:i}=ya(e),s={notation:n?"compact":"standard",minimumFractionDigits:i,maximumFractionDigits:r};return new Intl.NumberFormat("en-US",s).format(+t)}function ba(t,{compact:n=!1,precision:e=2}={}){const{max:r,min:i}=ya(e),s={notation:n?"compact":"standard",style:"currency",currency:"USD",minimumFractionDigits:i,maximumFractionDigits:r};return new Intl.NumberFormat("en-US",s).format(+t)}const ka=se(O((function({invoices:t},n){return[{invoices:ja(t),itemWithMenu:null},null]}),(function(t,n,e){switch(t.tag){case Ca:return n.invoices=ja(t.invoices),[n,null];case Da:return[n,Ko(t.id,Ea)];case Ea:return function({result:t},n,e){return go(t)?[n,Xn({type:"danger",message:"An error occured and the invoice couldn’t be deleted. Please try again."})]:[n,null]}(t,n);case Ta:return n.itemWithMenu=n.itemWithMenu!==t.id?t.id:null,[n,null];case Pa:return n.itemWithMenu=null,[n,null];case Na:return[n,Wn(t.path)];default:throw"Unmatched message"}}),(function({invoices:t,itemWithMenu:n}){return jt({class:"invoice-table table is-fullwidth"},Ct({},Tt({},Pt({},"Status"),Pt({},"Due date"),Pt({},"Payment"),Pt({}))),J("tbody",{},...t.map((t=>[t.id,$a(t,n)]))),Et({},Tt({},Pt({}),Pt({}),Pt({},"Total: ",ba(function(t){return t.reduce(((t,n)=>t+Number(n.total)),0)}(t))),Pt({}))))}),(function({itemWithMenu:t},n){const e=[ae(n,"invoices",Ca)];t&&e.push(oo(Pa(),{capture:!0}));return e}),{invoices:Array.isArray},{}));function ja([...t]){return t.sort(((t,n)=>Date.parse(t.dueDate)-Date.parse(n.dueDate)))}const Ca=t=>({tag:Ca,invoices:t}),Da=t=>({tag:Da,id:t}),Ea=t=>({tag:Ea,result:t}),Ta=t=>({tag:Ta,id:t}),Pa=()=>({tag:Pa}),Na=t=>({tag:Na,path:t});function $a(t,n){const e=jn(t.projectId,t.id),r={onClick:Ft(Na(e))};return Tt({},Nt(r,ea(t)),Nt(r,na(t)),Nt(r,ba(t.total)),Nt({},function({projectId:t,id:n},e){return Jc(e,Ta(n),nt({},Pe({to:jn(t,n)},"View invoice")),nt({},Pe({to:Cn(t,n)},"Edit invoice")),nt({},Pe({onClick:Ft(Da(n))},"Delete invoice")))}(t,t.id===n)))}const Fa=se(O((function({project:t},n){return[{project:t,menu:!1},null]}),(function(t,n,e){switch(t.tag){case Ua:return n.project=t.project,[n,null];case Sa:return function({status:t},n,e){return[n,Yo(n.project,{status:t},xa)]}(t,n);case xa:return function({result:t},n,e){return go(t)?[n,Xn({type:"danger",message:"An error occured and the changes couldn’t be saved. Please try again."})]:[n,null]}(t,n);case Ma:return[n,Jo(n.project.id,Oa)];case Oa:return function({result:t},n,e){return go(t)?[n,Xn({type:"danger",message:"An error occured and the project couldn’t be deleted. Please try again."})]:[n,Wn(In())]}(t,n);case Va:return n.menu=!n.menu,[n,null];case La:return n.menu=!1,[n,null];default:throw"Unmatched message"}}),(function({project:t,menu:n}){const e=t.tasks,r=e.length,i=e.filter((t=>"COMPLETED"===t.status)).length;return Z({class:"project"},(s=i,o=r,ot({class:"project-progress",value:""+s,max:""+o})),function(t,n,e,r){return at({class:"project-header"},function({id:t,status:n},e){return Jc(e,Va(),nt({},Pe({to:Dn(t)},"Tasks")),nt({},function(t){return"COMPLETED"===t?Pe({onClick:Ft(Sa("IN_PROGRESS"))},"Mark as in progress"):Pe({onClick:Ft(Sa("COMPLETED"))},"Mark as completed")}(n)),nt({},Pe({to:kn(t)},"Add invoice")),nt({},Pe({to:bn(t)},"Edit project")),nt({},Pe({onClick:Ft(Ma())},"Delete project")))}(t,r),Qc(t.tags||[]),lt({class:"title has-subtitle"},t.name),dt({class:"subtitle"},function({clientId:t,id:n,name:e}){return Ne({to:vn(t,n)},K({},e))}(t.clientAccount)),t.brief&&pt({class:"project-brief"},...Lo(t.brief)),function({id:t,status:n,deadline:e},r,i){const s="COMPLETED"===n,o=s?null:"auto";return Z({class:"project-status"},s&&Kc(n),e&&Xc(e,o,!0),Ne({to:Dn(t)},gt({},`${r} / ${i} tasks`)))}(t,n,e))}(t,i,r,n),function({id:t,invoices:n}){return ut({class:"project-section project-invoices"},dt({class:"title"},"Invoices"),0!==n.length?ka({invoices:n}):null,ec("Add invoice",kn(t)))}(t),t.notes&&function({notes:t}){return ut({class:"project-section"},dt({class:"title"},"Notes"),...Lo(t))}(t));var s,o}),(function({menu:t},n){const e=[ae(n,"project",Ua)];t&&e.push(oo(La(),{capture:!0}));return e}),{project:wa},{}));const Ua=t=>({tag:Ua,project:t}),Sa=t=>({tag:Sa,status:t}),xa=t=>({tag:xa,result:t}),Ma=()=>({tag:Ma}),Oa=t=>({tag:Oa,result:t}),Va=()=>({tag:Va}),La=()=>({tag:La});const Ra=O((function({attributes:t,children:n},e){return[{attributes:t,children:n,query:"",showMenu:!1},null]}),(function(t,n,e){switch(t.tag){case _a:return n.attributes=t.attributes,[n,null];case qa:return n.children=t.children,[n,null];case Wa:return[n,ce(e,"focus")];case Ba:return n.showMenu=!1,n.query="",[n,ce(e,"blur")];case za:return n.showMenu=!n.showMenu,n.query=n.showMenu?n.query:"",[n,null];case Ga:{const r=t.value,i=n.children,s=i.find((t=>t.attributes.value===r));if(!s)return[n,null];s.attributes.selected=!s.attributes.selected;const o=i.filter(Ja).map(Qa);return[n,ce(e,"change",o)]}case Ha:return n.children=n.children.map((r=t.values,function(t){return t.attributes.selected=r.includes(t.attributes.value),t})),[n,ce(e,"change",t.values)];case Ya:return n.query=t.query,[n,null];default:throw"Unmatched message"}var r}),(function(t){const n=Object.assign({},t.attributes),e={multiselect:!0,"is-active":t.showMenu,"is-disabled":n.disabled};return delete n.disabled,delete n.placeholder,Z({...n,classes:Ia(n.classes,e),onFocusout:Ut(Ba)},function({attributes:t,children:n}){return kt({class:"multiselect-button",aria:{hidden:!0},onFocus:$t(Wa()),onClick:Ft(za()),disabled:t.disabled},n.some((t=>t.attributes.selected))?(r=n,tt({class:"multiselect-tags"},...r.filter(Ja).map(Za))):(e=t.placeholder,pt({class:"multiselect-placeholder"},e||"Select an option...")));var e;var r}(t),function({children:t,query:n}){return Z({class:"multiselect-menu",aria:{hidden:!0}},t.length<7?null:function(t){return Z({class:"multiselect-searchbox"},It({type:"search",value:t,placeholder:"Search...",class:"input",onInput:St(Ya)}))}(n),tt({class:"multiselect-menu-list"},...function(t,n){return(t=t.trim().toLowerCase())?n.map((n=>Ka(n,!function(t,n){return Xa(n).toLowerCase().includes(t)}(t,n)))):n.map((t=>Ka(t,!1)))}(n,t)))}(t),function({attributes:t,children:n}){return At({...t,multiple:!0,classes:Ia(t.classes,{"multiselect-fallback":!0}),onChange:(e=Ha,function({target:{selectedOptions:t}},n){const r=Array.from(t).map((t=>t.value));n(e(r))})},...n);var e}(t))}),(function(t,n){return[ae(n,"attributes",_a),ae(n,"children",qa)]}),{attributes:wa,children:Array.isArray},{change:!0,focus:!0,blur:!0});const _a=t=>({tag:_a,attributes:t}),qa=t=>({tag:qa,children:t}),Wa=()=>({tag:Wa}),Ba=()=>({tag:Ba}),za=()=>({tag:za}),Ga=t=>({tag:Ga,value:t}),Ha=t=>({tag:Ha,values:t}),Ya=t=>({tag:Ya,query:t});function Ja(t){return!!t.attributes.selected}function Qa(t){return t.attributes.value}function Za(t){return nt({class:"multiselect-tag",title:t.attributes.title},t.attributes.label||Xa(t))}function Ka({attributes:t,children:n},e=!1){t=Object.assign({},t);const{value:r,disabled:i,selected:s}=t,o={"multiselect-option":!0,"is-disabled":i,"is-hidden":e,"is-selected":s};return delete t.value,delete t.disabled,delete t.selected,nt({...t,tabindex:"-1",classes:Ia(t.classes,o),onClick:Ft(Ga(r))},...n)}function Xa(t){return"string"==typeof t?t:t.children.reduce(((t,n)=>t+Xa(n)),"")}function tu(t,n,e){return Z({classes:{field:!0,"has-error":!!e}},t&&wt({class:"label"},t),Z({class:"control"},n),e&&pt({class:"help is-error"},e))}function nu(...t){return t.filter(Boolean).join(" ")}function eu(t,n,e={}){return It({...e,value:t,type:"text",class:nu("input",e.class),onChange:n&&St(n)})}function ru(t,n,e={}){return yt({...e,class:nu("textarea",e.class),onChange:n&&St(n)},t)}function iu(t,n,e={}){return It({...e,value:t,type:"text",inputmode:"numeric",class:nu("input",e.class),onChange:n&&St(n)})}function su(t,n,e={}){return It({...e,value:t,type:"text",autocomplete:"username",class:nu("input",e.class),onChange:n&&St(n)})}function ou(t,n,e={}){return It({...e,value:t,type:"password",autocomplete:"current-password",class:nu("input",e.class),onChange:n&&St(n)})}function cu(t,n,e={}){return It({...e,value:t,type:"date",class:nu("input",e.class),onChange:n&&St(n)})}function au(t,n,e={}){return It({...e,value:t,type:"time",class:nu("input",e.class),onChange:n&&St(n)})}function uu(t=du){return function(n,e,{placeholder:r,options:i,...s}={}){return Array.isArray(n)||(n=[n]),n=n.map(fu),At({...s,class:nu("select",s.class),onChange:e&&St(e)},void 0===(o=r)?null:bt({value:"",disabled:!0,selected:!0},o),...t(i,n));var o}}function lu(t=du){return function(n,e,{options:r,...i}={}){return null!=n&&""!==n||(n=[]),function({onChange:t,onFocus:n,onBlur:e,...r},...i){return se(Ra)({onChange:t,onFocus:n,onBlur:e,attributes:r,children:i})}({...i,values:n=n.map(fu),onChange:$t(e)},...t(r,n))}}function du(t,n){return t.map((t=>function([t,n,e={}],r){return bt({value:t,selected:r.includes(t),...e},n)}(t,n)))}function fu(t){return null==t?"":String(t)}class mu{constructor(t,n="",e={}){this.isChanged=!1,this.isDirty=!1,this.isTouched=!1,this.isValid=!0,this.name=t,this.defaultValue=n,this.value=n,this.errors=[],this.version=0,this.props=e}change(){return this.version++,this}get(){return this.value}set(t){let n=!1;return this.isTouched||(n=!0,this.isTouched=!0),t!==this.value&&(n=!0,this.value=t,this.isChanged=t!==this.defaultValue,this.isDirty=!0),n&&this.change(),this}getErrors(){return this.errors}setErrors(t=[]){return this.isDirty=!1,this.isValid=0===t.length,this.errors=t,this.change(),this}getProp(t){return this.props[t]}setProp(t,n){return n!==this.props[t]&&(this.props[t]=n,this.change()),this}reset(){return this.value=this.defaultValue,this.isChanged=!1,this.isDirty=!1,this.isTouched=!1,this.isValid=!0,this.errors=[],this.version=0,this}}const pu=/\[(\d+)\]/g,gu=(t,n)=>"."+n;function hu(t){return Array.isArray(t)?[...t]:t.replace(pu,gu).split(".")}function vu(t,n){let e=t;const r=hu(n),i=r.length-1,s=r[i];for(let t=0;t<i&&(e=e[r[t]],void 0!==e);t++);return[e,s]}function wu(t,n){const[e,r]=vu(t,n);if(null===e)throw new RangeError("Path not found");return e[r]}function Iu(t,n,e){const[r,i]=vu(t,n);if(null===r)throw new RangeError("Path not found");return r[i]=e,t}const yu=Array.isArray,Au=t=>t instanceof mu,bu=t=>t instanceof Tu,ku=t=>Au(t)?t.get():t,ju=(t,n)=>Au(t)?t.set(n):n,Cu=t=>Au(t)?t.errors:[],Du=(t,n)=>Au(t)?t.setErrors(n):t,Eu=t=>Au(t)?t.reset():t;class Tu{constructor(t={},n={}){Object.defineProperty(this,"__meta__",{configurable:!1,enumerable:!1,writable:!0,value:n}),Object.assign(this,t)}getMeta(t){return this.__meta__[t]}setMeta(t,n){return this.__meta__[t]=n,this}getValues(){return Pu(this,ku)}setValues(t){return Nu(this,t,ju)}getFormErrors(){return Pu(this,Cu)}setFormErrors(t){return Nu(this,t,Du)}reset(){return Nu(this,this,Eu)}get(t){return wu(this,t)}set(t,n){return Iu(this,t,n)}update(t,n){const e=hu(t);return Iu(this,e,n(wu(this,e)))}getValue(t){return ku(this.get(t))}setValue(t,n){return this.get(t).set(n),this}getErrors(t){return Cu(this.get(t))}setErrors(t,n){return Du(this.get(t),n),this}getProp(t,n){return((t,n)=>Au(t)?t[n]:void 0)(this.get(t),n)}setProp(t,n,e){return((t,n,e)=>{Au(t)&&t.setProp(n,e)})(this.get(t),n,e),this}setProps(t,n){const e=this.get(t);if(Au(e))for(const t in n)e.setProp(t,n[t]);return this}}function Pu(t,n){const e={};for(const r in t){const i=t[r];yu(i)?e[r]=i.map((t=>Pu(t,n))):bu(i)?e[r]=Pu(i,n):e[r]=n(i)}return e}function Nu(t,n,e){for(const r in t){if(!(r in n))continue;const i=t[r],s=n[r];if(yu(i))for(let n=0,o=i.length;n<o;n++)n in s?i[n]=e(i[n],s[n]):bu(i)?t[r]=Nu(i,s,e):t[r]=e(i,s)}return t}function $u(t,n="",e={}){return new mu(t,n,e)}function Fu(t,n,e=!1){if(void 0===n)return t;for(const r in t){const i=t.get(r);if(i instanceof mu)e&&!i.isTouched&&""===i.value||t.setErrors(r,n.errors[r].map(Uu));else if(i instanceof Tu)Fu(i,n.getChange(r),e);else if(Array.isArray(i)){const t=n.getChange(r)||[];for(let n=0,r=t.length;n<r;n++)Fu(i[n],t[n],e)}}return t}function Uu(t){if("string"==typeof t)return t;switch(t.code){case"blank":return"can't be empty";case"taken":return"has already been taken";case"tooShort":return`can't be less than ${t.min} characters long`;case"tooLong":return`can't be more than ${t.max} characters long`;case"number":return function({type:t,number:n}){switch(t){case"is":return`must be equal to ${n}`;case"not":return`can't be equal to ${n}`;case"greaterThan":return`can't be less or equal to ${n}`;case"greaterOrEqual":return`can't be less than ${n}`;case"lessOrEqual":return`can't be greater than ${n}`;case"lessThan":return`can't be greater or equal to ${n}`;default:return"is invalid"}}(t);default:return"is invalid"}}function Su(t,n,e,r){const i=t.id,s=function({clientId:t,clientAccountId:n},e){return t||(n?(e.find((t=>t.id===n))||{}).clientId:void 0)}(t,e),o=t.clientAccountId,c=r.map((t=>[t.id,t.name])),a=t.deadline&&new Date(t.deadline);return new Tu({clientId:xu(i,s,n),clientAccountId:Mu(i,s,o,e),name:$u("name",t.name),code:$u("code",t.code),tagIds:$u("tagIds",t.tagIds,{options:c}),date:$u("date",os(a)),time:$u("time",cs(a)),brief:$u("brief",t.brief),notes:$u("notes",t.notes)})}function xu(t,n,e){const r=e.map((t=>[t.id,t.name])),i=0!==r.lenth;return $u("clientId",n,{placeholder:i?"Select a client...":"There are no clients",options:r,disabled:!!t||!i})}function Mu(t,n,e,r){const i=Ou(r,n),s=!!t||0===i.lenth;return $u("clientAccountId",e,{placeholder:Vu(i,n),options:i,disabled:s})}function Ou(t,n){return void 0===n?[]:t.filter((t=>t.clientId===n)).map((t=>[t.id,t.name]))}function Vu(t,n){return 0!==t.lenth?"Select a client account...":n?"There are no client accounts":"Choose a client first"}(t=>{t.call.bind(t)})(Object.prototype.toString);const Lu=se(O((function({project:t,clients:n,clientAccounts:e,tags:r},i){return[{project:t,clients:n,clientAccounts:e,tags:r,form:Su(t,n,e,r),isDisabled:!1},null]}),(function(t,n,e){switch(t.tag){case Ru:return function({project:t},n,e){const{clients:r,clientAccounts:i,tags:s}=n;return n.project=t,n.form=Su(t,r,i,s),[n,null]}(t,n);case _u:return function({name:t,value:n},e,r){const i=e.form.setValue(t,n),s=Fs(e.project,i.getValues());"clientId"===t&&function(t,n){const e=t.getValue("clientId"),r=Ou(n,e),i=0===r.lenth||t.clientId.disabled,s=Vu(r,e);t.setProps("clientAccountId",{placeholder:s,options:r,disabled:i})}(i,e.clientAccounts);return e.form=Fu(i,s,!0),[e,null]}(t,n);case qu:return function(t,n,e){const r=n.form.getValues(),i=Fs(n.project,r);if(!i.isValid)return n.form=Fu(n.form,i,!1),[n,null];return n.isDisabled=!0,[n,Jn(!1),Ho(n.project,r,Wu)]}(0,n);case Wu:return function({result:t},n,e){if(go(t))return function(t,n,e){if(n.isDisabled=!1,t instanceof Qi)return n.form=Fu(n.form,t,!1),[n,Jn(!0)];return[n,Jn(!0),Xn({type:"danger",message:"An error occured and the changes couldn’t be saved. Please try again."})]}(t.error,n);const{id:r}=vo(t,null);return[n,Jn(!0),qn(An(r))]}(t,n);default:throw"Unmatched message"}}),(function({project:t,isDisabled:n,form:e}){return ht({class:"form project-form",onSubmit:xt(qu())},vt({disabled:n},Bu(e,"clientId","Client",uu()),Bu(e,"clientAccountId","Client Account",uu()),Bu(e,"name","Name",eu),Bu(e,"code","Code",eu),Bu(e,"tagIds","Tags",lu()),Bu(e,"date","Due date",cu),Bu(e,"time","Due time",au),Bu(e,"brief","Project brief",ru),Bu(e,"notes","Notes",ru)),kt({type:"submit",class:"button is-primary",disabled:n},t.id?"Save project":"Add project"))}),(function(t,n){return[ae(n,"project",Ru)]}),{project:wa,clients:Array.isArray,clientAccounts:Array.isArray,tags:Array.isArray},{}));const Ru=t=>({tag:Ru,project:t}),_u=t=>n=>({tag:_u,name:t,value:n}),qu=()=>({tag:qu}),Wu=t=>({tag:Wu,result:t});function Bu(t,n,e,r){const{value:i,errors:s,props:o}=t.get(n);return tu(e,r(i,_u(n),o),s.join(", "))}const zu=se(O((function({invoice:t},n){return[{invoice:t,menu:!1},null]}),(function(t,n,e){switch(t.tag){case Gu:return n.invoice=t.invoice,[n,null];case Hu:return[n,Ko(n.invoice.id,Yu)];case Yu:return function({result:t},n,e){if(go(t))return[n,Xn({type:"danger",message:"An error occured and the invoice couldn’t be deleted. Please try again."})];const r=vo(t,{}).projectId;return[n,Wn(An(r))]}(t,n);case Ju:return n.menu=!n.menu,[n,null];case Qu:return n.menu=!1,[n,null];default:throw"Unmatched message"}}),(function({invoice:t,menu:n}){return Z({class:"invoice"},function(t,n){return at({class:"invoice-header"},function({projectId:t,id:n},e){return Jc(e,Ju(),nt({},Pe({to:Cn(t,n)},"Edit invoice")),nt({},Pe({onClick:Ft(Hu())},"Delete invoice")))}(t,n),lt({class:"title has-subtitle"},ba(t.total)),dt({class:"subtitle"},function({id:t,name:n}){return Ne({to:An(t)},K({},n))}(t.project)),function(t){return Z({class:"invoice-status"},na(t),ea(t,!0))}(t))}(t,n),function(t){return ut({class:"invoice-section"},dt({class:"title"},"Detail"),function({items:t,total:n}){return Z({class:"table-containter"},jt({class:"invoice-items-table table is-fullwidth"},Ct({},Tt({},Pt({},"Description"),Pt({},"Quantity"),Pt({},"Price"))),Dt({},...t.map(Zu)),Et({},Tt({},Pt({}),Pt({},"Total"),Pt({},ba(n))))))}(t))}(t),function({notes:t}){return t?ut({class:"invoice-section"},dt({class:"title"},"Notes"),...Lo(t)):null}(t))}),(function({menu:t},n){const e=[ae(n,"invoice",Gu)];t&&e.push(oo(Qu(),{capture:!0}));return e}),{invoice:wa},{}));const Gu=t=>({tag:Gu,invoice:t}),Hu=()=>({tag:Hu}),Yu=t=>({tag:Yu,result:t}),Ju=()=>({tag:Ju}),Qu=()=>({tag:Qu});function Zu({description:t,quantity:n,price:e}){return Tt({},Nt({},t),Nt({},Aa(n)),Nt({},ba(e)))}function Ku(t,n){const e={disabled:!0,options:[[n.id,n.name]]};return new Tu({projectId:$u("projectId",n.id,e),dueDate:$u("dueDate",Xu(t.dueDate)),sentAt:$u("sentAt",Xu(t.sentAt)),receivedAt:$u("receivedAt",Xu(t.receivedAt)),paidAt:$u("paidAt",Xu(t.paidAt)),items:(r=t.items,r&&r.length>0?r:[{}]).map(tl),notes:$u("notes",t.notes)});var r}function Xu(t){return t?os(new Date(t)):""}function tl({id:t,description:n,quantity:e,price:r}){const i={id:t,description:$u("description",n),quantity:$u("quantity",e),price:$u("price",r)};return new Tu(i,{key:t||nl()})}const nl=(()=>{let t=0;return()=>String(t++)})();function el({items:t}){return t.reduce(((t,n)=>t+function(t){const n=Number(t.getValue("quantity")),e=Number(t.getValue("price"));return Number.isNaN(n)||Number.isNaN(e)?0:n*e}(n)),0)}const rl=se(O((function({invoice:t,project:n},e){return[{invoice:t,project:n,form:Ku(t,n),isDisabled:!1},null]}),(function(t,n,e){switch(t.tag){case il:return function({invoice:t},n,e){return n.invoice=t,n.form=Ku(t,n.project),[n,null]}(t,n);case sl:return function({name:t,value:n},e,r){const i=e.form.setValue(t,n),s=Qs(e.invoice,i.getValues());return e.form=Fu(i,s,!0),[e,null]}(t,n);case ol:return function(t,n,e){return n.form=function(t,n={}){return t.items.push(tl(n)),t}(n.form),[n,null]}(0,n);case cl:return function({index:t},n,e){return n.form=function(t,n){return t.items.splice(n,1),t}(n.form,t),[n,null]}(t,n);case al:return function(t,n,e){const r=n.form.getValues(),i=Qs(n.invoice,r);if(!i.isValid)return n.form=Fu(n.form,i,!1),[n,null];return n.form.isDisabled=!0,[n,Jn(!1),Zo(n.invoice,r,ul)]}(0,n);case ul:return function({result:t},n,e){if(go(t))return function(t,n,e){if(n.isDisabled=!1,t instanceof Qi)return n.form=Fu(n.form,t,!1),[n,Jn(!0)];return[n,Jn(!0),Xn({type:"danger",message:"An error occured and the changes couldn’t be saved. Please try again."})]}(t.error,n);const{id:r,projectId:i}=vo(t,null);return[n,Jn(!0),qn(jn(i,r))]}(t,n);default:throw"Unmatched message"}}),(function({invoice:t,isDisabled:n,form:e}){return ht({class:"form invoice-form",onSubmit:xt(al())},vt({disabled:n},ll(e,"projectId","Project",uu()),ll(e,"dueDate","Due date",cu),ll(e,"sentAt","Sent on",cu),ll(e,"receivedAt","Received on",cu),ll(e,"paidAt","Paid on",cu),function(t){const n=t.items,e=n.length>1;return Z({class:"invoice-form-items"},Z({class:"invoice-form-items-header"},wt({class:"label"},"Description"),wt({class:"label"},"Quantity"),wt({class:"label"},"Price")),J("div",{class:"invoice-form-items-list"},...n.map(((t,n)=>[t.getMeta("key"),dl(t,n,e)]))),Z({class:"invoice-form-items-footer"},kt({class:"button is-link",onClick:Ft(ol())},"Add item +"),gt({},`Total: ${ba(el(t))}`)))}(e),ll(e,"notes","Notes",ru)),kt({type:"submit",class:"button is-primary",disabled:n},t.id?"Save invoice":"Add invoice"))}),(function(t,n){return[ae(n,"invoice",il)]}),{invoice:wa,project:wa},{}));const il=t=>({tag:il,invoice:t}),sl=t=>n=>({tag:sl,name:t,value:n}),ol=()=>({tag:ol}),cl=t=>({tag:cl,index:t}),al=()=>({tag:al}),ul=t=>({tag:ul,result:t});function ll(t,n,e,r){const{value:i,errors:s,props:o}=t.get(n);return tu(e,r(i,sl(n),o),s.join(", "))}function dl(t,n,e=!0){return vt({class:"invoice-form-item"},Z({class:"invoice-form-item-header"},wt({class:"label"},`Item #${n+1}`),function(t,n=!1){return X({disabled:n,class:"button is-close is-light",title:"Remove item",onClick:!n&&Ft(t)})}(cl(n),!e)),Z({class:"invoice-form-item-controls"},fl(n,t.description,"Description",eu),fl(n,t.quantity,"Quantity",iu),fl(n,t.price,"Price",iu)),function({description:t,quantity:n,price:e}){const r=[...t.errors.map((t=>`description ${t}`)),...n.errors.map((t=>`quantity ${t}`)),...e.errors.map((t=>`price ${t}`))];return 0===r.length?null:pt({class:"help is-error"},r.join(", "))}(t))}function fl(t,{name:n,value:e,isValid:r,props:i},s,o){return Z({classes:{field:!0,"has-error":!r}},Z({class:"control"},o(e,sl(`items[${t}].${n}`),{...i,placeholder:s})))}const ml=se(O((function({page:t},n){const e={page:{current:t,retiring:null},data:uc()},r=[Jn(!1),(i=hl,Io([Wo],i)),Go(hl)];var i;return[e,...r]}),(function(t,n,e){switch(t.tag){case pl:return function({page:t},n,e){return n.page={current:t,retiring:n.page.current},[n,tc(t),de(300,gl())]}(t,n);case gl:return n.page.retiring=null,[n,null];case hl:return function({result:t},n,e){const r=n.data,i=mc(r),s=go(t)&&Oc(t.error),o=gc(r)&&Oc(r.error);return n.data=po(t)?lc(t.data):pc(r)?n.data:dc(t.error),s?[n,o?null:sc()]:i?[n,ce(e,"ready"),Jn(!0)]:[n,null]}(t,n,e);case vl:return function({collection:t,changes:n},e,r){return e.data=vc(e.data,(e=>(e[t]=Ps(e[t],n),e))),[e,null]}(t,n);case wl:return[n,Bn()];default:throw"Unmatched message"}}),(function({page:t,data:n}){if(gc(n))return Bc(n.error);if(!pc(n))return zc(t.current);const e=wc(n,{}),r=function({current:t,retiring:n}){t=Yc(t),n=n?Yc(n):{};const{isList:e,isDetails:r,isForm:i,isInvoice:s,isInvoiceForm:o}=t,c=i||s||o,a=n.isInvoice,u=n.isForm,l=n.isInvoiceForm;return{projectId:t.projectId,invoiceId:t.invoiceId||n.invoiceId,formProjectId:t.formProjectId||n.formProjectId,formInvoiceId:t.formInvoiceId||n.formInvoiceId,isDrawer:c,isList:e,isDetails:r,isInvoice:s,wasInvoice:a,isForm:i,wasForm:u,isInvoiceForm:o,wasInvoiceForm:l}}(t);return function({projects:t,invoices:n},e){const{projectId:r,invoiceId:i,formProjectId:s,formInvoiceId:o}=e;return r&&!On(t,{id:r})||i&&!On(n,{id:i,projectId:r})||s&&!On(t,{id:s})||o&&!On(n,{id:o,projectId:r})}(e,r)?Bc(new RangeError("NOT_FOUND")):function({projects:t}){return 0===t.length}(e)?function(t,{formProjectId:n,isForm:e,wasForm:r}){const i=zo(t,n);return Z({class:"viewport has-drawers grid is-one"},xc("Projects"),Gc(e,wl()),ut({class:"is-hidden"}),function(t){const n=ec("Add a project",yn());return ut({class:"view grid-main",classes:{"is-active":t}},xc("Projects"),nc({title:"There are no projects",message:"Create your first project with the button below.",action:n}))}(!e),Il(i,e,r))}(e,r):function(t,n){const e=function({clientAccounts:t,invoices:n,projects:e,tags:r,tasks:i}){const s=[],o=t=>t.id,c=t=>t.projectId,a=Ln(t,o),u=Ln(r,o),l=Rn(i,c),d=Rn(n,c);for(const{...t}of e)t.clientAccount=a[t.clientAccountId]||void 0,t.invoices=d[t.id]||[],t.tags=Vn(t.tagIds,(t=>u[t])),t.tasks=l[t.id]||[],s.push(t);return s.sort(qo)}(t),r=n.projectId||e[0].id,i=On(e,{id:r}),s=zo(t,n.formProjectId),o=function({invoices:t,projects:n},e){const r=On(t,{id:e});if(!r)return null;const i=On(n,{id:r.projectId});return{...r,project:i}}(t,n.invoiceId),c=function({invoices:t,projects:n},e,r){const i=On(n,{id:e});return{invoice:r?On(t,{id:r}):{},project:i}}(t,n.projectId,n.formInvoiceId);return Z({class:"viewport has-drawers grid is-two"},xc("Projects"),Gc(n.isDrawer,wl()),function(t,n,e){return ut({class:"view grid-sidebar",classes:{"is-active":e}},xc("Projects"),oa({projects:t,activeId:n}))}(e,r,n.isList),function(t,n){return ut({class:"view grid-main",classes:{"is-active":n}},Mc("Project",wl()),Fa({project:t}))}(i,n.isDetails),Il(s,n.isForm,n.wasForm),function(t,n,e){return n||e?ut({class:"view",classes:{"is-active":n}},Mc("Invoice",wl()),zu({invoice:t})):ut({class:"view"})}(o,n.isInvoice,n.wasInvoice),function(t,n,e){return n||e?ut({class:"view",classes:{"is-active":n}},Mc((t.invoice.id?"Edit":"New")+" invoice",wl()),rl(t)):ut({class:"view"})}(c,n.isInvoiceForm,n.wasInvoiceForm))}(e,r)}),(function(t,n){const e=[ae(n,"page",pl)];pc(t.data)&&(e.push([Qo,vl("projects")]),e.push(function(t){return[Xo,t]}(vl("invoices"))));return e}),{page:function(t){return Array.isArray(t)&&Hc.includes(t[0])}},{ready:!0}));const pl=t=>({tag:pl,page:t}),gl=()=>({tag:gl}),hl=t=>({tag:hl,result:t}),vl=t=>n=>({tag:vl,collection:t,changes:n}),wl=()=>({tag:wl});function Il(t,n,e){return n||e?ut({class:"view",classes:{"is-active":n}},Mc((t.project.id?"Edit":"New")+" project",wl()),Lu(t)):ut({class:"view"})}function yl(t){const n=!t.get("id"),e=function(t){const n={},e={};"id"in t&&(e.id=t.id),"username"in t&&(e.username=t.username),"email"in t&&(e.email=t.email),"isDisabled"in t&&(e.isDisabled=t.isDisabled),"firstName"in t&&(n.firstName=t.firstName),"lastName"in t&&(n.lastName=t.lastName),"isActive"in t&&(n.isActive=t.isActive),"status"in t&&(n.status=t.status),"notes"in t&&(n.notes=t.notes);for(const t in n){e.profile=n;break}return e}(t.prepare().changes);return n&&(e.role="admin"),e}function Al(t){return ji("users",t)}function bl(t={},n={}){return function(t={},n={}){return new Qi(jc,t).cast(n,[...yc,...Ac]).tap(Ec).require(yc).validate("firstName",zi({max:255})).validate("lastName",zi({max:255})).validate("username",zi({min:4,max:255})).validate("username",Hi(bc)).validate("email",zi({max:255})).validate("email",Hi(kc)).validate("status",zi({max:72})).validate("notes",zi({max:4096}))}(t,n)}async function kl(t={}){const n=bl({},t);if(!n.isValid)throw n;const e=yl(n),{user:r,errors:i}=await async function(t){return(await pi(di,{input:t})).createUser}(e);if(i)throw Es(n,Cc(i));return Di("users",r)}async function jl(t,n={}){const e=bl(t,n);if(!e.isValid)throw e;const r=e.get("id"),i=yl(e),{user:s,errors:o}=await async function(t,n){return(await pi(fi,{id:t,input:n})).updateUser}(r,i);if(o)throw Es(e,Cc(o));return Ei("users",r,s)}function Cl(t){return async function(t){return(await pi("\n  mutation ResetPassword($id: ID!) {\n    resetPassword(id: $id) {\n      user { id }\n    }\n  }\n  ",{id:t})).resetPassword.user.id}(t)}function Dl(t){return async function(t){return(await pi("\n  mutation ResetSession($id: ID!) {\n    resetSession(id: $id) {\n      user { id }\n    }\n  }\n  ",{id:t})).resetSession.user.id}(t)}async function El(t){return await async function(t){return(await pi(mi,{id:t})).deleteUser.user}(t),Ti("users",t)}async function Tl(t){const[n,e,r,i,s]=await Promise.all([(o=t,Ci("projects",o)),Js((t=>t.taskId)),Ns(),Os((n=>n.projectId===t)),Al()]);var o;return{project:n,invoices:e,tags:r,tasks:i,users:s}}async function Pl(t){return await ki(),Tl(t)}function Nl({project:t,tags:n,tasks:e,users:r},i){return{project:t,task:i?On(e,{id:i}):{},tags:n,users:r}}function $l(t,n){return Io([Tl,t],n)}function Fl(t,n){return Io([Pl,t],n)}function Ul(t,n,e){return Io(t.id?[Rs,t,n]:[Ls,n],e)}function Sl(t,n,e){return Io([Rs,t,n],e)}function xl(t,n){return Io([_s,t],n)}function Ml(t,n,e){return Pi("tasks",r=r=>{if(null===r)return e(n(null));(r=r.filter((n=>n.tombstone||n.projectId===t))).length>0&&e(n(r))}),()=>Ni("tasks",r);var r}function Ol(t,n,e){return Io(t.id?[Xs,t,n]:[Ks,n],e)}function Vl(t,n){return Io([to,t],n)}function Ll(t,n){return no((e=>{if(null===e)return n(t(null));(e=e.filter((t=>t.tombstone||t.taskId))).length>0&&n(t(e))}))}function Rl([t]){return io("AdminTasks"===t?".view.grid-sidebar":"AdminTask"===t?".view.grid-main":"")}function _l(t){return Z({class:"viewport"},Z({class:"view is-active"},xc("Tasks"),Vc(t)))}function ql([t]){return Z({class:"viewport grid is-two"},xc("Tasks"),ut({class:"view grid-sidebar",classes:{"is-active":"AdminTask"!==t}},xc("Tasks"),Lc()),function(t){return ut({class:"view grid-main",classes:{"is-active":t}},Mc("Task"),_c())}("AdminTask"===t))}const Wl=["AdminTasks","AdminTask","NewAdminTask","EditAdminTask","AdminTaskInvoice","NewAdminTaskInvoice","EditAdminTaskInvoice"];function Bl([t,{projectId:n,taskId:e,id:r,active:i}]){const s="AdminTask"===t,o="AdminTaskInvoice"===t,c="NewAdminTask"===t||"EditAdminTask"===t,a="NewAdminTaskInvoice"===t||"EditAdminTaskInvoice"===t;return{projectId:n,taskId:e=o||a?i||e:c?i||r:s?r:void 0,invoiceId:o?r:void 0,formTaskId:c?r:void 0,formInvoiceId:a?r:void 0,isList:"AdminTasks"===t,isDetails:s,isInvoice:o,isForm:c,isInvoiceForm:a}}const zl=se(O((function({tasks:t,activeId:n},e){return[{activeId:n,tasks:t,itemWithMenu:null},null]}),(function(t,n,e){switch(t.tag){case Gl:return n.tasks=t.tasks,[n,null];case Hl:return n.activeId=t.id,[n,null];case Yl:return function({id:t,status:n},e,r){const i=On(e.tasks,{id:t});return i?[e,Sl(i,{status:n},Jl)]:[e,null]}(t,n);case Jl:return function({result:t},n,e){return go(t)?[n,Xn({type:"danger",message:"An error occured and the changes couldn’t be saved. Please try again."})]:[n,null]}(t,n);case Ql:return[n,xl(t.id,Zl)];case Zl:return function({result:t},n,e){if(go(t))return[n,Xn({type:"danger",message:"An error occured and the task couldn’t be deleted. Please try again."})];const{projectId:r,id:i}=vo(t,null);return i===n.activeId?[n,Wn(Dn(r))]:[n,null]}(t,n);case Kl:return n.itemWithMenu=n.itemWithMenu!==t.id?t.id:null,[n,null];case Xl:return n.itemWithMenu=null,[n,null];default:throw"Unmatched message"}}),(function({tasks:t,activeId:n,itemWithMenu:e}){return J("ul",{class:"list"},...t.map((t=>[t.id,td(t,n,e)])))}),(function({itemWithMenu:t},n){const e=[ae(n,"tasks",Gl),ae(n,"activeId",Hl)];t&&e.push(oo(Xl(),{capture:!0}));return e}),{tasks:Array.isArray,activeId:_n},{}));const Gl=t=>({tag:Gl,tasks:t}),Hl=t=>({tag:Hl,id:t}),Yl=(t,n)=>({tag:Yl,id:t,status:n}),Jl=t=>({tag:Jl,result:t}),Ql=t=>({tag:Ql,id:t}),Zl=t=>({tag:Zl,result:t}),Kl=t=>({tag:Kl,id:t}),Xl=()=>({tag:Xl});function td(t,n,e){const{id:r,projectId:i,status:s}=t;return nt({id:r,classes:{"list-item":!0,"is-active":r===n}},function(t,n,e,r,i){return Jc(i,Kl(t),nt({},function(t,n){return"COMPLETED"===n?Pe({onClick:Ft(Yl(t,"IN_PROGRESS"))},"Mark as in progress"):Pe({onClick:Ft(Yl(t,"COMPLETED"))},"Mark as completed")}(t,r)),nt({},Pe({to:Pn(n,t,{active:e})},"Edit task")),nt({},Pe({onClick:Ft(Ql(t))},"Delete task")))}(r,i,n,s,r===e),Pe({to:Tn(i,r),class:"list-item-face"},function({name:t,tags:n,project:e}){return at({class:"list-item-header"},Qc(n||[]),ft({class:"title has-subtitle is-truncated"},t),mt({class:"subtitle is-truncated"},function({id:t,name:n}){return Ne({to:An(t)},K({},n))}(e)))}(t),function({status:t,deadline:n,user:e,invoices:r}){return Z({class:"list-item-status"},"COMPLETED"===t?Kc(t):n&&Xc(n),e&&Pc(e,!0),K({styles:{margin:"0","margin-left":"auto"}}),ra(r))}(t)))}const nd=se(O((function({task:t,invoices:n},e){return[{task:t,invoices:ed(t,n),itemWithMenu:null},null]}),(function(t,n,e){switch(t.tag){case rd:return n.invoices=ed(n.task,t.invoices),[n,null];case id:return[n,Vl(t.id,sd)];case sd:return function({result:t},n,e){return go(t)?[n,Xn({type:"danger",message:"An error occured and the invoice couldn’t be deleted. Please try again."})]:[n,null]}(t,n);case od:return n.itemWithMenu=n.itemWithMenu!==t.id?t.id:null,[n,null];case cd:return n.itemWithMenu=null,[n,null];case ad:return[n,Wn(t.path)];default:throw"Unmatched message"}}),(function({invoices:t,itemWithMenu:n}){return jt({class:"invoice-table table is-fullwidth"},Ct({},Tt({},Pt({},"Status"),Pt({},"Due date"),Pt({},"Payment"),Pt({}))),J("tbody",{},...t.map((t=>[t.id,ud(t,n)]))),Et({},Tt({},Pt({}),Pt({}),Pt({},"Total: ",ba(function(t){return t.reduce(((t,n)=>t+Number(n.total)),0)}(t))),Pt({}))))}),(function({itemWithMenu:t},n){const e=[ae(n,"invoices",rd)];t&&e.push(oo(cd(),{capture:!0}));return e}),{task:wa,invoices:Array.isArray},{}));function ed(t,n){return n.map((n=>({...n,task:t}))).sort(((t,n)=>Date.parse(t.dueDate)-Date.parse(n.dueDate)))}const rd=t=>({tag:rd,invoices:t}),id=t=>({tag:id,id:t}),sd=t=>({tag:sd,result:t}),od=t=>({tag:od,id:t}),cd=()=>({tag:cd}),ad=t=>({tag:ad,path:t});function ud(t,n){const{task:{projectId:e},taskId:r,id:i}=t,s=$n(e,r,i),o={onClick:Ft(ad(s))};return Tt({},Nt(o,ea(t)),Nt(o,na(t)),Nt(o,ba(t.total)),Nt({},function({task:{projectId:t},taskId:n,id:e},r){return Jc(r,od(e),nt({},Pe({to:$n(t,n,e)},"View invoice")),nt({},Pe({to:Fn(t,n,e)},"Edit invoice")),nt({},Pe({onClick:Ft(id(e))},"Delete invoice")))}(t,i===n)))}const ld=se(O((function({task:t},n){return[{task:t,menu:!1},null]}),(function(t,n,e){switch(t.tag){case dd:return n.task=t.task,[n,null];case fd:return function({status:t},n,e){return[n,Sl(n.task,{status:t},md)]}(t,n);case md:return function({result:t},n,e){return go(t)?[n,Xn({type:"danger",message:"An error occured and the changes couldn’t be saved. Please try again."})]:[n,null]}(t,n);case pd:return[n,xl(n.task.id,gd)];case gd:return function({result:t},n,e){if(go(t))return[n,Xn({type:"danger",message:"An error occured and the task couldn’t be deleted. Please try again."})];const{projectId:r}=vo(t,null);return[n,Wn(Dn(r))]}(t,n);case hd:return n.menu=!n.menu,[n,null];case vd:return n.menu=!1,[n,null];default:throw"Unmatched message"}}),(function({task:t,menu:n}){return Z({class:"task"},function(t,n){return at({class:"task-header"},function({projectId:t,id:n,status:e},r){return Jc(r,hd(),nt({},function(t){return"COMPLETED"===t?Pe({onClick:Ft(fd("IN_PROGRESS"))},"Mark as in progress"):Pe({onClick:Ft(fd("COMPLETED"))},"Mark as completed")}(e)),nt({},Pe({to:Nn(t,n)},"Add invoice")),nt({},Pe({to:Pn(t,n)},"Edit task")),nt({},Pe({onClick:Ft(pd())},"Delete task")))}(t,n),Qc(t.tags||[]),lt({class:"title has-subtitle"},t.name),dt({class:"subtitle"},function({id:t,name:n}){return Ne({to:An(t)},K({},n))}(t.project)),function({status:t,deadline:n,catTool:e,user:r}){const i="COMPLETED"===t,s=i?null:"auto";return Z({class:"task-status"},i&&Kc(t),n&&Xc(n,s,!0),e&&K({class:"tag"},e),r&&Pc(r))}(t))}(t,n),function(t){const{projectId:n,id:e,invoices:r}=t;return ut({class:"task-section task-invoices"},dt({class:"title"},"Invoices"),0!==r.length?nd({task:t,invoices:r}):null,ec("Add invoice",Nn(n,e)))}(t),t.notes&&function({notes:t}){return ut({class:"task-section"},dt({class:"title"},"Notes"),...Lo(t))}(t))}),(function({menu:t},n){const e=[ae(n,"task",dd)];t&&e.push(oo(vd(),{capture:!0}));return e}),{task:wa},{}));const dd=t=>({tag:dd,task:t}),fd=t=>({tag:fd,status:t}),md=t=>({tag:md,result:t}),pd=()=>({tag:pd}),gd=t=>({tag:gd,result:t}),hd=()=>({tag:hd}),vd=()=>({tag:vd});function wd(t,n,e,r){const i=r.map((t=>[t.id,t.name])),s=t.deadline&&new Date(t.deadline);return new Tu({projectId:t.projectId||n.id,userId:Id(t.userId,e),tagIds:$u("tagIds",t.tagIds,{options:i}),name:$u("name",t.name),catTool:$u("catTool",t.catTool),date:$u("date",os(s)),time:$u("time",cs(s)),notes:$u("notes",t.notes)})}function Id(t,n){const e=n.filter((n=>!n.isDisabled||n.id===t)).map((t=>[t.id,yd(t)]));return $u("userId",t,{placeholder:"Select a user...",options:e})}function yd({profile:{firstName:t,lastName:n,status:e}}){return`${t} ${n}${e?"*":""}`}const Ad=se(O((function({task:t,project:n,users:e,tags:r},i){return[{task:t,project:n,users:e,tags:r,form:wd(t,n,e,r),isDisabled:!1},null]}),(function(t,n,e){switch(t.tag){case bd:return function({task:t},n,e){const{project:r,users:i,tags:s}=n;return n.task=t,n.form=wd(t,r,i,s),[n,null]}(t,n);case kd:return function({name:t,value:n},e,r){const i=e.form.setValue(t,n),s=Vs(e.task,i.getValues());return e.form=Fu(i,s,!0),[e,null]}(t,n);case jd:return function(t,n,e){const r=n.form.getValues(),i=Vs(n.task,r);if(!i.isValid)return n.form=Fu(n.form,i,!1),[n,null];return n.isDisabled=!0,[n,Jn(!1),Ul(n.task,r,Cd)]}(0,n);case Cd:return function({result:t},n,e){if(go(t))return function(t,n,e){if(n.isDisabled=!1,t instanceof Qi)return n.form=Fu(n.form,t,!1),[n,Jn(!0)];return[n,Jn(!0),Xn({type:"danger",message:"An error occured and the changes couldn’t be saved. Please try again."})]}(t.error,n);const{projectId:r,id:i}=vo(t,null),s=Tn(r,i);return[n,Jn(!0),qn(s)]}(t,n);default:throw"Unmatched message"}}),(function({task:t,isDisabled:n,form:e}){return ht({class:"form task-form",onSubmit:xt(jd())},vt({disabled:n},Dd(e,"name","Name",eu),Dd(e,"userId","Responsible",uu()),Dd(e,"tagIds","Tags",lu()),Dd(e,"catTool","CAT tool",eu),Dd(e,"date","Due date",cu),Dd(e,"time","Due time",au),Dd(e,"notes","Notes",ru)),kt({type:"submit",class:"button is-primary",disabled:n},t.id?"Save task":"Add task"))}),(function(t,n){return[ae(n,"task",bd)]}),{task:wa,project:wa,users:Array.isArray,tags:Array.isArray},{}));const bd=t=>({tag:bd,task:t}),kd=t=>n=>({tag:kd,name:t,value:n}),jd=()=>({tag:jd}),Cd=t=>({tag:Cd,result:t});function Dd(t,n,e,r){const{value:i,errors:s,props:o}=t.get(n);return tu(e,r(i,kd(n),o),s.join(", "))}const Ed=se(O((function({invoice:t},n){return[{invoice:t,menu:!1},null]}),(function(t,n,e){switch(t.tag){case Td:return n.invoice=t.invoice,[n,null];case Pd:return[n,Vl(n.invoice.id,Nd)];case Nd:return function({result:t},n,e){if(go(t))return[n,Xn({type:"danger",message:"An error occured and the invoice couldn’t be deleted. Please try again."})];const r=vo(t,{}).taskId;return[n,Wn(Tn(r))]}(t,n);case $d:return n.menu=!n.menu,[n,null];case Fd:return n.menu=!1,[n,null];default:throw"Unmatched message"}}),(function({invoice:t,menu:n}){return Z({class:"invoice"},function(t,n){return at({class:"invoice-header"},function({task:{projectId:t},taskId:n,id:e},r){return Jc(r,$d(),nt({},Pe({to:Fn(t,n,e)},"Edit invoice")),nt({},Pe({onClick:Ft(Pd())},"Delete invoice")))}(t,n),lt({class:"title has-subtitle"},ba(t.total)),dt({class:"subtitle"},function({projectId:t,id:n,name:e}){return Ne({to:Tn(t,n)},K({},e))}(t.task)),function(t){return Z({class:"invoice-status"},na(t),ea(t,!0))}(t))}(t,n),function(t){return ut({class:"invoice-section"},dt({class:"title"},"Detail"),function({items:t,total:n}){return Z({class:"table-containter"},jt({class:"invoice-items-table table is-fullwidth"},Ct({},Tt({},Pt({},"Description"),Pt({},"Quantity"),Pt({},"Price"))),Dt({},...t.map(Ud)),Et({},Tt({},Pt({}),Pt({},"Total"),Pt({},ba(n))))))}(t))}(t),function({notes:t}){return t?ut({class:"invoice-section"},dt({class:"title"},"Notes"),...Lo(t)):null}(t))}),(function({menu:t},n){const e=[ae(n,"invoice",Td)];t&&e.push(oo(Fd(),{capture:!0}));return e}),{invoice:wa},{}));const Td=t=>({tag:Td,invoice:t}),Pd=()=>({tag:Pd}),Nd=t=>({tag:Nd,result:t}),$d=()=>({tag:$d}),Fd=()=>({tag:Fd});function Ud({description:t,quantity:n,price:e}){return Tt({},Nt({},t),Nt({},Aa(n)),Nt({},ba(e)))}function Sd(t,n){const e={disabled:!0,options:[[n.id,n.name]]};return new Tu({taskId:$u("taskId",n.id,e),dueDate:$u("dueDate",xd(t.dueDate)),sentAt:$u("sentAt",xd(t.sentAt)),receivedAt:$u("receivedAt",xd(t.receivedAt)),paidAt:$u("paidAt",xd(t.paidAt)),items:(r=t.items,r&&r.length>0?r:[{}]).map(Md),notes:$u("notes",t.notes)});var r}function xd(t){return t?os(new Date(t)):""}function Md({id:t,description:n,quantity:e,price:r}){const i={id:t,description:$u("description",n),quantity:$u("quantity",e),price:$u("price",r)};return new Tu(i,{key:t||Od()})}const Od=(()=>{let t=0;return()=>String(t++)})();function Vd({items:t}){return t.reduce(((t,n)=>t+function(t){const n=Number(t.getValue("quantity")),e=Number(t.getValue("price"));return Number.isNaN(n)||Number.isNaN(e)?0:n*e}(n)),0)}const Ld=se(O((function({invoice:t,task:n},e){return[{invoice:t,task:n,form:Sd(t,n),isDisabled:!1},null]}),(function(t,n,e){switch(t.tag){case Rd:return function({invoice:t},n,e){return n.invoice=t,n.form=Sd(t,n.task),[n,null]}(t,n);case _d:return function({name:t,value:n},e,r){const i=e.form.setValue(t,n),s=Qs(e.invoice,i.getValues());return e.form=Fu(i,s,!0),[e,null]}(t,n);case qd:return function(t,n,e){return n.form=function(t,n={}){return t.items.push(Md(n)),t}(n.form),[n,null]}(0,n);case Wd:return function({index:t},n,e){return n.form=function(t,n){return t.items.splice(n,1),t}(n.form,t),[n,null]}(t,n);case Bd:return function(t,n,e){const r=n.form.getValues(),i=Qs(n.invoice,r);if(!i.isValid)return n.form=Fu(n.form,i,!1),[n,null];return n.form.isDisabled=!0,[n,Jn(!1),Ol(n.invoice,r,zd)]}(0,n);case zd:return function({result:t},n,e){if(go(t))return function(t,n,e){if(n.isDisabled=!1,t instanceof Qi)return n.form=Fu(n.form,t,!1),[n,Jn(!0)];return[n,Jn(!0),Xn({type:"danger",message:"An error occured and the changes couldn’t be saved. Please try again."})]}(t.error,n);const{id:r,taskId:i}=vo(t,null),s=n.task.projectId;return[n,Jn(!0),qn($n(s,i,r))]}(t,n);default:throw"Unmatched message"}}),(function({invoice:t,isDisabled:n,form:e}){return ht({class:"form invoice-form",onSubmit:xt(Bd())},vt({disabled:n},Gd(e,"taskId","Task",uu()),Gd(e,"dueDate","Due date",cu),Gd(e,"sentAt","Sent on",cu),Gd(e,"receivedAt","Received on",cu),Gd(e,"paidAt","Paid on",cu),function(t){const n=t.items,e=n.length>1;return Z({class:"invoice-form-items"},Z({class:"invoice-form-items-header"},wt({class:"label"},"Description"),wt({class:"label"},"Quantity"),wt({class:"label"},"Price")),J("div",{class:"invoice-form-items-list"},...n.map(((t,n)=>[t.getMeta("key"),Hd(t,n,e)]))),Z({class:"invoice-form-items-footer"},kt({class:"button is-link",onClick:Ft(qd())},"Add item +"),gt({},`Total: ${ba(Vd(t))}`)))}(e),Gd(e,"notes","Notes",ru)),kt({type:"submit",class:"button is-primary",disabled:n},t.id?"Save invoice":"Add invoice"))}),(function(t,n){return[ae(n,"invoice",Rd)]}),{invoice:wa,task:wa},{}));const Rd=t=>({tag:Rd,invoice:t}),_d=t=>n=>({tag:_d,name:t,value:n}),qd=()=>({tag:qd}),Wd=t=>({tag:Wd,index:t}),Bd=()=>({tag:Bd}),zd=t=>({tag:zd,result:t});function Gd(t,n,e,r){const{value:i,errors:s,props:o}=t.get(n);return tu(e,r(i,_d(n),o),s.join(", "))}function Hd(t,n,e=!0){return vt({class:"invoice-form-item"},Z({class:"invoice-form-item-header"},wt({class:"label"},`Item #${n+1}`),function(t,n=!1){return X({disabled:n,class:"button is-close is-light",title:"Remove item",onClick:!n&&Ft(t)})}(Wd(n),!e)),Z({class:"invoice-form-item-controls"},Yd(n,t.description,"Description",eu),Yd(n,t.quantity,"Quantity",iu),Yd(n,t.price,"Price",iu)),function({description:t,quantity:n,price:e}){const r=[...t.errors.map((t=>`description ${t}`)),...n.errors.map((t=>`quantity ${t}`)),...e.errors.map((t=>`price ${t}`))];return 0===r.length?null:pt({class:"help is-error"},r.join(", "))}(t))}function Yd(t,{name:n,value:e,isValid:r,props:i},s,o){return Z({classes:{field:!0,"has-error":!r}},Z({class:"control"},o(e,_d(`items[${t}].${n}`),{...i,placeholder:s})))}const Jd=se(O(Qd,(function(t,n,e){switch(t.tag){case Zd:return function({page:t},n,e){const r=n.page.current,i=t[1].projectId,s=r[1].projectId;return i!==s?Qd({page:t}):(n.page={current:t,retiring:r},[n,Rl(t),de(300,Kd())])}(t,n);case Kd:return n.page.retiring=null,[n,null];case Xd:return function({result:t},n,e){const r=n.data,i=mc(r),s=go(t)&&Oc(t.error),o=gc(r)&&Oc(r.error);return n.data=po(t)?lc(t.data):pc(r)?n.data:dc(t.error),s?[n,o?null:sc()]:i?[n,ce(e,"ready"),Jn(!0)]:[n,null]}(t,n,e);case tf:return function({collection:t,changes:n},e,r){return e.data=vc(e.data,(e=>(e[t]=Ps(e[t],n),e))),[e,null]}(t,n);case nf:return[n,Bn()];default:throw"Unmatched message"}}),(function({page:t,data:n}){if(gc(n))return _l(n.error);if(!pc(n))return ql(t.current);const e=wc(n,{}),r=function({current:t,retiring:n}){t=Bl(t),n=n?Bl(n):{};const{isList:e,isDetails:r,isForm:i,isInvoice:s,isInvoiceForm:o}=t,c=i||s||o,a=n.isInvoice,u=n.isForm,l=n.isInvoiceForm,{projectId:d,taskId:f}=t;return{projectId:d,taskId:f,invoiceId:t.invoiceId||n.invoiceId,formTaskId:t.formTaskId||n.formTaskId,formInvoiceId:t.formInvoiceId||n.formInvoiceId,isDrawer:c,isList:e,isDetails:r,isInvoice:s,wasInvoice:a,isForm:i,wasForm:u,isInvoiceForm:o,wasInvoiceForm:l}}(t);return function({tasks:t,invoices:n},e){const{projectId:r,taskId:i,invoiceId:s,formTaskId:o,formInvoiceId:c}=e;return i&&!On(t,{id:i,projectId:r})||s&&!On(n,{id:s,taskId:i})||o&&!On(t,{id:o,projectId:r})||c&&!On(n,{id:c,taskId:i})}(e,r)?_l(new RangeError("NOT_FOUND")):function({tasks:t}){return 0===t.length}(e)?function(t,{projectId:n,formTaskId:e,isForm:r,wasForm:i}){const s=Nl(t,e);return Z({class:"viewport has-drawers grid is-one"},xc("Tasks"),Gc(r,nf()),ut({class:"is-hidden"}),function(t,n){const e=ec("Add a task",En(t));return ut({class:"view grid-main",classes:{"is-active":n}},xc("Tasks"),nc({title:"There are no tasks",message:"Create a task with the button below.",action:e}))}(n,!r),ef(s,r,i))}(e,r):function(t,n){const e=function({project:t,invoices:n,tags:e,tasks:r,users:i}){const s=[],o=t=>t.id,c=t.id,a=Ln(e,o),u=Ln(i,o),l=Rn(n,(t=>t.taskId));for(const{...n}of r)n.projectId===c&&(n.project=t,n.invoices=l[n.id]||[],n.tags=Vn(n.tagIds,(t=>a[t])),n.user=u[n.userId]||void 0,s.push(n));return s.sort(qo)}(t),r=n.taskId||e[0].id,i=On(e,{id:r}),s=Nl(t,n.formTaskId),o=function({invoices:t,tasks:n},e){const r=On(t,{id:e});if(!r)return null;const i=On(n,{id:r.taskId});return{...r,task:i}}(t,n.invoiceId),c=function({invoices:t,tasks:n},e,r){const i=On(n,{id:e});return{invoice:r?On(t,{id:r}):{},task:i}}(t,n.taskId,n.formInvoiceId);return Z({class:"viewport has-drawers grid is-two"},xc("Tasks"),Gc(n.isDrawer,nf()),function(t,n,e){return ut({class:"view grid-sidebar",classes:{"is-active":e}},xc("Tasks"),zl({tasks:t,activeId:n}))}(e,r,n.isList),function(t,n){return ut({class:"view grid-main",classes:{"is-active":n}},Mc("Task",nf()),ld({task:t}))}(i,n.isDetails),ef(s,n.isForm,n.wasForm),function(t,n,e){return n||e?ut({class:"view",classes:{"is-active":n}},Mc("Invoice",nf()),Ed({invoice:t})):ut({class:"view"})}(o,n.isInvoice,n.wasInvoice),function(t,n,e){return n||e?ut({class:"view",classes:{"is-active":n}},Mc((t.invoice.id?"Edit":"New")+" invoice",nf()),Ld(t)):ut({class:"view"})}(c,n.isInvoiceForm,n.wasInvoiceForm))}(e,r)}),(function(t,n){const e=[ae(n,"page",Zd)];if(pc(t.data)){const{project:n}=wc(t.data,{});e.push((r=n.id,i=tf("tasks"),[Ml,r,i])),e.push(function(t){return[Ll,t]}(tf("invoices")))}var r,i;return e}),{page:function(t){return Array.isArray(t)&&Wl.includes(t[0])}},{ready:!0}));function Qd({page:t},n){const e=t[1].projectId;return[{page:{current:t,retiring:null},data:uc()},...[Jn(!1),$l(e,Xd),Fl(e,Xd)]]}const Zd=t=>({tag:Zd,page:t}),Kd=()=>({tag:Kd}),Xd=t=>({tag:Xd,result:t}),tf=t=>n=>({tag:tf,collection:t,changes:n}),nf=()=>({tag:nf});function ef(t,n,e){return n||e?ut({class:"view",classes:{"is-active":n}},Mc((t.task.id?"Edit":"New")+" task",nf()),Ad(t)):ut({class:"view"})}async function rf(){const t=await Fr();if(!t.user)throw new Error("UNAUTHORIZED");return{currentUser:t.user,users:await Al()}}async function sf(){return await ki(),rf()}function of({users:t},n){return{user:n?On(t,{id:n}):{}}}function cf(t,n){return Ro(Dc(t),Dc(n))}function af(t){return Io([sf],t)}function uf(t,n,e){return Io(t.id?[jl,t,n]:[kl,n],e)}function lf(t,n,e){return Io([jl,t,n],e)}function df(t,n){return Io([Cl,t],n)}function ff(t,n){return Io([El,t],n)}function mf(t,n){return Pi("users",e=e=>n(t(e))),()=>Ni("users",e);var e}function pf([t]){return io("AdminUsers"===t?".view.grid-sidebar":"AdminUser"===t?".view.grid-main":"")}function gf(t){return Z({class:"viewport"},Z({class:"view is-active"},xc("Users"),Vc(t)))}function hf([t]){return Z({class:"viewport grid is-two"},xc("Users"),ut({class:"view grid-sidebar",classes:{"is-active":"AdminUser"!==t}},xc("Users"),qc()),function(t){return ut({class:"view grid-main",classes:{"is-active":t}},Mc("User"),_c())}("AdminUser"===t))}const vf=["AdminUsers","AdminUser","NewAdminUser","EditAdminUser"];function wf([t,{id:n,active:e}]){const r="AdminUser"===t,i="NewAdminUser"===t||"EditAdminUser"===t;return{userId:i?e||n:r?n:void 0,formUserId:i?n:void 0,isList:"AdminUsers"===t,isDetails:r,isForm:i}}function If(t,n,e){const r=[];let i,s=[];for(const o of t){const t=n(o);t!==i&&(i=t,s=[],r.push([i,s])),s.push(e(o))}return r}function yf(t,n,e){const r=t.map((([t,n])=>t));return Z({class:"directory"},function(t,n){return tt({class:"directory-list"},...t.map((t=>function([t,n],e){const r="directory-group-"+t.toLowerCase();return nt({id:r,class:"directory-group"},K({class:"directory-group-label"},t),tt({class:"directory-list"},...n.map((t=>function({label:t,path:n},e){return nt({classes:{"directory-item":!0,"is-active":e}},Pe({to:n,class:"directory-item-face"},t))}(t,e(t))))))}(t,n))))}(t,n),function(t,n){return ct({class:"directory-index"},tt({class:"directory-index-list"},...t.map((t=>function(t,n){const e="directory-group-"+t.toLowerCase();return nt({class:"directory-index-item"},X({class:"directory-index-item-face",onClick:Ft(n(e))},t))}(t,n)))))}(r,e))}const Af=se(O((function({users:t,activeId:n},e){return[{activeId:n,groups:Cf(t)},null]}),(function(t,n){switch(t.tag){case bf:return n.groups=Cf(t.users),[n,null];case kf:return n.activeId=t.id,[n,null];case jf:return[n,so(t.nodeId)];default:throw"Unmatched message"}}),(function({groups:t,activeId:n}){return yf(t,(t=>t.id===n),jf)}),(function(t,n){return[ae(n,"users",bf),ae(n,"activeId",kf)]}),{users:Array.isArray,activeId:_n},{}));const bf=t=>({tag:bf,users:t}),kf=t=>({tag:kf,id:t}),jf=t=>({tag:jf,nodeId:t});function Cf(t){return If(t,Df,Ef)}function Df(t){return Dc(t)[0].toUpperCase()}function Ef(t){return{id:t.id,label:Dc(t),path:xn(t.id)}}const Tf=se(O((function({currentUser:t,user:n},e){return[{currentUser:t,user:n,menu:!1},null]}),(function(t,n,e){switch(t.tag){case Pf:return n.currentUser=t.user,[n,null];case Nf:return n.user=t.user,[n,null];case $f:return[n,(r=n.user.id,i=Ff,Io([Dl,r],i))];case Ff:return function({result:t},n,e){const r=po(t)?{type:"success",message:"Success, all user sessions have been closed."}:{type:"danger",message:"An error occured, please try again."};return[n,Xn(r)]}(t,n);case Uf:return[n,df(n.user.id,Sf)];case Sf:return function({result:t},n,e){const r=po(t)?{type:"success",message:"Success, a new password was generated."}:{type:"danger",message:"An error occured, please try again."};return[n,Xn(r)]}(t,n);case xf:return function(t,n,e){const r=Cc(n.user),i={isDisabled:!r.isDisabled};return[n,lf(r,i,Mf)]}(0,n);case Mf:return function({result:t},n,e){return go(t)?[n,Xn({type:"danger",message:"An error occured and the changes couldn’t be saved. Please try again."})]:[n,null]}(t,n);case Of:return[n,ff(n.user.id,Vf)];case Vf:return function({result:t},n,e){return go(t)?[n,Xn({type:"danger",message:"An error occured and the user couldn’t be deleted. Please try again."})]:[n,Wn(Un())]}(t,n);case Lf:return n.menu=!n.menu,[n,null];case Rf:return n.menu=!1,[n,null];default:throw"Unmatched message"}var r,i}),(function({currentUser:t,user:n,menu:e}){const r=n.id===t.id,{details:i,notes:s}=n.profile;return Z({class:"user"},function(t,n){return at({class:"user-header"},function(t,n){return Jc(n,Lf(),nt({},Pe({to:Mn(t.id)},"Edit user")))}(t,n),lt({class:"title has-subtitle"},Dc(t)),dt({class:"subtitle"},(e=t.email,Ne({href:`mailto:${e}`},K({},e)))),function({isDisabled:t,profile:n}){return Z({class:"project-status"},function(t){return K({class:"tag "+(t?"is-danger":"is-success")},t?"Disabled":"Enabled")}(t),!t&&function({isActive:t,status:n}){const e=t?n?"is-info":"is-success":"is-danger";if(!n){return Z({class:"tag "+e},t?"Active":"Inactive")}return Z({class:"tag "+e},K({class:"tag-label"},"Status:"),K({class:"tag-value"},n))}(n))}(t));var e}(n,e),i&&i.length&&function(t){return ut({class:"user-section"},dt({class:"title"},"Details"),et({class:"user-details-list"},...t.map(_f)))}(i),s&&function(t){return ut({class:"user-section"},dt({class:"title"},"Notes"),...Lo(t))}(s),!r&&function({isDisabled:t}){return ut({class:"user-section"},dt({class:"title"},"User account"),function(){const t="Close all currently active sessions for this user (all devices). This will force the user to login again with username/email and password across all their devices.";return Z({class:"user-account-item"},ft({class:"user-account-item-title"},"Reset sessions"),pt({},t),kt({class:"button is-primary",onClick:Ft($f())},"Close all user sessions"))}(),t?Z({class:"user-account-item"},ft({class:"user-account-item-title"},"Enable account"),pt({},gt({},"This user account is disabled.")," Enable it to allow the user to login and access the platform again."),kt({class:"button is-primary",onClick:Ft(xf())},"Enable user account")):function(){const t="Block this user’s account: No data will be deleted, but the user won’t be able to login until an administrator enables the account again.";return Z({class:"user-account-item"},ft({class:"user-account-item-title"},"Disable account"),pt({},t),kt({class:"button is-primary",onClick:Ft(xf())},"Disable user account"))}(),Z({class:"user-account-item"},ft({class:"user-account-item-title"},"Reset password"),pt({class:"callout is-danger"},"This operation is irreversible!"),pt({},"Set a new random password for this user account."),kt({class:"button is-danger",onClick:Ft(Uf())},"Reset user password")),function(){const t="There must be no tasks assigned (old or new) to this user in order to successfully delete this account.";return Z({class:"user-account-item"},ft({class:"user-account-item-title"},"Delete account"),pt({class:"callout is-danger"},"This operation is irreversible!"),pt({class:"callout is-info"},t),pt({},"Permanently delete this user account and profile data."),kt({class:"button is-danger",onClick:Ft(Of())},"Permanently delete user and all related data"))}())}(n))}),(function({menu:t},n){const e=[ae(n,"currentUser",Pf),ae(n,"user",Nf)];t&&e.push(oo(Rf(),{capture:!0}));return e}),{currentUser:wa,user:wa},{}));const Pf=t=>({tag:Pf,user:t}),Nf=t=>({tag:Nf,user:t}),$f=()=>({tag:$f}),Ff=t=>({tag:Ff,result:t}),Uf=()=>({tag:Uf}),Sf=t=>({tag:Sf,result:t}),xf=()=>({tag:xf}),Mf=t=>({tag:Mf,result:t}),Of=()=>({tag:Of}),Vf=t=>({tag:Vf,result:t}),Lf=()=>({tag:Lf}),Rf=()=>({tag:Rf});function _f({name:t,value:n}){return Z({class:"user-details-item"},rt({},t),it({},n))}function qf(t){const n=t.profile||{};return new Tu({firstName:$u("firstName",n.firstName),lastName:$u("lastName",n.lastName),username:$u("username",t.username),email:$u("email",t.email),isActive:$u("isActive",n.isActive),status:$u("status",n.status),notes:$u("notes",n.notes)})}const Wf=se(O((function({user:t},n){return[{user:Cc(t),form:qf(t),isDisabled:!1},null]}),(function(t,n,e){switch(t.tag){case Bf:return function({user:t},n,e){return n.user=Cc(t),n.form=qf(t),[n,null]}(t,n);case zf:return function({name:t,value:n},e,r){const i=e.form.setValue(t,n),s=bl(e.user,i.getValues());return e.form=Fu(i,s,!0),[e,null]}(t,n);case Gf:return function(t,n,e){const r=n.form.getValues(),i=bl(n.user,r);if(!i.isValid)return n.form=Fu(n.form,i,!1),[n,null];return n.isDisabled=!0,[n,Jn(!1),uf(n.user,r,Hf)]}(0,n);case Hf:return function({result:t},n,e){if(go(t))return function(t,n,e){if(n.isDisabled=!1,t instanceof Qi)return n.form=Fu(n.form,t,!1),[n,Jn(!0)];return[n,Jn(!0),Xn({type:"danger",message:"An error occured and the changes couldn’t be saved. Please try again."})]}(t.error,n);const{id:r}=vo(t,null);return[n,Jn(!0),qn(xn(r))]}(t,n);default:throw"Unmatched message"}}),(function({user:t,isDisabled:n,form:e}){return ht({class:"form user-form",onSubmit:xt(Gf())},vt({disabled:n},Yf(e,"firstName","First name",eu),Yf(e,"lastName","Last name",eu),Yf(e,"username","Username",eu),Yf(e,"email","Email",eu),function(t){const n=t.get("isActive"),e=t.get("status"),r=e.errors.join(", ");return Z({classes:{field:!0,"has-error":!!r}},wt({class:"label"},"Status"),Z({class:"control"},function({value:t}){return wt({class:"checkbox"},function(t,n,e={}){return It({...e,checked:t,type:"checkbox",class:nu("checkbox",e.class),onChange:n&&(r=n,(t,n)=>n(r(t.target.checked)))});var r}(t,zf("isActive"))," Is active?")}(n),function({value:t}){return eu(t,zf("status"),{placeholder:"Status message..."})}(e)),r&&pt({class:"help is-error"},r))}(e),Yf(e,"notes","Notes",ru)),kt({type:"submit",class:"button is-primary",disabled:n},t.id?"Save user":"Add user"))}),(function(t,n){return[ae(n,"user",Bf)]}),{user:wa},{}));const Bf=t=>({tag:Bf,user:t}),zf=t=>n=>({tag:zf,name:t,value:n}),Gf=()=>({tag:Gf}),Hf=t=>({tag:Hf,result:t});function Yf(t,n,e,r){const{value:i,errors:s,props:o}=t.get(n);return tu(e,r(i,zf(n),o),s.join(", "))}const Jf=se(O((function({page:t},n){const e={page:{current:t,retiring:null},data:uc()},r=[Jn(!1),(i=Kf,Io([rf],i)),af(Kf)];var i;return[e,...r]}),(function(t,n,e){switch(t.tag){case Qf:return n.page={current:t.page,retiring:n.page.current},[n,pf(t.page),de(300,Zf())];case Zf:return n.page.retiring=null,[n,null];case Kf:return function({result:t},n,e){const r=n.data,i=mc(r),s=go(t)&&Oc(t.error),o=gc(r)&&Oc(r.error);return n.data=po(t)?lc(t.data):pc(r)?n.data:dc(t.error),s?[n,o?null:sc()]:i?[n,ce(e,"ready"),Jn(!0)]:[n,null]}(t,n,e);case Xf:return function({changes:t},n,e){return n.data=vc(n.data,(n=>(n.users=Ps(n.users,t),n))),[n,null]}(t,n);case tm:return[n,Bn()];default:throw"Unmatched message"}}),(function({page:t,data:n}){if(gc(n))return gf(n.error);if(!pc(n))return hf(t.current);const e=wc(n,{}),r=function({current:t,retiring:n}){t=wf(t),n=n&&wf(n);const{isList:e,isDetails:r,isForm:i}=t,s=i,o=n&&n.isForm;return{userId:t.userId,formUserId:t.formUserId||n&&n.formUserId,isDrawer:s,isList:e,isDetails:r,isForm:i,wasForm:o}}(t);return function({users:t},n){const{userId:e,formUserId:r}=n;return e&&!On(t,{id:e})||r&&!On(t,{id:r})}(e,r)?gf(new RangeError("NOT_FOUND")):function({users:t}){return 0===t.length}(e)?function(t,{formUserId:n,isForm:e,wasForm:r}){const i=of(t,n);return Z({class:"viewport has-drawers grid is-one"},xc("Users"),Gc(e,tm()),ut({class:"is-hidden"}),function(t){const n=ec("Add a user",Sn());return ut({class:"view grid-main",classes:{"is-active":t}},xc("Users"),nc({title:"There are no users",message:"Create your first user with the button below.",action:n}))}(!e),nm(i,e,r))}(e,r):function(t,n){const e=t.currentUser,r=function({users:t}){return t.sort(cf)}(t),i=n.userId||r[0].id,s=On(r,{id:i}),o=of(t,n.formUserId);return Z({class:"viewport has-drawers grid is-two"},xc("Users"),Gc(n.isDrawer,tm()),function(t,n,e){return ut({class:"view grid-sidebar",classes:{"is-active":e}},xc("Users"),Af({users:t,activeId:n}))}(r,i,n.isList),function(t,n,e){return ut({class:"view grid-main",classes:{"is-active":e}},Mc("User",tm()),Tf({currentUser:t,user:n}))}(e,s,n.isDetails),nm(o,n.isForm,n.wasForm))}(e,r)}),(function(t,n){const e=[ae(n,"page",Qf)];pc(t.data)&&e.push((r=Xf,[mf,r]));var r;return e}),{page:function(t){return Array.isArray(t)&&vf.includes(t[0])}},{ready:!0}));const Qf=t=>({tag:Qf,page:t}),Zf=()=>({tag:Zf}),Kf=t=>({tag:Kf,result:t}),Xf=t=>({tag:Xf,changes:t}),tm=()=>({tag:tm});function nm(t,n,e){return n||e?ut({class:"view",classes:{"is-active":n}},Mc((t.user.id?"Edit":"New")+" user",tm()),Wf(t)):ut({class:"view"})}async function em(){return{clients:await To()}}async function rm(){return await ki(),em()}function im({clients:t},n){return{client:n?On(t,{id:n}):{}}}function sm(t){return Io([rm],t)}function om(t,n,e){return Io(t.id?[$o,t,n]:[No,n],e)}function cm(t,n){return Pi("clients",e=e=>n(t(e))),()=>Ni("clients",e);var e}function am([t]){return io("AdminClients"===t?".view.grid-sidebar":"AdminClient"===t?".view.grid-main":"")}function um(t){return Z({class:"viewport"},Z({class:"view is-active"},xc("Clients"),Vc(t)))}function lm([t]){return Z({class:"viewport grid is-two"},xc("Clients"),ut({class:"view grid-sidebar",classes:{"is-active":"AdminClient"!==t}},xc("Clients"),qc()),function(t){return ut({class:"view grid-main",classes:{"is-active":t}},Mc("Client"),_c())}("AdminClient"===t))}const dm=["AdminClients","AdminClient","NewAdminClient","EditAdminClient"];function fm([t,{id:n,active:e}]){const r="AdminClient"===t,i="NewAdminClient"===t||"EditAdminClient"===t;return{clientId:i?e||n:r?n:void 0,formClientId:i?n:void 0,isList:"AdminClients"===t,isDetails:r,isForm:i}}const mm=se(O((function({clients:t,activeId:n},e){return[{activeId:n,groups:vm(t)},null]}),(function(t,n){switch(t.tag){case pm:return n.groups=vm(t.clients),[n,null];case gm:return n.activeId=t.id,[n,null];case hm:return[n,so(t.nodeId)];default:throw"Unmatched message"}}),(function({groups:t,activeId:n}){return yf(t,(t=>t.id===n),hm)}),(function(t,n){return[ae(n,"clients",pm),ae(n,"activeId",gm)]}),{clients:Array.isArray,activeId:_n},{}));const pm=t=>({tag:pm,clients:t}),gm=t=>({tag:gm,id:t}),hm=t=>({tag:hm,nodeId:t});function vm(t){return If(t,wm,Im)}function wm({name:t}){return t[0].toUpperCase()}function Im({id:t,name:n}){return{id:t,label:n,path:mn(t)}}const ym=se(O((function({client:t},n){return[{client:t,menu:!1},null]}),(function(t,n,e){switch(t.tag){case Am:return n.client=t.client,[n,null];case bm:return[n,(r=n.client.id,i=km,Io([Fo,r],i))];case km:return function({result:t},n,e){return go(t)?[n,Xn({type:"danger",message:"An error occured and the client couldn’t be deleted. Please try again."})]:[n,Wn(dn())]}(t,n);case jm:return n.menu=!n.menu,[n,null];case Cm:return n.menu=!1,[n,null];default:throw"Unmatched message"}var r,i}),(function({client:t,menu:n}){return Z({class:"client-account"},function(t,n){return at({class:"client-account-header"},function({id:t},n){return Jc(n,jm(),nt({},Pe({to:gn(t)},"Client accounts")),nt({},Pe({to:pn(t)},"Edit client")),nt({},Pe({onClick:Ft(bm())},"Delete client")))}(t,n),lt({class:"title"},t.name))}(t,n),t.notes&&function({notes:t}){return ut({class:"client-account-section"},dt({class:"title"},"Notes"),...Lo(t))}(t))}),(function({menu:t},n){const e=[ae(n,"client",Am)];t&&e.push(oo(Cm(),{capture:!0}));return e}),{client:wa},{}));const Am=t=>({tag:Am,client:t}),bm=()=>({tag:bm}),km=t=>({tag:km,result:t}),jm=()=>({tag:jm}),Cm=()=>({tag:Cm});function Dm(t){return new Tu({name:$u("name",t.name),notes:$u("notes",t.notes)})}const Em=se(O((function({client:t},n){return[{client:t,form:Dm(t),isDisabled:!1},null]}),(function(t,n,e){switch(t.tag){case Tm:return function({client:t},n,e){return n.client=t,n.form=Dm(t),[n,null]}(t,n);case Pm:return function({name:t,value:n},e,r){const i=e.form.setValue(t,n),s=Po(e.client,i.getValues());return e.form=Fu(i,s,!0),[e,null]}(t,n);case Nm:return function(t,n,e){const r=n.form.getValues(),i=Po(n.client,r);if(!i.isValid)return n.form=Fu(n.form,i,!1),[n,null];return n.isDisabled=!0,[n,Jn(!1),om(n.client,r,$m)]}(0,n);case $m:return function({result:t},n,e){if(go(t))return function(t,n,e){if(n.isDisabled=!1,t instanceof Qi)return n.form=Fu(n.form,t,!1),[n,Jn(!0)];return[n,Jn(!0),Xn({type:"danger",message:"An error occured and the changes couldn’t be saved. Please try again."})]}(t.error,n);const{id:r}=vo(t,null);return[n,Jn(!0),qn(mn(r))]}(t,n);default:throw"Unmatched message"}}),(function({client:t,isDisabled:n,form:e}){return ht({class:"form client-form",onSubmit:xt(Nm())},vt({disabled:n},Fm(e,"name","Name",eu),Fm(e,"notes","Notes",ru)),kt({type:"submit",class:"button is-primary",disabled:n},t.id?"Save client":"Add client"))}),(function(t,n){return[ae(n,"client",Tm)]}),{client:wa},{}));const Tm=t=>({tag:Tm,client:t}),Pm=t=>n=>({tag:Pm,name:t,value:n}),Nm=()=>({tag:Nm}),$m=t=>({tag:$m,result:t});function Fm(t,n,e,r){const{value:i,errors:s,props:o}=t.get(n);return tu(e,r(i,Pm(n),o),s.join(", "))}const Um=se(O((function({page:t},n){const e={page:{current:t,retiring:null},data:uc()},r=[Jn(!1),(i=Mm,Io([em],i)),sm(Mm)];var i;return[e,...r]}),(function(t,n,e){switch(t.tag){case Sm:return n.page={current:t.page,retiring:n.page.current},[n,am(t.page),de(300,xm())];case xm:return n.page.retiring=null,[n,null];case Mm:return function({result:t},n,e){const r=n.data,i=mc(r),s=go(t)&&Oc(t.error),o=gc(r)&&Oc(r.error);return n.data=po(t)?lc(t.data):pc(r)?n.data:dc(t.error),s?[n,o?null:sc()]:i?[n,ce(e,"ready"),Jn(!0)]:[n,null]}(t,n,e);case Om:return function({changes:t},n,e){return n.data=vc(n.data,(n=>(n.clients=Ps(n.clients,t),n))),[n,null]}(t,n);case Vm:return[n,Bn()];default:throw"Unmatched message"}}),(function({page:t,data:n}){if(gc(n))return um(n.error);if(!pc(n))return lm(t.current);const e=wc(n,{}),r=function({current:t,retiring:n}){t=fm(t),n=n&&fm(n);const{isList:e,isDetails:r,isForm:i}=t,s=i,o=n&&n.isForm;return{clientId:t.clientId,formClientId:t.formClientId||n&&n.formClientId,isDrawer:s,isList:e,isDetails:r,isForm:i,wasForm:o}}(t);return function({clients:t},n){const{clientId:e,formClientId:r}=n;return e&&!On(t,{id:e})||r&&!On(t,{id:r})}(e,r)?um(new RangeError("NOT_FOUND")):function({clients:t}){return 0===t.length}(e)?function(t,{formClientId:n,isForm:e,wasForm:r}){const i=im(t,n);return Z({class:"viewport has-drawers grid is-one"},xc("Clients"),Gc(e,Vm()),ut({class:"is-hidden"}),function(t){const n=ec("Add a client",fn());return ut({class:"view grid-main",classes:{"is-active":t}},xc("Clients"),nc({title:"There are no clients",message:"Create your first client with the button below.",action:n}))}(!e),Lm(i,e,r))}(e,r):function(t,n){const e=function({clients:t}){return t.sort(_o)}(t),r=n.clientId||e[0].id,i=On(e,{id:r}),s=im(t,n.formClientId);return Z({class:"viewport has-drawers grid is-two"},xc("Clients"),Gc(n.isDrawer,Vm()),function(t,n,e){return ut({class:"view grid-sidebar",classes:{"is-active":e}},xc("Clients"),mm({clients:t,activeId:n}))}(e,r,n.isList),function(t,n){return ut({class:"view grid-main",classes:{"is-active":n}},Mc("Client",Vm()),ym({client:t}))}(i,n.isDetails),Lm(s,n.isForm,n.wasForm))}(e,r)}),(function(t,n){const e=[ae(n,"page",Sm)];pc(t.data)&&e.push((r=Om,[cm,r]));var r;return e}),{page:function(t){return Array.isArray(t)&&dm.includes(t[0])}},{ready:!0}));const Sm=t=>({tag:Sm,page:t}),xm=()=>({tag:xm}),Mm=t=>({tag:Mm,result:t}),Om=t=>({tag:Om,changes:t}),Vm=()=>({tag:Vm});function Lm(t,n,e){return n||e?ut({class:"view",classes:{"is-active":n}},Mc((t.client.id?"Edit":"New")+" client",Vm()),Em(t)):ut({class:"view"})}async function Rm(t){const[n,e]=await Promise.all([(r=t,Ci("clients",r)),So((n=>n.clientId===t))]);var r;return{client:n,clientAccounts:e}}async function _m(t){return await ki(),Rm(t)}function qm({client:t,clientAccounts:n},e){return{client:t,clientAccount:e?On(n,{id:e}):{}}}function Wm(t,n){return Io([Rm,t],n)}function Bm(t,n){return Io([_m,t],n)}function zm(t,n,e){return Io(t.id?[Oo,t,n]:[Mo,n],e)}function Gm(t,n,e){return Pi("clientAccounts",r=r=>{if(null===r)return e(n(null));(r=r.filter((n=>n.tombstone||n.clientId===t))).length>0&&e(n(r))}),()=>Ni("clientAccounts",r);var r}function Hm([t]){return io("AdminClientAccounts"===t?".view.grid-sidebar":"AdminClientAccount"===t?".view.grid-main":"")}function Ym(t){return Z({class:"viewport"},Z({class:"view is-active"},xc("Client accounts"),Vc(t)))}function Jm([t]){return Z({class:"viewport grid is-two"},xc("Client accounts"),ut({class:"view grid-sidebar",classes:{"is-active":"AdminClientAccount"!==t}},xc("Client accounts"),qc()),function(t){return ut({class:"view grid-main",classes:{"is-active":t}},Mc("Client account"),_c())}("AdminClientAccount"===t))}const Qm=["AdminClientAccounts","AdminClientAccount","NewAdminClientAccount","EditAdminClientAccount"];function Zm([t,{clientId:n,id:e,active:r}]){const i="AdminClientAccount"===t,s="NewAdminClientAccount"===t||"EditAdminClientAccount"===t;return{clientId:n,clientAccountId:s?r||e:i?e:void 0,formClientAccountId:s?e:void 0,isList:"AdminClientAccounts"===t,isDetails:i,isForm:s}}const Km=se(O((function({clientAccounts:t,activeId:n},e){return[{activeId:n,groups:ep(t)},null]}),(function(t,n){switch(t.tag){case Xm:return n.groups=ep(t.clientAccounts),[n,null];case tp:return n.activeId=t.id,[n,null];case np:return[n,so(t.nodeId)];default:throw"Unmatched message"}}),(function({groups:t,activeId:n}){return yf(t,(t=>t.id===n),np)}),(function(t,n){return[ae(n,"clientAccounts",Xm),ae(n,"activeId",tp)]}),{clientAccounts:Array.isArray,activeId:_n},{}));const Xm=t=>({tag:Xm,clientAccounts:t}),tp=t=>({tag:tp,id:t}),np=t=>({tag:np,nodeId:t});function ep(t){return If(t,rp,ip)}function rp({name:t}){return t[0].toUpperCase()}function ip({id:t,clientId:n,name:e}){return{id:t,label:e,path:vn(n,t)}}const sp=se(O((function({clientAccount:t},n){return[{clientAccount:t,menu:!1},null]}),(function(t,n,e){switch(t.tag){case op:return n.clientAccount=t.clientAccount,[n,null];case cp:return[n,(r=n.clientAccount.id,i=ap,Io([Vo,r],i))];case ap:return function({result:t},n,e){if(go(t))return[n,Xn({type:"danger",message:"An error occured and the account couldn’t be deleted. Please try again."})];const{clientId:r}=vo(t,null);return[n,Wn(gn(r))]}(t,n);case up:return n.menu=!n.menu,[n,null];case lp:return n.menu=!1,[n,null];default:throw"Unmatched message"}var r,i}),(function({clientAccount:t,menu:n}){return Z({class:"client-account"},function(t,n){return at({class:"client-account-header"},function({clientId:t,id:n},e){return Jc(e,up(),nt({},Pe({to:wn(t,n)},"Edit account")),nt({},Pe({onClick:Ft(cp())},"Delete account")))}(t,n),lt({class:"title has-subtitle"},t.name),dt({class:"subtitle"},function({id:t,name:n}){return Ne({to:mn(t)},K({},n))}(t.client)))}(t,n),t.notes&&function({notes:t}){return ut({class:"client-account-section"},dt({class:"title"},"Notes"),...Lo(t))}(t))}),(function({menu:t},n){const e=[ae(n,"clientAccount",op)];t&&e.push(oo(lp(),{capture:!0}));return e}),{clientAccount:wa},{}));const op=t=>({tag:op,clientAccount:t}),cp=()=>({tag:cp}),ap=t=>({tag:ap,result:t}),up=()=>({tag:up}),lp=()=>({tag:lp});function dp(t,n){return new Tu({clientId:t.clientId||n.id,name:$u("name",t.name),notes:$u("notes",t.notes)})}const fp=se(O((function({clientAccount:t,client:n},e){return[{clientAccount:t,client:n,form:dp(t,n),isDisabled:!1},null]}),(function(t,n,e){switch(t.tag){case mp:return function({clientAccount:t},n,e){return n.clientAccount=t,n.form=dp(t,n.client),[n,null]}(t,n);case pp:return function({name:t,value:n},e,r){const i=e.form.setValue(t,n),s=xo(e.clientAccount,i.getValues());return e.form=Fu(i,s,!0),[e,null]}(t,n);case gp:return function(t,n,e){const r=n.form.getValues(),i=xo(n.clientAccount,r);if(!i.isValid)return n.form=Fu(n.form,i,!1),[n,null];return n.isDisabled=!0,[n,Jn(!1),zm(n.clientAccount,r,hp)]}(0,n);case hp:return function({result:t},n,e){if(go(t))return function(t,n,e){if(n.isDisabled=!1,t instanceof Qi)return n.form=Fu(n.form,t,!1),[n,Jn(!0)];return[n,Jn(!0),Xn({type:"danger",message:"An error occured and the changes couldn’t be saved. Please try again."})]}(t.error,n);const{clientId:r,id:i}=vo(t,null),s=vn(r,i);return[n,Jn(!0),qn(s)]}(t,n);default:throw"Unmatched message"}}),(function({clientAccount:t,isDisabled:n,form:e}){return ht({class:"form client-account-form",onSubmit:xt(gp())},vt({disabled:n},vp(e,"name","Name",eu),vp(e,"notes","Notes",ru)),kt({type:"submit",class:"button is-primary",disabled:n},t.id?"Save account":"Add account"))}),(function(t,n){return[ae(n,"clientAccount",mp)]}),{clientAccount:wa,client:wa},{}));const mp=t=>({tag:mp,clientAccount:t}),pp=t=>n=>({tag:pp,name:t,value:n}),gp=()=>({tag:gp}),hp=t=>({tag:hp,result:t});function vp(t,n,e,r){const{value:i,errors:s,props:o}=t.get(n);return tu(e,r(i,pp(n),o),s.join(", "))}const wp=se(O(Ip,(function(t,n,e){switch(t.tag){case yp:return function({page:t},n,e){const r=n.page.current,i=t[1].clientId,s=r[1].clientId;return i!==s?Ip({page:t}):(n.page={current:t,retiring:r},[n,Hm(t),de(300,Ap())])}(t,n);case Ap:return n.page.retiring=null,[n,null];case bp:return function({result:t},n,e){const r=n.data,i=mc(r),s=go(t)&&Oc(t.error),o=gc(r)&&Oc(r.error);return n.data=po(t)?lc(t.data):pc(r)?n.data:dc(t.error),s?[n,o?null:sc()]:i?[n,ce(e,"ready"),Jn(!0)]:[n,null]}(t,n,e);case kp:return function({changes:t},n,e){return n.data=vc(n.data,(n=>(n.clientAccounts=Ps(n.clientAccounts,t),n))),[n,null]}(t,n);case jp:return[n,Bn()];default:throw"Unmatched message"}}),(function({page:t,data:n}){if(gc(n))return Ym(n.error);if(!pc(n))return Jm(t.current);const e=wc(n,{}),r=function({current:t,retiring:n}){t=Zm(t),n=n&&Zm(n);const{isList:e,isDetails:r,isForm:i,clientId:s,clientAccountId:o}=t,c=i,a=n&&n.isForm;return{clientId:s,clientAccountId:o,formClientAccountId:t.formClientAccountId||n&&n.formClientAccountId,isDrawer:c,isList:e,isDetails:r,isForm:i,wasForm:a}}(t);return function({clientAccounts:t},n){const{clientId:e,clientAccountId:r,formClientAccountId:i}=n;return r&&!On(t,{id:r,clientId:e})||i&&!On(t,{id:i,clientId:e})}(e,r)?Ym(new RangeError("NOT_FOUND")):function({clientAccounts:t}){return 0===t.length}(e)?function(t,{clientId:n,formClientAccountId:e,isForm:r,wasForm:i}){const s=qm(t,e);return Z({class:"viewport has-drawers grid is-one"},xc("Client accounts"),Gc(r,jp()),ut({class:"is-hidden"}),function(t,n){const e=ec("Add an account",hn(t));return ut({class:"view grid-main",classes:{"is-active":n}},xc("Client accounts"),nc({title:"There are no client accounts",message:"Create an account with the button below.",action:e}))}(n,!r),Cp(s,r,i))}(e,r):function(t,n){const e=function({client:t,clientAccounts:n}){const e=[],r=t.id;for(const{...i}of n)i.clientId===r&&(i.client=t,e.push(i));return e.sort(_o)}(t),r=n.clientAccountId||e[0].id,i=On(e,{id:r}),s=qm(t,n.formClientAccountId);return Z({class:"viewport has-drawers grid is-two"},xc("Client accounts"),Gc(n.isDrawer,jp()),function(t,n,e){return ut({class:"view grid-sidebar",classes:{"is-active":e}},xc("Client accounts"),Km({clientAccounts:t,activeId:n}))}(e,r,n.isList),function(t,n){return ut({class:"view grid-main",classes:{"is-active":n}},Mc("Client account",jp()),sp({clientAccount:t}))}(i,n.isDetails),Cp(s,n.isForm,n.wasForm))}(e,r)}),(function(t,n){const e=[ae(n,"page",yp)];if(pc(t.data)){const{client:n}=wc(t.data,{});e.push([Gm,n.id,kp])}return e}),{page:function(t){return Array.isArray(t)&&Qm.includes(t[0])}},{ready:!0}));function Ip({page:t},n){const e=t[1].clientId;return[{page:{current:t,retiring:null},data:uc()},...[Jn(!1),Wm(e,bp),Bm(e,bp)]]}const yp=t=>({tag:yp,page:t}),Ap=()=>({tag:Ap}),bp=t=>({tag:bp,result:t}),kp=t=>({tag:kp,changes:t}),jp=()=>({tag:jp});function Cp(t,n,e){if(!n&&!e)return ut({class:"view"});const r=!!t.clientAccount.id;return ut({class:"view",classes:{"is-active":n}},Mc((r?"Edit":"New")+" client account",jp()),fp(t))}function Dp(t){switch(t[0]){case"AdminProjects":case"AdminProject":case"NewAdminProject":case"EditAdminProject":case"AdminProjectInvoice":case"NewAdminProjectInvoice":case"EditAdminProjectInvoice":return"AdminProjects";case"AdminTasks":case"AdminTask":case"NewAdminTask":case"EditAdminTask":case"AdminTaskInvoice":case"NewAdminTaskInvoice":case"EditAdminTaskInvoice":return"AdminTasks";case"AdminUsers":case"AdminUser":case"NewAdminUser":case"EditAdminUser":return"AdminUsers";case"AdminClients":case"AdminClient":case"NewAdminClient":case"EditAdminClient":return"AdminClients";case"AdminClientAccounts":case"AdminClientAccount":case"NewAdminClientAccount":case"EditAdminClientAccount":return"AdminClientAccounts";default:return"NotFound"}}const Ep=se(O((function({state:t},n){return[{isReady:!0,current:t,retiring:null},null]}),(function(t,n,e){switch(t.tag){case Tp:return n.isReady=!1,n.retiring=n.current,n.current=t.state,[n,null];case Pp:return n.isReady=!0,[n,de(300,Np())];case Np:return n.retiring=null,[n,null];default:throw"Unmatched message"}}),(function(t){const n=function({isReady:t,current:n,retiring:e}){if(null===e||Dp(n.page)===Dp(e.page))return[[n.page,!0,!1]];const r=[n.page,t,!t],i=[e.page,!t,!1];return n.timestamp>e.timestamp?[i,r]:[r,i]}(t),e=t.current.page;return Z({class:"dashboard"},$e(e),J("main",{class:"dashboard-main viewport"},...n.map($p)))}),(function(t,n){return[ae(n,"state",Tp)]}),{state:t=>t&&Array.isArray(t.page)},{}));const Tp=t=>({tag:Tp,state:t}),Pp=()=>({tag:Pp}),Np=()=>({tag:Np});function $p([t,n,e]){const r=Dp(t);return[r,Fp({isActive:n},function(t){switch(t){case"AdminProjects":return ml;case"AdminTasks":return Jd;case"AdminUsers":return Jf;case"AdminClients":return Um;case"AdminClientAccounts":return wp;default:return Se}}(r)({page:t,onReady:e?$t(Pp()):void 0}))]}function Fp({isActive:t},...n){return Z({classes:{view:!0,"is-active":t}},...n)}const Up=se(O((function(t,n){return[{redirect:t.r||un(),login:"",password:"",disabled:!0,error:null},rc(Sp)]}),(function(t,n,e){switch(t.tag){case Sp:return function({result:t},n,e){const r=vo(t,{}).user?qn(n.redirect):ce(e,"statuschange","ready");return n.disabled=!1,[n,r]}(t,n,e);case xp:return n.login=t.value,[n,null];case Mp:return n.password=t.value,[n,null];case Op:return function(t,n,e){const{login:r,password:i}=n;if(!r||!i)return n.error="Missing login or password",[n,null];return n.error=null,n.disabled=!0,[n,ic(r,i,Vp)]}(0,n);case Vp:return function({result:t},n,e){if(po(t))return[n,qn(n.redirect)];const r=t.error||{};return n.disabled=!1,n.error="BAD_CREDENTIALS"===r.message?"Wrong username/email or password.":"An error occured.",[n,null]}(t,n);default:throw"Unmatched message"}}),(function(t){return Z({class:"login-page"},Z({class:"login-page-content"},lt({class:"login-page-greeting"},"Welcome to TSociety"),pt({class:"has-centered-text has-mute-text"},"Enter your credentials to access your account"),function({login:t,password:n,error:e,disabled:r}){return ht({class:"form login-page-form",onSubmit:xt(Op())},e&&pt({class:"alert is-danger is-fullwidth"},e),vt({disabled:r},Lp("Login",t,xp,su),Lp("Password",n,Mp,ou)),kt({type:"submit",class:"button is-primary is-fullwidth",disabled:r},"Login"))}(t)))}),(function(t,n){return[]}),{redirect:_n},{statuschange:_n}));const Sp=t=>({tag:Sp,result:t}),xp=t=>({tag:xp,value:t}),Mp=t=>({tag:Mp,value:t}),Op=()=>({tag:Op}),Vp=t=>({tag:Vp,result:t});function Lp(t,n,e,r){return tu(t,r(n,e))}const Rp=O((function(t,n){const e=_p(t),r=e.page,i={state:e,isReady:!0,notifications:[]};return _n(r)?[{...i,state:null},qn(r)]:[i,zn(e)]}),(function(t,n,e){switch(t.tag){case qp:return function({url:t,state:n},e,r){const i=_p(t,n),s=i.page;return _n(s)?[e,qn(s)]:(e.state=i,e.isReady=!0,e.notifications=[],i!==n?[e,zn(i)]:[e,null])}(t,n);case Wp:return n.isReady=t.isReady,[n,null];case Bp:return n.notifications=(r=n.notifications,i=t.notification,r.unshift(function(t){!_n(t)&&"message"in t||(t={type:"info",message:t});const{type:n,message:e}=t;return{id:String(Date.now()),type:n,message:e}}(i)),r.splice(5,r.length),r),[n,null];case zp:return n.notifications=n.notifications.filter((n=>n.id!==t.id)),[n,null];default:throw"Unmatched message"}var r,i}),(function({state:t,isReady:n,notifications:e}){return[(r=!n,Z({classes:{"app-progress":!0,"is-active":r}},Z({class:"app-progress-scaffold is-primary"},Z({class:"app-progress-bar"})),Z({class:"app-progress-scaffold is-secondary"},Z({class:"app-progress-bar"})))),Gp(t),Hp(e)];var r}),(function(t,n){return[(e=qp,[Hn,e]),Qn(Wp),te(Bp)];var e}));function _p(t,n){return n&&void 0!==n.timestamp?n:{page:en(t),timestamp:Date.now()}}const qp=(t,n)=>({tag:qp,url:t,state:n}),Wp=t=>({tag:Wp,isReady:t}),Bp=t=>({tag:Bp,notification:t}),zp=t=>({tag:zp,id:t});function Gp(t){if(null===t)return Z({});const[n,e]=t.page;return"Login"===n?Up({}):Ep({state:t})}function Hp(t){return J("ul",{class:"app-notifications",aria:{live:"polite",atomic:"true"}},...t.map((t=>[t.id,Yp(t)])))}function Yp({id:t,type:n,message:e}){return nt({role:"alert",class:`notification is-${n}`,aria:{live:"assertive",atomic:"true"}},Z({class:"notification-body"},...function(t=[]){return Array.isArray(t)?t:null==t?[]:[t]}(e)),kt({type:"button",class:"button is-close",aria:{label:"Close"},onClick:Ft(zp(t))}))}!function(){const t=sessionStorage.redirect;delete sessionStorage.redirect,history.replaceState(null,"",t);const n=document.getElementById("app");n.classList.add("app"),n.innerHTML="",V(n,Rp,[location])}(),console.log("App is ready.")}();
